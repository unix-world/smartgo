// JS-Script (UM): brace-fold.js @ 2024-09-27 15:57:13 +0000
(function(e){if(typeof exports=="object"&&typeof module=="object"){e(require("../../lib/codemirror"))}else if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],e)}else{e(CodeMirror)}})(function(g){"use strict";function e(a){return function(c,o){var d=o.line,f=c.getLine(d);function e(e){var r;for(var n=o.ch,t=0;;){var i=n<=0?-1:f.lastIndexOf(e[0],n-1);if(i==-1){if(t==1){break}t=1;n=f.length;continue}if(t==1&&i<o.ch){break}r=c.getTokenTypeAt(g.Pos(d,i+1));if(!/^(comment|string)/.test(r)){return{ch:i+1,tokenType:r,pair:e}}n=i-1}}function r(e){var r=1,n=c.lastLine(),t,i=e.ch,o;e:for(var f=d;f<=n;++f){var l=c.getLine(f),a=f==d?i:0;for(;;){var u=l.indexOf(e.pair[0],a),s=l.indexOf(e.pair[1],a);if(u<0){u=l.length}if(s<0){s=l.length}a=Math.min(u,s);if(a==l.length){break}if(c.getTokenTypeAt(g.Pos(f,a+1))==e.tokenType){if(a==u){++r}else if(!--r){t=f;o=a;break e}}++a}}if(t==null||d==t){return null}return{from:g.Pos(d,i),to:g.Pos(t,o)}}var n=[];for(var t=0;t<a.length;t++){var i=e(a[t]);if(i){n.push(i)}}n.sort(function(e,r){return e.ch-r.ch});for(var t=0;t<n.length;t++){var l=r(n[t]);if(l){return l}}return null}}g.registerHelper("fold","brace",e([["{","}"],["[","]"]]));g.registerHelper("fold","brace-paren",e([["{","}"],["[","]"],["(",")"]]));g.registerHelper("fold","import",function(f,e){function r(e){if(e<f.firstLine()||e>f.lastLine()){return null}var r=f.getTokenAt(g.Pos(e,1));if(!/\S/.test(r.string)){r=f.getTokenAt(g.Pos(e,r.end+1))}if(r.type!="keyword"||r.string!="import"){return null}for(var n=e,t=Math.min(f.lastLine(),e+10);n<=t;++n){var i=f.getLine(n),o=i.indexOf(";");if(o!=-1){return{startCh:r.end,end:g.Pos(n,o)}}}}var n=e.line,t=r(n),i;if(!t||r(n-1)||(i=r(n-2))&&i.end.line==n-1){return null}for(var o=t.end;;){var l=r(o.line+1);if(l==null){break}o=l.end}return{from:f.clipPos(g.Pos(n,t.startCh+1)),to:o}});g.registerHelper("fold","include",function(n,e){function r(e){if(e<n.firstLine()||e>n.lastLine()){return null}var r=n.getTokenAt(g.Pos(e,1));if(!/\S/.test(r.string)){r=n.getTokenAt(g.Pos(e,r.end+1))}if(r.type=="meta"&&r.string.slice(0,8)=="#include"){return r.start+8}}var t=e.line,i=r(t);if(i==null||r(t-1)!=null){return null}for(var o=t;;){var f=r(o+1);if(f==null){break}++o}return{from:g.Pos(t,i+1),to:n.clipPos(g.Pos(o))}})});
// #END
