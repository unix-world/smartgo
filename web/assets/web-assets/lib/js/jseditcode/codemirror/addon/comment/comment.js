// JS-Script (UM): comment.js @ 2025-02-07 03:11:46 +0000
(function(e){if(typeof exports=="object"&&typeof module=="object"){e(require("../../lib/codemirror"))}else if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],e)}else{e(CodeMirror)}})(function(e){"use strict";var y={};var S=/[^\s\u00a0]/;var E=e.Pos,v=e.cmpPos;function g(e){var n=e.search(S);return n==-1?0:n}e.commands.toggleComment=function(e){e.toggleComment()};e.defineExtension("toggleComment",function(e){if(!e){e=y}var n=this;var t=Infinity,i=this.listSelections(),l=null;for(var r=i.length-1;r>=0;r--){var o=i[r].from(),a=i[r].to();if(o.line>=t){continue}if(a.line>=t){a=E(t,0)}t=o.line;if(l==null){if(n.uncomment(o,a,e)){l="un"}else{n.lineComment(o,a,e);l="line"}}else if(l=="un"){n.uncomment(o,a,e)}else{n.lineComment(o,a,e)}}});function i(e,n,t){return/\bstring\b/.test(e.getTokenTypeAt(E(n.line,0)))&&!/^[\'\"\`]/.test(t)}function M(e,n){var t=e.getMode();return t.useInnerComments===false||!t.innerMode?t:e.getModeAt(n)}e.defineExtension("lineComment",function(r,e,o){if(!o){o=y}var a=this,n=M(a,r);var t=a.getLine(r.line);if(t==null||i(a,r,t)){return}var f=o.lineComment||n.lineComment;if(!f){if(o.blockCommentStart||n.blockCommentStart){o.fullLines=true;a.blockComment(r,e,o)}return}var m=Math.min(e.ch!=0||e.line==r.line?e.line+1:e.line,a.lastLine()+1);var c=o.padding==null?" ":o.padding;var s=o.commentBlankLines||r.line==e.line;a.operation(function(){if(o.indent){var e=null;for(var n=r.line;n<m;++n){var t=a.getLine(n);var i=t.search(S)===-1?t:t.slice(0,g(t));if(e==null||e.length>i.length){e=i}}for(var n=r.line;n<m;++n){var t=a.getLine(n),l=e.length;if(!s&&!S.test(t)){continue}if(t.slice(0,l)!=e){l=g(t)}a.replaceRange(e+f+c,E(n,0),E(n,l))}}else{for(var n=r.line;n<m;++n){if(s||S.test(a.getLine(n))){a.replaceRange(f+c,E(n,0))}}}})});e.defineExtension("blockComment",function(r,o,a){if(!a){a=y}var f=this,m=M(f,r);var c=a.blockCommentStart||m.blockCommentStart;var s=a.blockCommentEnd||m.blockCommentEnd;if(!c||!s){if((a.lineComment||m.lineComment)&&a.fullLines!=false){f.lineComment(r,o,a)}return}if(/\bcomment\b/.test(f.getTokenTypeAt(E(r.line,0)))){return}var g=Math.min(o.line,f.lastLine());if(g!=r.line&&o.ch==0&&S.test(f.getLine(g))){--g}var u=a.padding==null?" ":a.padding;if(r.line>g){return}f.operation(function(){if(a.fullLines!=false){var e=S.test(f.getLine(g));f.replaceRange(u+s,E(g));f.replaceRange(c+u,E(r.line,0));var n=a.blockCommentLead||m.blockCommentLead;if(n!=null){for(var t=r.line+1;t<=g;++t){if(t!=g||e){f.replaceRange(n+u,E(t,0))}}}}else{var i=v(f.getCursor("to"),o)==0,l=!f.somethingSelected();f.replaceRange(s,o);if(i){f.setSelection(l?o:f.getCursor("from"),o)}f.replaceRange(c,r)}})});e.defineExtension("uncomment",function(e,n,t){if(!t){t=y}var r=this,i=M(r,e);var o=Math.min(n.ch!=0||n.line==e.line?n.line:n.line-1,r.lastLine()),a=Math.min(e.line,o);var l=t.lineComment||i.lineComment,f=[];var m=t.padding==null?" ":t.padding,c;e:{if(!l){break e}for(var s=a;s<=o;++s){var g=r.getLine(s);var u=g.indexOf(l);if(u>-1&&!/comment/.test(r.getTokenTypeAt(E(s,u+1)))){u=-1}if(u==-1&&S.test(g)){break e}if(u>-1&&S.test(g.slice(0,u))){break e}f.push(g)}r.operation(function(){for(var e=a;e<=o;++e){var n=f[e-a];var t=n.indexOf(l),i=t+l.length;if(t<0){continue}if(n.slice(i,i+m.length)==m){i+=m.length}c=true;r.replaceRange("",E(e,t),E(e,i))}});if(c){return true}}var v=t.blockCommentStart||i.blockCommentStart;var d=t.blockCommentEnd||i.blockCommentEnd;if(!v||!d){return false}var h=t.blockCommentLead||i.blockCommentLead;var C=r.getLine(a),p=C.indexOf(v);if(p==-1){return false}var b=o==a?C:r.getLine(o);var k=b.indexOf(d,o==a?p+v.length:0);var L=E(a,p+1),x=E(o,k+1);if(k==-1||!/comment/.test(r.getTokenTypeAt(L))||!/comment/.test(r.getTokenTypeAt(x))||r.getRange(L,x,"\n").indexOf(d)>-1){return false}var R=C.lastIndexOf(v,e.ch);var O=R==-1?-1:C.slice(0,e.ch).indexOf(d,R+v.length);if(R!=-1&&O!=-1&&O+d.length!=e.ch){return false}O=b.indexOf(d,n.ch);var T=b.slice(n.ch).lastIndexOf(v,O-n.ch);R=O==-1||T==-1?-1:n.ch+T;if(O!=-1&&R!=-1&&R!=n.ch){return false}r.operation(function(){r.replaceRange("",E(o,k-(m&&b.slice(k-m.length,k)==m?m.length:0)),E(o,k+d.length));var e=p+v.length;if(m&&C.slice(e,e+m.length)==m){e+=m.length}r.replaceRange("",E(a,p),E(a,e));if(h){for(var n=a+1;n<=o;++n){var t=r.getLine(n),i=t.indexOf(h);if(i==-1||S.test(t.slice(0,i))){continue}var l=i+h.length;if(m&&t.slice(l,l+m.length)==m){l+=m.length}r.replaceRange("",E(n,i),E(n,l))}}});return true})});
// #END
