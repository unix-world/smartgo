// JS-Script (UM): match-highlighter.js @ 2024-12-16 18:40:11 +0000
(function(t){if(typeof exports=="object"&&typeof module=="object"){t(require("../../lib/codemirror"),require("./matchesonscrollbar"))}else if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","./matchesonscrollbar"],t)}else{t(CodeMirror)}})(function(o){"use strict";var i={style:"matchhighlight",minChars:2,delay:100,wordsOnly:false,annotateScrollbar:false,showToken:false,trim:true};function n(t){this.options={};for(var e in i){this.options[e]=(t&&t.hasOwnProperty(e)?t:i)[e]}this.overlay=this.timeout=null;this.matchesonscroll=null;this.active=false}o.defineOption("highlightSelectionMatches",false,function(t,e,i){if(i&&i!=o.Init){f(t);clearTimeout(t.state.matchHighlighter.timeout);t.state.matchHighlighter=null;t.off("cursorActivity",a);t.off("focus",s)}if(e){var r=t.state.matchHighlighter=new n(e);if(t.hasFocus()){r.active=true;l(t)}else{t.on("focus",s)}t.on("cursorActivity",a)}});function a(t){var e=t.state.matchHighlighter;if(e.active||t.hasFocus()){r(t,e)}}function s(t){var e=t.state.matchHighlighter;if(!e.active){e.active=true;r(t,e)}}function r(t,e){clearTimeout(e.timeout);e.timeout=setTimeout(function(){l(t)},e.options.delay)}function h(t,e,i,r){var o=t.state.matchHighlighter;t.addOverlay(o.overlay=g(e,i,r));if(o.options.annotateScrollbar&&t.showMatchesOnScrollbar){var n=i?new RegExp((/\w/.test(e.charAt(0))?"\\b":"")+e.replace(/[\\\[.+*?(){|^$]/g,"\\$&")+(/\w/.test(e.charAt(e.length-1))?"\\b":"")):e;o.matchesonscroll=t.showMatchesOnScrollbar(n,false,{className:"CodeMirror-selection-highlight-scrollbar"})}}function f(t){var e=t.state.matchHighlighter;if(e.overlay){t.removeOverlay(e.overlay);e.overlay=null;if(e.matchesonscroll){e.matchesonscroll.clear();e.matchesonscroll=null}}}function l(c){c.operation(function(){var t=c.state.matchHighlighter;f(c);if(!c.somethingSelected()&&t.options.showToken){var e=t.options.showToken===true?/[\w$]/:t.options.showToken;var i=c.getCursor(),r=c.getLine(i.line),o=i.ch,n=o;while(o&&e.test(r.charAt(o-1))){--o}while(n<r.length&&e.test(r.charAt(n))){++n}if(o<n){h(c,r.slice(o,n),e,t.options.style)}return}var a=c.getCursor("from"),s=c.getCursor("to");if(a.line!=s.line){return}if(t.options.wordsOnly&&!u(c,a,s)){return}var l=c.getRange(a,s);if(t.options.trim){l=l.replace(/^\s+|\s+$/g,"")}if(l.length>=t.options.minChars){h(c,l,false,t.options.style)}})}function u(t,e,i){var r=t.getRange(e,i);if(r.match(/^\w+$/)!==null){if(e.ch>0){var o={line:e.line,ch:e.ch-1};var n=t.getRange(o,e);if(n.match(/\W/)===null){return false}}if(i.ch<t.getLine(e.line).length){var o={line:i.line,ch:i.ch+1};var n=t.getRange(i,o);if(n.match(/\W/)===null){return false}}return true}else{return false}}function c(t,e){return(!t.start||!e.test(t.string.charAt(t.start-1)))&&(t.pos==t.string.length||!e.test(t.string.charAt(t.pos)))}function g(e,i,r){return{token:function(t){if(t.match(e)&&(!i||c(t,i))){return r}t.next();t.skipTo(e.charAt(0))||t.skipToEnd()}}}});
// #END
