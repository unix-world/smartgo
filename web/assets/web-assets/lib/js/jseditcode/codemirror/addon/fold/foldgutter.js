// JS-Script (UM): foldgutter.js @ 2025-02-07 03:11:47 +0000
(function(t){if(typeof exports=="object"&&typeof module=="object"){t(require("../../lib/codemirror"),require("./foldcode"))}else if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","./foldcode"],t)}else{t(CodeMirror)}})(function(r){"use strict";r.defineOption("foldGutter",false,function(t,e,o){if(o&&o!=r.Init){t.clearGutter(t.state.foldGutter.options.gutter);t.state.foldGutter=null;t.off("gutterClick",u);t.off("changes",l);t.off("viewportChange",c);t.off("fold",g);t.off("unfold",g);t.off("swapDoc",l);t.off("optionChange",d)}if(e){t.state.foldGutter=new n(i(e));a(t);t.on("gutterClick",u);t.on("changes",l);t.on("viewportChange",c);t.on("fold",g);t.on("unfold",g);t.on("swapDoc",l);t.on("optionChange",d)}});var s=r.Pos;function n(t){this.options=t;this.from=this.to=0}function i(t){if(t===true){t={}}if(t.gutter==null){t.gutter="CodeMirror-foldgutter"}if(t.indicatorOpen==null){t.indicatorOpen="CodeMirror-foldgutter-open"}if(t.indicatorFolded==null){t.indicatorFolded="CodeMirror-foldgutter-folded"}return t}function p(t,e){var o=t.findMarks(s(e,0),s(e+1,0));for(var r=0;r<o.length;++r){if(o[r].__isFold){var n=o[r].find(-1);if(n&&n.line===e){return o[r]}}}}function m(t){if(typeof t=="string"){var e=document.createElement("div");e.className=t+" CodeMirror-guttermarker-subtle";return e}else{return t.cloneNode(true)}}function f(i,t,e){var f=i.state.foldGutter.options,a=t-1;var u=i.foldOption(f,"minFoldSize");var d=i.foldOption(f,"rangeFinder");var l=typeof f.indicatorFolded=="string"&&o(f.indicatorFolded);var c=typeof f.indicatorOpen=="string"&&o(f.indicatorOpen);i.eachLine(t,e,function(t){++a;var e=null;var o=t.gutterMarkers;if(o){o=o[f.gutter]}if(p(i,a)){if(l&&o&&l.test(o.className)){return}e=m(f.indicatorFolded)}else{var r=s(a,0);var n=d&&d(i,r);if(n&&n.to.line-n.from.line>=u){if(c&&o&&c.test(o.className)){return}e=m(f.indicatorOpen)}}if(!e&&!o){return}i.setGutterMarker(t,f.gutter,e)})}function o(t){return new RegExp("(^|\\s)"+t+"(?:$|\\s)\\s*")}function a(t){var e=t.getViewport(),o=t.state.foldGutter;if(!o){return}t.operation(function(){f(t,e.from,e.to)});o.from=e.from;o.to=e.to}function u(t,e,o){var r=t.state.foldGutter;if(!r){return}var n=r.options;if(o!=n.gutter){return}var i=p(t,e);if(i){i.clear()}else{t.foldCode(s(e,0),n)}}function d(t,e){if(e=="mode"){l(t)}}function l(t){var e=t.state.foldGutter;if(!e){return}var o=e.options;e.from=e.to=0;clearTimeout(e.changeUpdate);e.changeUpdate=setTimeout(function(){a(t)},o.foldOnChangeTimeSpan||600)}function c(e){var o=e.state.foldGutter;if(!o){return}var t=o.options;clearTimeout(o.changeUpdate);o.changeUpdate=setTimeout(function(){var t=e.getViewport();if(o.from==o.to||t.from-o.to>20||o.from-t.to>20){a(e)}else{e.operation(function(){if(t.from<o.from){f(e,t.from,o.from);o.from=t.from}if(t.to>o.to){f(e,o.to,t.to);o.to=t.to}})}},t.updateViewportTimeSpan||400)}function g(t,e){var o=t.state.foldGutter;if(!o){return}var r=e.line;if(r>=o.from&&r<o.to){f(t,r,r+1)}}});
// #END
