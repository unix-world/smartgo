// JS-Script (UM): searchcursor.js @ 2023-12-03 00:04:02 +0000
(function(e){if(typeof exports=="object"&&typeof module=="object"){e(require("../../lib/codemirror"))}else if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],e)}else{e(CodeMirror)}})(function(r){"use strict";var p=r.Pos;function o(e){var t=e.flags;return t!=null?t:(e.ignoreCase?"i":"")+(e.global?"g":"")+(e.multiline?"m":"")}function m(e,t){var n=o(e),i=n;for(var r=0;r<t.length;r++){if(i.indexOf(t.charAt(r))==-1){i+=t.charAt(r)}}return n==i?e:new RegExp(e.source,i)}function d(e){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(e.source)}function v(e,t,n){t=m(t,"g");for(var i=n.line,r=n.ch,o=e.lastLine();i<=o;i++,r=0){t.lastIndex=r;var l=e.getLine(i),h=t.exec(l);if(h){return{from:p(i,h.index),to:p(i,h.index+h[0].length),match:h}}}}function l(e,t,n){if(!d(t)){return v(e,t,n)}t=m(t,"gm");var i,r=1;for(var o=n.line,l=e.lastLine();o<=l;){for(var h=0;h<r;h++){if(o>l){break}var f=e.getLine(o++);i=i==null?f:i+"\n"+f}r=r*2;t.lastIndex=n.ch;var s=t.exec(i);if(s){var c=i.slice(0,s.index).split("\n"),a=s[0].split("\n");var u=n.line+c.length-1,g=c[c.length-1].length;return{from:p(u,g),to:p(u+a.length-1,a.length==1?g+a[0].length:a[a.length-1].length),match:s}}}}function x(e,t,n){var i,r=0;while(r<=e.length){t.lastIndex=r;var o=t.exec(e);if(!o){break}var l=o.index+o[0].length;if(l>e.length-n){break}if(!i||l>i.index+i[0].length){i=o}r=o.index+1}return i}function L(e,t,n){t=m(t,"g");for(var i=n.line,r=n.ch,o=e.firstLine();i>=o;i--,r=-1){var l=e.getLine(i);var h=x(l,t,r<0?0:l.length-r);if(h){return{from:p(i,h.index),to:p(i,h.index+h[0].length),match:h}}}}function h(e,t,n){if(!d(t)){return L(e,t,n)}t=m(t,"gm");var i,r=1,o=e.getLine(n.line).length-n.ch;for(var l=n.line,h=e.firstLine();l>=h;){for(var f=0;f<r&&l>=h;f++){var s=e.getLine(l--);i=i==null?s:s+"\n"+i}r*=2;var c=x(i,t,o);if(c){var a=i.slice(0,c.index).split("\n"),u=c[0].split("\n");var g=l+a.length,v=a[a.length-1].length;return{from:p(g,v),to:p(g+u.length-1,u.length==1?v+u[0].length:u[u.length-1].length),match:c}}}}var O,b;if(String.prototype.normalize){O=function(e){return e.normalize("NFD").toLowerCase()};b=function(e){return e.normalize("NFD")}}else{O=function(e){return e.toLowerCase()};b=function(e){return e}}function y(e,t,n,i){if(e.length==t.length){return n}for(var r=0,o=n+Math.max(0,e.length-t.length);;){if(r==o){return r}var l=r+o>>1;var h=i(e.slice(0,l)).length;if(h==n){return l}else if(h>n){o=l}else{r=l+1}}}function f(e,t,n,i){if(!t.length){return null}var r=i?O:b;var o=r(t).split(/\r|\n\r?/);e:for(var l=n.line,h=n.ch,f=e.lastLine()+1-o.length;l<=f;l++,h=0){var s=e.getLine(l).slice(h),c=r(s);if(o.length==1){var a=c.indexOf(o[0]);if(a==-1){continue e}var n=y(s,c,a,r)+h;return{from:p(l,y(s,c,a,r)+h),to:p(l,y(s,c,a+o[0].length,r)+h)}}else{var u=c.length-o[0].length;if(c.slice(u)!=o[0]){continue e}for(var g=1;g<o.length-1;g++){if(r(e.getLine(l+g))!=o[g]){continue e}}var v=e.getLine(l+o.length-1),m=r(v),d=o[o.length-1];if(m.slice(0,d.length)!=d){continue e}return{from:p(l,y(s,c,u,r)+h),to:p(l+o.length-1,y(v,m,d.length,r))}}}}function s(e,t,n,i){if(!t.length){return null}var r=i?O:b;var o=r(t).split(/\r|\n\r?/);e:for(var l=n.line,h=n.ch,f=e.firstLine()-1+o.length;l>=f;l--,h=-1){var s=e.getLine(l);if(h>-1){s=s.slice(0,h)}var c=r(s);if(o.length==1){var a=c.lastIndexOf(o[0]);if(a==-1){continue e}return{from:p(l,y(s,c,a,r)),to:p(l,y(s,c,a+o[0].length,r))}}else{var u=o[o.length-1];if(c.slice(0,u.length)!=u){continue e}for(var g=1,n=l-o.length+1;g<o.length-1;g++){if(r(e.getLine(n+g))!=o[g]){continue e}}var v=e.getLine(l+1-o.length),m=r(v);if(m.slice(m.length-o[0].length)!=o[0]){continue e}return{from:p(l+1-o.length,y(v,m,v.length-o[0].length,r)),to:p(l,y(s,c,u.length,r))}}}}function i(n,i,e,t){this.atOccurrence=false;this.afterEmptyMatch=false;this.doc=n;e=e?n.clipPos(e):p(0,0);this.pos={from:e,to:e};var r;if(typeof t=="object"){r=t.caseFold}else{r=t;t=null}if(typeof i=="string"){if(r==null){r=false}this.matches=function(e,t){return(e?s:f)(n,i,t,r)}}else{i=m(i,"gm");if(!t||t.multiline!==false){this.matches=function(e,t){return(e?h:l)(n,i,t)}}else{this.matches=function(e,t){return(e?L:v)(n,i,t)}}}}i.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(e){var t=this.doc.clipPos(e?this.pos.from:this.pos.to);if(this.afterEmptyMatch&&this.atOccurrence){t=p(t.line,t.ch);if(e){t.ch--;if(t.ch<0){t.line--;t.ch=(this.doc.getLine(t.line)||"").length}}else{t.ch++;if(t.ch>(this.doc.getLine(t.line)||"").length){t.ch=0;t.line++}}if(r.cmpPos(t,this.doc.clipPos(t))!=0){return this.atOccurrence=false}}var n=this.matches(e,t);this.afterEmptyMatch=n&&r.cmpPos(n.from,n.to)==0;if(n){this.pos=n;this.atOccurrence=true;return this.pos.match||true}else{var i=p(e?this.doc.firstLine():this.doc.lastLine()+1,0);this.pos={from:i,to:i};return this.atOccurrence=false}},from:function(){if(this.atOccurrence){return this.pos.from}},to:function(){if(this.atOccurrence){return this.pos.to}},replace:function(e,t){if(!this.atOccurrence){return}var n=r.splitLines(e);this.doc.replaceRange(n,this.pos.from,this.pos.to,t);this.pos.to=p(this.pos.from.line+n.length-1,n[n.length-1].length+(n.length==1?this.pos.from.ch:0))}};r.defineExtension("getSearchCursor",function(e,t,n){return new i(this.doc,e,t,n)});r.defineDocExtension("getSearchCursor",function(e,t,n){return new i(this,e,t,n)});r.defineExtension("selectMatches",function(e,t){var n=[];var i=this.getSearchCursor(e,this.getCursor("from"),t);while(i.findNext()){if(r.cmpPos(i.to(),this.getCursor("to"))>0){break}n.push({anchor:i.from(),head:i.to()})}if(n.length){this.setSelections(n,0)}})});
// #END
