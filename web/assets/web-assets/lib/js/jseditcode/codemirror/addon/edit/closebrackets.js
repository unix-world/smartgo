// JS-Script (UM): closebrackets.js @ 2025-02-15 03:03:23 +0000
(function(e){if(typeof exports=="object"&&typeof module=="object"){e(require("../../lib/codemirror"))}else if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],e)}else{e(CodeMirror)}})(function(S){var t={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"};var k=S.Pos;S.defineOption("autoCloseBrackets",false,function(e,r,t){if(t&&t!=S.Init){e.removeKeyMap(i);e.state.closeBrackets=null}if(r){n(y(r,"pairs"));e.state.closeBrackets=r;e.addKeyMap(i)}});function y(e,r){if(r=="pairs"&&typeof e=="string"){return e}if(typeof e=="object"&&e[r]!=null){return e[r]}return t[r]}var i={Backspace:e,Enter:r};function n(e){for(var r=0;r<e.length;r++){var t=e.charAt(r),n="'"+t+"'";if(!i[n]){i[n]=a(t)}}}n(t.pairs+"`");function a(r){return function(e){return s(e,r)}}function O(e){var r=e.state.closeBrackets;if(!r||r.override){return r}var t=e.getModeAt(e.getCursor());return t.closeBrackets||r}function e(e){var r=O(e);if(!r||e.getOption("disableInput")){return S.Pass}var t=y(r,"pairs");var n=e.listSelections();for(var i=0;i<n.length;i++){if(!n[i].empty()){return S.Pass}var a=o(e,n[i].head);if(!a||t.indexOf(a)%2!=0){return S.Pass}}for(var i=n.length-1;i>=0;i--){var s=n[i].head;e.replaceRange("",k(s.line,s.ch-1),k(s.line,s.ch+1),"+delete")}}function r(n){var e=O(n);var r=e&&y(e,"explode");if(!r||n.getOption("disableInput")){return S.Pass}var i=n.listSelections();for(var t=0;t<i.length;t++){if(!i[t].empty()){return S.Pass}var a=o(n,i[t].head);if(!a||r.indexOf(a)%2!=0){return S.Pass}}n.operation(function(){var e=n.lineSeparator()||"\n";n.replaceSelection(e+e,null);m(n,-1);i=n.listSelections();for(var r=0;r<i.length;r++){var t=i[r].head.line;n.indentLine(t,null,true);n.indentLine(t+1,null,true)}})}function m(e,r){var t=[],n=e.listSelections(),i=0;for(var a=0;a<n.length;a++){var s=n[a];if(s.head==e.getCursor()){i=a}var o=s.head.ch||r>0?{line:s.head.line,ch:s.head.ch+r}:{line:s.head.line-1};t.push({anchor:o,head:o})}e.setSelections(t,i)}function x(e){var r=S.cmpPos(e.anchor,e.head)>0;return{anchor:new k(e.anchor.line,e.anchor.ch+(r?-1:1)),head:new k(e.head.line,e.head.ch+(r?1:-1))}}function s(t,e){var r=O(t);if(!r||t.getOption("disableInput")){return S.Pass}var n=y(r,"pairs");var i=n.indexOf(e);if(i==-1){return S.Pass}var a=y(r,"closeBefore");var s=y(r,"triples");var o=n.charAt(i+1)==e;var l=t.listSelections();var c=i%2==0;var f;for(var u=0;u<l.length;u++){var h=l[u],d=h.head,v;var p=t.getRange(d,k(d.line,d.ch+1));if(c&&!h.empty()){v="surround"}else if((o||!c)&&p==e){if(o&&A(t,d)){v="both"}else if(s.indexOf(e)>=0&&t.getRange(d,k(d.line,d.ch+3))==e+e+e){v="skipThree"}else{v="skip"}}else if(o&&d.ch>1&&s.indexOf(e)>=0&&t.getRange(k(d.line,d.ch-2),d)==e+e){if(d.ch>2&&/\bstring/.test(t.getTokenTypeAt(k(d.line,d.ch-2)))){return S.Pass}v="addFour"}else if(o){var g=d.ch==0?" ":t.getRange(k(d.line,d.ch-1),d);if(!S.isWordChar(p)&&g!=e&&!S.isWordChar(g)){v="both"}else{return S.Pass}}else if(c&&(p.length===0||/\s/.test(p)||a.indexOf(p)>-1)){v="both"}else{return S.Pass}if(!f){f=v}else if(f!=v){return S.Pass}}var b=i%2?n.charAt(i-1):e;var P=i%2?e:n.charAt(i+1);t.operation(function(){if(f=="skip"){m(t,1)}else if(f=="skipThree"){m(t,3)}else if(f=="surround"){var e=t.getSelections();for(var r=0;r<e.length;r++){e[r]=b+e[r]+P}t.replaceSelections(e,"around");e=t.listSelections().slice();for(var r=0;r<e.length;r++){e[r]=x(e[r])}t.setSelections(e)}else if(f=="both"){t.replaceSelection(b+P,null);t.triggerElectric(b+P);m(t,-1)}else if(f=="addFour"){t.replaceSelection(b+b+b+b,"before");m(t,1)}})}function o(e,r){var t=e.getRange(k(r.line,r.ch-1),k(r.line,r.ch+1));return t.length==2?t:null}function A(e,r){var t=e.getTokenAt(k(r.line,r.ch+1));return/\bstring/.test(t.type)&&t.start==r.ch&&(r.ch==0||!/\bstring/.test(e.getTokenTypeAt(r)))}});
// #END
