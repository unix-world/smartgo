// JS-Script (UM): arch_utils.js @ 2025-02-15 03:03:26 +0000
const smartJ$SnappyCompress=class{constructor(s){"use strict";const o="smartJ$SnappyCompress";const t=this;const a=console;const c=smartJ$Utils;const r=16;const i=1<<r;const A=14;const b=new Array(A+1);const e=()=>{const t=new Uint8Array(c.strToByteArray(s));const r=u(t);if(r<=0){a.warn(o,"Max Compressed Length is Zero");return""}let e=new Uint8Array(r);const n=l(t,e);if(n<=0){a.warn(o,"Compress Failed");return""}e=e.slice(0,n);if(e.length<=0){a.warn(o,"Compress Slice Failed");return""}return String.fromCharCode(...e)};t.compress=e;const l=(t,r)=>{let e=t.length;let n=0;let s=0;s=m(e,r,s);let o;while(n<e){o=Math.min(e-n,i);s=w(t,n,o,r,s);n+=o}return s};const u=t=>{let r=t.length;return 32+r+Math.floor(r/6)};const p=(r,e,n,s,o)=>{for(let t=0;t<o;t++){n[s+t]=r[e+t]}};const E=(t,r)=>{return t*506832829>>>r};const k=(t,r)=>{return t[r]+(t[r+1]<<8)+(t[r+2]<<16)+(t[r+3]<<24)};const D=(t,r,e)=>{return t[r]===t[e]&&t[r+1]===t[e+1]&&t[r+2]===t[e+2]&&t[r+3]===t[e+3]};const B=(t,r,e,n,s)=>{if(e<=60){n[s]=e-1<<2;s++}else if(e<256){n[s]=60<<2;n[s+1]=e-1;s+=2}else{n[s]=61<<2;n[s+1]=e-1&255;n[s+2]=e-1>>>8;s+=3}p(t,r,n,s,e);return s+e};const f=(t,r,e,n)=>{if(n<12&&e<2048){t[r]=1+(n-4<<2)+(e>>>8<<5);t[r+1]=e&255;return r+2}t[r]=2+(n-1<<2);t[r+1]=e&255;t[r+2]=e>>>8;return r+3};const F=(t,r,e,n)=>{while(n>=68){r=f(t,r,e,64);n-=64}if(n>64){r=f(t,r,e,60);n-=60}return f(t,r,e,n)};const m=(t,r,e)=>{do{r[e]=t&127;t=t>>>7;if(t>0){r[e]+=128}e++}while(t>0);return e};const w=(r,e,t,n,s)=>{let o=1;while(1<<o<=t&&o<=A){o+=1}o-=1;let a=32-o;if(typeof b[o]==="undefined"){b[o]=new Uint16Array(1<<o)}let c=b[o];for(let t=0;t<c.length;t++){c[t]=0}let i=e+t;let l=e;let u=e;let p,f;let m,w,y;let h;let d,S,C;let J,$;let g;let U=15;if(t>=U){g=i-U;e++;f=E(k(r,e),a);let t=true;while(t){y=32;m=e;do{e=m;p=f;h=y>>>5;y++;m=e+h;if(e>g){t=false;break}f=E(k(r,m),a);w=l+c[p];c[p]=e-l}while(!D(r,e,w));if(!t){break}s=B(r,u,e-u,n,s);do{d=e;S=4;while(e+S<i&&r[e+S]===r[w+S]){S++}e+=S;C=d-w;s=F(n,s,C,S);u=e;if(e>=g){t=false;break}J=E(k(r,e-1),a);c[J]=e-1-l;$=E(k(r,e),a);w=l+c[$];c[$]=e-l}while(D(r,e,w));if(!t){break}e++;f=E(k(r,e),a)}}if(u<i){s=B(r,u,i-u,n,s)}return s}}};Object.freeze(smartJ$SnappyCompress);if(typeof window!="undefined"){window.smartJ$SnappyCompress=smartJ$SnappyCompress}const smartJ$SnappyUncompress=class{constructor(n){"use strict";const s="smartJ$SnappyUncompress";const t=this;const o=console;const a=smartJ$Utils;const l=[0,255,65535,16777215,4294967295];let u=0;const r=()=>{const t=new Uint8Array(a.strToByteArray(n));const r=c(t);if(r<=0){o.warn(s,"Uncompressed Length is Zero");return""}const e=new Uint8Array(r);if(i(t,e)!==true){o.warn(s,"Uncompress Failed");return""}return String.fromCharCode(...e)};t.uncompress=r;const c=t=>{let r=0;let e=0;let n,s;while(e<32&&u<t.length){n=t[u];u++;s=n&127;if(s<<e>>>e!==s){return-1}r|=s<<e;if(n<128){return r}e+=7}return-1};const i=(t,r)=>{const e=t.length;let n=u;let s=0;let o,a,c,i;while(n<t.length){o=t[n];n++;if((o&3)===0){a=(o>>>2)+1;if(a>60){if(n+3>=e){return false}c=a-60;a=t[n]+(t[n+1]<<8)+(t[n+2]<<16)+(t[n+3]<<24);a=(a&l[c])+1;n+=c}if(n+a>e){return false}p(t,n,r,s,a);n+=a;s+=a}else{switch(o&3){case 1:a=(o>>>2&7)+4;i=t[n]+(o>>>5<<8);n++;break;case 2:if(n+1>=e){return false}a=(o>>>2)+1;i=t[n]+(t[n+1]<<8);n+=2;break;case 3:if(n+3>=e){return false}a=(o>>>2)+1;i=t[n]+(t[n+1]<<8)+(t[n+2]<<16)+(t[n+3]<<24);n+=4;break;default:}if(i===0||i>s){return false}f(r,s,i,a);s+=a}}return true};const p=(r,e,n,s,o)=>{for(let t=0;t<o;t++){n[s+t]=r[e+t]}};const f=(r,e,n,s)=>{for(let t=0;t<s;t++){r[e+t]=r[e-n+t]}}}};Object.freeze(smartJ$SnappyUncompress);if(typeof window!="undefined"){window.smartJ$SnappyUncompress=smartJ$SnappyUncompress}const smartJ$ArchSnappy=new class{constructor(){"use strict";const a="smartJ$ArchSnappy";const t=this;const c=console;let r=false;t.secureClass=()=>{if(r===true){c.warn(a,"Class is already SECURED")}else{r=true;Object.freeze(t)}};const i=smartJ$Utils;const l=smartJ$BaseConv;const u=smartJ$CryptoHash;const p="sy1!";const e=t=>{const r="compress";t=i.stringPureVal(t);if(t==""){return""}const e=u.crc32b(t,true);const n=new smartJ$SnappyCompress(t);t=null;let s=String(n.compress()||"");if(s==""){c.warn(a,r,"Arch is Empty");return""}s=i.stringTrim(l.b64s_enc(s,true,false));if(s==""){c.warn(a,r,"B64 Data is Empty");return""}return String(p+";"+s+";"+e)};t.compress=e;const n=t=>{const r="uncompress";t=i.stringPureVal(t,true);if(t==""){return""}let e=t.split(";",3);if(e[0]!==p){c.warn(a,r,"Invalid Signature");return""}const n=i.stringPureVal(e[2],true);t=i.stringPureVal(e[1],true);e=null;if(n==""){c.warn(a,r,"Empty CRC");return""}if(t==""){c.warn(a,r,"Empty B64 Data");return""}t=l.b64s_dec(t,true);if(t==""){c.warn(a,r,"Empty Arch Data");return""}const s=new smartJ$SnappyUncompress(t);t=null;const o=String(s.uncompress()||"");if(o==""){c.warn(a,r,"Empty Data");return""}if(u.crc32b(o,true)!==n){c.warn(a,r,"Data CRC Failed");return""}return String(o)};t.uncompress=n}};smartJ$ArchSnappy.secureClass();if(typeof window!="undefined"){window.smartJ$ArchSnappy=smartJ$ArchSnappy}
// #END
