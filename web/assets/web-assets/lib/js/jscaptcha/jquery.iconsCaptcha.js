// JS-Script (UM): jquery.iconsCaptcha.js @ 2024-09-27 15:57:27 +0000
jQuery.fn.iconsCaptcha||(u=>{u.fn.extend({iconsCaptcha:function(t){const a=this;const h=console;const i={clickDelay:2500,iconsURL:"css/sf-icons.txt",loaderImg:"img/loading-spokes.svg",loaderEImg:"img/sign-crit-warn.svg",hintText:"Select the icon that does not belong in the series ...",doneText:"An icon has already been selected !",fxHandler:(t,a,i,e)=>{h.log("iCaptcha Selection Done",e,t,i)}};const r=u.extend(i,t);const s=t=>{const a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return String(t.replace(/[&\<\>"]/g,t=>a[t]))};const l=['<div class="iCaptcha-box" title="'+s(r.hintText)+'">','<div class="iCaptcha-line">','<div class="iCaptcha-icon"></div>','<div class="iCaptcha-icon"></div>','<div class="iCaptcha-icon"></div>','<div class="iCaptcha-icon"></div>','<div class="iCaptcha-icon"></div>','<div class="iCaptcha-icon"></div>',"</div>","</div>"];const d=t=>{return t[Math.floor(Math.random()*t.length)]};let e=false;let n=null;const p=(a,t,i)=>{i.empty();if(typeof a=="string"){i.html('<div class="iCaptcha-error"><img src="'+s(r.loaderEImg)+'" alt="ERR" title="'+s(String(a))+'"></div>');h.warn("iCaptcha:","initCaptcha:",String(a));return}if(!Array.isArray(a)||a.length<=0){h.error("iCaptcha:","initCaptcha:","Invalid Array");return}i.html(l.join(""));let n=d(a);let c=null;for(let t=0;t<a.length;t++){c=d(a);if(c===n){c=null}else{break}}if(!c){h.error("iCaptcha Random UID Selection Failed:",t);return}const e=6;const o=Math.floor(Math.random()*e);if(o<0||o>e-1){h.error("iCaptcha Invalid Icon Index:",o,t);return}i.find("div.iCaptcha-icon").each((a,i)=>{let e=null;if(a===o){e=c}else{e=n}if(e){let t=String((a+1)*8).padStart(4,"0");u(i).attr("data-icaptcha-idx",a).data("icaptcha-icn",e).addClass(String(e)+" sfi-2x iCaptcha-Uid-_u"+t)}})};const f=(t,a,i)=>{a.addClass("iCaptcha-overlay");a.find("div.iCaptcha-box").eq(0).attr("title",r.doneText);a.find("div.iCaptcha-icon").each((t,a)=>{u(a).addClass("iCaptcha-disabled")});i.addClass("iCaptcha-selected");const e={id:t,"!":0,"&":2,"#":0,"%":3,".":0,"@":4};a.find("div.iCaptcha-icon").filter((t,a)=>{i.data("icaptcha-icn")===u(a).data("icaptcha-icn")?e["."]++:e["#"]++});e["!"]=(e["!"]+Math.random())/10;e["&"]=(e["&"]+Math.random())/10;e["%"]=(e["%"]+Math.random())/10;e["#"]=(e["#"]+Math.random())/10;e["."]=(e["."]+Math.random())/10;e["@"]=(e["@"]+Math.random())/10;const n=Math.round(Math.exp(e["."]));const c=!!(1<=n&&n<2);const o=n*(Math.PI/10*3)+Math.random()/10*.7;if(typeof r.fxHandler=="function"){r.fxHandler(o,n,c,e)}};let c=a.each((t,a)=>{u(a).empty().html('<div class="iCaptcha-ldr"><center><img src="'+s(r.loaderImg)+'"></center></div>')});n=()=>{e=true;if(!r.iconsURL){h.error("iCaptcha Empty Icons URL");return}u.get(r.iconsURL,null,null,"text").done(t=>{t=String(t||"").trim();if(t.substr(0,8)!=="sfi sfi-"){t=null}const i=t?t.split("\n"):[];t=null;c=a.each((t,a)=>{const c=u(a);const o=c.attr("id");if(!o){h.warn("iCaptcha have no ID:",t);return}if(i.length<=0){p("iCaptcha: FAILED to process the icons list",o,c);return}const r=new Date;let s=false;let l=false;c.on("click",".iCaptcha-line > .iCaptcha-icon",t=>{if(s){return}if(new Date-r<=225){return}if(!l){return}const a=u(t.currentTarget);a.trigger("mouseenter");let i=t;if(t.touches&&t.touches.length>0){i=t.touches[0]}let e=Math.round(i.pageX||-1);let n=Math.round(i.pageY||-1);if(e<0){e=0}if(n<0){n=0}e=Math.round(e-Math.round(a.offset().left));n=Math.round(n-Math.round(a.offset().top));if(!e||!n){return}s=true;f(o,c,a)}).on("mouseenter touchenter touchstart",()=>{if(!l){l=true}}).on("mouseleave touchleave",()=>{if(l){l=false}});p(i,o,c)})}).fail((t,n)=>{c=a.each((t,a)=>{const i=u(a);const e=i.attr("id");if(!e){h.warn("iCaptcha have no ID:",t);return}p("iCaptcha Failed to get the Icons List: "+String(n),e,i)})})};if(r.clickDelay<0){u(window).on("captcha.iconsCaptcha",()=>{n()})}else{setTimeout(()=>{n()},r.clickDelay)}return c}})})(jQuery);
// #END
