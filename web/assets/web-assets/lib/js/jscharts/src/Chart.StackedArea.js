// JS-Script (UM): Chart.StackedArea.js @ 2025-02-07 03:11:50 +0000
(function(){"use strict";var t=this,i=t.Chart,r=i.helpers;var o={scaleBeginAtZero:true};i.types.Line.extend({name:"StackedArea",defaults:o,initialize:function(e){var a=this.options;this.ScaleClass=i.Scale.extend({calculateStackY:function(t,i,o,s){var e=0,n=0;var l=0;for(l=0;l<t.length;l++){n+=t[l].points[o].value}for(l=i;l<t.length;l++){if(l===i&&s){e+=s}else{e=+e+ +t[l].points[o].value}}if(a.relativePoints){e=e/n*100}return this.calculateY(e)}});this.PointClass=i.Point.extend({strokeWidth:this.options.pointDotStrokeWidth,radius:this.options.pointDotRadius,display:this.options.pointDot,hitDetectionRadius:this.options.pointHitDetectionRadius,ctx:this.chart.ctx,inRange:function(t){return Math.pow(t-this.x,2)<Math.pow(this.radius+this.hitDetectionRadius,2)}});this.datasets=[];if(this.options.showTooltips){r.bindEvents(this,this.options.tooltipEvents,function(t){var i=t.type!=="mouseout"?this.getPointsAtEvent(t):[];this.eachPoints(function(t){t.restore(["fillColor","strokeColor"])});r.each(i,function(t){t.fillColor=t.highlightFill;t.strokeColor=t.highlightStroke});this.showTooltip(i)})}r.each(e.datasets,function(o){var s={label:o.label||null,fillColor:o.fillColor,strokeColor:o.strokeColor,pointColor:o.pointColor,pointStrokeColor:o.pointStrokeColor,points:[]};this.datasets.push(s);r.each(o.data,function(t,i){s.points.push(new this.PointClass({value:t,label:e.labels[i],datasetLabel:o.label,strokeColor:o.pointStrokeColor,fillColor:o.pointColor,highlightFill:o.pointHighlightFill||o.pointColor,highlightStroke:o.pointHighlightStroke||o.pointStrokeColor}))},this)},this);this.buildScale(e.labels);this.eachPoints(function(t,i){r.extend(t,{x:this.scale.calculateX(i),y:this.scale.endPoint});t.save()},this);this.render()},buildScale:function(t){var s=this;var o=function(){var o=[];r.each(s.datasets,function(t){r.each(t.points,function(t,i){if(!o[i]){o[i]=0}if(s.options.relativePoints){o[i]=100}else{o[i]=o[i]+t.value}})});if(s.options.relativePoints){o.push(0)}else{r.each(s.datasets[0].points,function(t,i){o.push(t.value)})}return o};var i={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:t.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(t){var i=r.calculateScaleRange(o(),t,this.fontSize,this.beginAtZero,this.integersOnly);r.extend(this,i)},xLabels:t,font:r.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,showHorizontalLines:this.options.scaleShowHorizontalLines,showVerticalLines:this.options.scaleShowVerticalLines,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.pointDotRadius+this.options.pointDotStrokeWidth,showLabels:this.options.scaleShowLabels,display:this.options.showScale};if(this.options.scaleOverride){r.extend(i,{calculateYRange:r.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth})}this.scale=new this.ScaleClass(i)},draw:function(t){var e=t||1;this.clear();var n=this.chart.ctx;var l=function(t){return t.value!==null},a=function(t,i,o){return r.findNextWhere(i,l,o)||t},h=function(t,i,o){return r.findPreviousWhere(i,l,o)||t};this.scale.draw(e);r.each(this.datasets,function(t,o){var s=r.where(t.points,l);r.each(t.points,function(t,i){if(t.hasValue()){t.transition({y:this.scale.calculateStackY(this.datasets,o,i,t.value),x:this.scale.calculateX(i)},e)}},this);if(this.options.bezierCurve){r.each(s,function(t,i){var o=i>0&&i<s.length-1?this.options.bezierCurveTension:0;t.controlPoints=r.splineCurve(h(t,s,i),t,a(t,s,i),o);if(t.controlPoints.outer.y>this.scale.endPoint){t.controlPoints.outer.y=this.scale.endPoint}else if(t.controlPoints.outer.y<this.scale.startPoint){t.controlPoints.outer.y=this.scale.startPoint}if(t.controlPoints.inner.y>this.scale.endPoint){t.controlPoints.inner.y=this.scale.endPoint}else if(t.controlPoints.inner.y<this.scale.startPoint){t.controlPoints.inner.y=this.scale.startPoint}},this)}n.lineWidth=this.options.datasetStrokeWidth;n.strokeStyle=t.strokeColor;n.beginPath();r.each(s,function(t,i){if(i===0){n.moveTo(t.x,t.y)}else{if(this.options.bezierCurve){var o=h(t,s,i);n.bezierCurveTo(o.controlPoints.outer.x,o.controlPoints.outer.y,t.controlPoints.inner.x,t.controlPoints.inner.y,t.x,t.y)}else{n.lineTo(t.x,t.y)}}},this);n.stroke();if(this.options.datasetFill&&s.length>0){n.lineTo(s[s.length-1].x,this.scale.endPoint);n.lineTo(s[0].x,this.scale.endPoint);n.fillStyle=t.fillColor;n.closePath();n.fill()}r.each(s,function(t){t.draw()})},this)}})}).call(this);
// #END
