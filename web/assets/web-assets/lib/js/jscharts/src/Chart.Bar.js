// JS-Script (UM): Chart.Bar.js @ 2024-12-16 18:40:27 +0000
(function(){"use strict";var t=this,s=t.Chart,l=s.helpers;var e={scaleBeginAtZero:true,scaleShowGridLines:true,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:true,scaleShowVerticalLines:false,barShowStroke:true,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>',errorDir:"both",errorStrokeWidth:1,errorCapWidth:.75};s.Type.extend({name:"Bar",defaults:e,initialize:function(o){var r=this.options;this.ScaleClass=s.Scale.extend({offsetGridLines:true,calculateBarX:function(t,s,e){var a=this.calculateBaseWidth(),i=this.calculateX(e)-a/2,o=this.calculateBarWidth(t);return i+o*s+s*r.barDatasetSpacing+o/2},calculateBaseWidth:function(){return this.calculateX(1)-this.calculateX(0)-2*r.barValueSpacing},calculateBarWidth:function(t){var s=this.calculateBaseWidth()-(t-1)*r.barDatasetSpacing;return s/t}});this.datasets=[];if(this.options.showTooltips){l.bindEvents(this,this.options.tooltipEvents,function(t){var s=t.type!=="mouseout"?this.getBarsAtEvent(t):[];this.eachBars(function(t){t.restore(["fillColor","strokeColor"])});l.each(s,function(t){t.fillColor=t.highlightFill;t.strokeColor=t.highlightStroke});this.showTooltip(s)})}this.BarClass=s.Rectangle.extend({strokeWidth:this.options.barStrokeWidth,showStroke:this.options.barShowStroke,ctx:this.chart.ctx});if(typeof s.ErrorBar!=="undefined"){this.ErrorClass=s.ErrorBar.extend({errorDir:this.options.errorDir,errorStrokeWidth:this.options.errorStrokeWidth,ctx:this.chart.ctx})}else{this.ErrorClass=false}l.each(o.datasets,function(a,t){var i={label:a.label||null,fillColor:a.fillColor,strokeColor:a.strokeColor,bars:[]};this.datasets.push(i);l.each(a.data,function(t,s){if(typeof a.error!=="undefined"&&this.ErrorClass){var e=new this.ErrorClass({errorVal:a.error[s],errorStrokeColor:a.errorStrokeColor||a.strokeColor})}else{var e=false}i.bars.push(new this.BarClass({value:t,errorBar:e||false,label:o.labels[s],datasetLabel:a.label,strokeColor:a.strokeColor,fillColor:a.fillColor,highlightFill:a.highlightFill||a.fillColor,highlightStroke:a.highlightStroke||a.strokeColor}))},this)},this);this.buildScale(o.labels);this.BarClass.prototype.base=this.scale.endPoint;if(s.ErrorBar){this.ErrorClass.prototype.base=this.scale.endPoint}this.eachBars(function(t,s,e){l.extend(t,{width:this.scale.calculateBarWidth(this.datasets.length),x:this.scale.calculateBarX(this.datasets.length,e,s),y:this.scale.endPoint});t.save();if(t.errorBar){l.extend(t.errorBar,{x:this.scale.calculateBarX(this.datasets.length,e,s),y:this.scale.endPoint,yDown:this.scale.endPoint,yUp:this.scale.endPoint,width:this.scale.calculateBarWidth(this.datasets.length)*this.options.errorCapWidth});t.errorBar.save()}},this);this.render()},update:function(){this.scale.update();l.each(this.activeElements,function(t){t.restore(["fillColor","strokeColor"])});this.eachBars(function(t){t.save();t.errorBar.save()});this.render()},eachBars:function(e){l.each(this.datasets,function(t,s){l.each(t.bars,e,this,s)},this)},getBarsAtEvent:function(t){var s=[],e=l.getRelativePosition(t),a=function(t){s.push(t.bars[i])},i;for(var o=0;o<this.datasets.length;o++){for(i=0;i<this.datasets[o].bars.length;i++){if(this.datasets[o].bars[i].inRange(e.x,e.y)){l.each(this.datasets,a);return s}}}return s},buildScale:function(t){var e=this;var a=function(){var s=[];e.eachBars(function(t){s.push(t.value)});return s};var s={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:t.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(t){var s=l.calculateScaleRange(a(),t,this.fontSize,this.beginAtZero,this.integersOnly);l.extend(this,s)},xLabels:t,font:l.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,showHorizontalLines:this.options.scaleShowHorizontalLines,showVerticalLines:this.options.scaleShowVerticalLines,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.barShowStroke?this.options.barStrokeWidth:0,showLabels:this.options.scaleShowLabels,display:this.options.showScale};if(this.options.scaleOverride){l.extend(s,{calculateYRange:l.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth})}this.scale=new this.ScaleClass(s)},addData:function(t,e){l.each(t,function(t,s){this.datasets[s].bars.push(new this.BarClass({value:t,label:e,x:this.scale.calculateBarX(this.datasets.length,s,this.scale.valuesCount+1),y:this.scale.endPoint,width:this.scale.calculateBarWidth(this.datasets.length),base:this.scale.endPoint,strokeColor:this.datasets[s].strokeColor,fillColor:this.datasets[s].fillColor}))},this);this.scale.addXLabel(e);this.update()},removeData:function(){this.scale.removeXLabel();l.each(this.datasets,function(t){t.bars.shift()},this);this.update()},reflow:function(){l.extend(this.BarClass.prototype,{y:this.scale.endPoint,base:this.scale.endPoint});l.extend(this.ErrorClass.prototype,{y:this.scale.endPoint,base:this.scale.endPoint,yDown:this.scale.endPoint,yUp:this.scale.endPoint});var t=l.extend({height:this.chart.height,width:this.chart.width});this.scale.update(t)},draw:function(t){var a=t||1;this.clear();var s=this.chart.ctx;this.scale.draw(a);l.each(this.datasets,function(t,e){l.each(t.bars,function(t,s){if(t.hasValue()){t.base=this.scale.endPoint;t.transition({x:this.scale.calculateBarX(this.datasets.length,e,s),y:this.scale.calculateY(t.value),width:this.scale.calculateBarWidth(this.datasets.length)},a).draw();if(t.errorBar){t.errorBar.base=this.scale.endPoint;t.errorBar.transition({x:this.scale.calculateBarX(this.datasets.length,e,s),y:this.scale.calculateY(t.value),yDown:this.scale.calculateY(t.value-t.errorBar.errorVal),yUp:this.scale.calculateY(t.value+t.errorBar.errorVal),width:this.scale.calculateBarWidth(this.datasets.length)*this.options.errorCapWidth},a).draw()}}},this)},this)}})}).call(this);
// #END
