// JS-Script (US): smart-grid.js @ 2023-01-21 15:28:21 +0000
if(typeof SmartGrid!="undefined"){console.warn("SmartGrid class has been already loaded !")}else{const SmartGrid=class{constructor(gridID,infoListID,jsonURL,cookieStorePrefix,sortColumn,sortDir,sortType,formNameID=null,showLoadNotification=true,notifCssGrowlClass=null,evcode=null){const _N$="SmartGrid";const _C$=this;const _p$=console;const $=jQuery;const _Utils$=smartJ$Utils;const _BwUtils$=smartJ$Browser;const _Grid$=Slick.Grid;if(jsonURL==undefined||jsonURL==""){throw"ERR: "+_N$+": Invalid jsonURL !";return}if(cookieStorePrefix==undefined||cookieStorePrefix==""){throw"ERR: "+_N$+": Invalid cookieStorePrefix !";return}if(sortColumn==undefined){throw"ERR: "+_N$+": Invalid sortColumn !";return}if(sortDir==undefined){throw"ERR: "+_N$+" SmartGrid: Invalid sortDir !";return}if(sortType==undefined){throw"ERR: "+_N$+": Invalid sortType !";return}_C$.grid=null;_C$.navPager=null;_C$.data=[];let offs=0;let itemsPerPage=1;let itemsTotal=0;let crrOffset=0;let cookieURL=String(String(cookieStorePrefix)+"_URL");let cookieWidths=String(String(cookieStorePrefix)+"_Wdts");let crrSavedURL="";let clientSort=false;let saved_sortColumn=sortColumn;let saved_sortDir=sortDir;let saved_sortType=sortType;const resetGrid=function(){_BwUtils$.setCookie(cookieURL,"&");sortColumn=saved_sortColumn;sortDir=saved_sortDir;sortType=saved_sortType;offs=0;crrSavedURL=""};_C$.resetGrid=resetGrid;const loadGridData=function(offs=0){if(_C$.grid===null){_p$.error(_N$,"ERR: Grid was not initialized ... use initGrid(columns, options); first !");return}if(showLoadNotification!==false){_BwUtils$.OverlayShow("<div><center><b>... loading data ...</b></center></div>","",notifCssGrowlClass)}let fdata="";if(formNameID!=undefined&&formNameID!=""){fdata=String($("#"+String(formNameID)).serialize())}let crrCookieURL=_BwUtils$.getCookie(cookieURL);if(location.hash){crrSavedURL=String(location.hash.substring(2));let clean_uri=String(location.protocol+"//"+location.host+location.pathname+location.search);try{self.history.replaceState({},document.title,String(clean_uri))}catch(err){self.location=String(clean_uri)}}else if(crrSavedURL===""&&crrCookieURL!=""&&crrCookieURL!="&"){crrSavedURL=String(crrCookieURL)}else{crrSavedURL="sortby="+_Utils$.escape_url(sortColumn)+"&sortdir="+_Utils$.escape_url(sortDir)+"&sorttype="+_Utils$.escape_url(sortType)+"&ofs="+_Utils$.format_number_int(offs,false);if(crrCookieURL!="&"){crrSavedURL+="&"+fdata}}_BwUtils$.setCookie(cookieURL,crrSavedURL);let crrURL=String(jsonURL+"&"+crrSavedURL);_BwUtils$.AjaxRequestFromURL(crrURL,"POST","json").done(msg=>{if(msg.status!==undefined&&msg.status==="OK"&&msg.rowsList!==undefined&&msg.crrOffset!==undefined&&msg.itemsPerPage!==undefined&&msg.totalRows!==undefined){_C$.data=msg.rowsList;crrOffset=_Utils$.format_number_int(msg.crrOffset,false);itemsPerPage=_Utils$.format_number_int(msg.itemsPerPage,false);itemsTotal=_Utils$.format_number_int(msg.totalRows,false);sortColumn=String(msg.sortBy);sortDir=String(msg.sortDir);sortType=String(msg.sortType);clientSort=false;if(msg.clientSort!==undefined){if(msg.clientSort===sortColumn){clientSort=true}}if(formNameID!==null&&formNameID!=""){if(msg.filter!==undefined){$.each(msg.filter,(index,value)=>{try{$("#"+String(formNameID)).find(":input[name="+_Utils$.escape_url(index)+"]").val(value)}catch(err){_p$.warn(_N$,"WARN: Grid Failed to Set a Filter value: ["+value+"] on Control: ["+index+"]"+"\nDetails:",err)}})}}if(itemsPerPage<=0){_p$.error(_N$,"ERR: Invalid Value for Pagination itemsPerPage ... Must be > 0 !")}else{if(_C$.navPager!==null){_C$.navPager.pagination("updateItemsOnPage",itemsPerPage);_C$.navPager.pagination("updateItems",itemsTotal);_C$.navPager.pagination("drawPage",Math.round(_Utils$.format_number_float(_Utils$.format_number_int(crrOffset,false)/_Utils$.format_number_int(itemsPerPage,false)))+1);_C$.navPager.pagination("redraw")}}if(clientSort===true){if(sortType==="numeric"){_C$.data.sort(_Utils$.numericSort(sortColumn))}else{_C$.data.sort(_Utils$.textSort(sortColumn,true))}if(sortDir==="DESC"){_C$.data.reverse()}}_C$.grid.setSelectedRows([]);_C$.grid.invalidate();if(sortDir==="DESC"){_C$.grid.setSortColumn(sortColumn,false)}else{_C$.grid.setSortColumn(sortColumn,true)}_C$.grid.setData(_C$.data);_C$.grid.render();let tLstRec=_Utils$.format_number_int(crrOffset,false)+_Utils$.format_number_int(itemsPerPage,false);if(!_Utils$.isFiniteNumber(tLstRec)){tLstRec-0}if(tLstRec>itemsTotal){tLstRec=itemsTotal}if(infoListID!=undefined&&infoListID!=""){$("#"+String(infoListID)).text(String(crrOffset+" - "+tLstRec+" / "+itemsTotal))}_Utils$.evalJsFxCode(_N$+".loadGridData",typeof evcode==="function"?()=>{"use strict";evcode(gridID,_C$.grid,_C$.navPager,_C$.data,msg,formNameID,infoListID)}:()=>{"use strict";!!evcode?eval(evcode):null});_BwUtils$.OverlayHide()}else{_BwUtils$.AlertDialog("ERROR: "+_N$+" :: Invalid Data Format while trying to get Data via AJAX !"+"<hr>"+"Details:<br>"+String(msg.status!==undefined?msg.status:"")+": "+String(msg.error!==undefined?msg.error:""),"","ERROR",550,250);_BwUtils$.OverlayHide()}}).fail(msg=>{_BwUtils$.AlertDialog("ERROR: "+_N$+" :: Invalid Server Response via AJAX !"+"<hr>"+msg.responseText,"","ERROR",750,425);_BwUtils$.OverlayHide()})};_C$.loadGridData=loadGridData;const initGrid=function(columns,options={}){_C$.grid=new _Grid$($("#"+String(gridID)),_C$.data,columns,options);let theSavedWidths=_BwUtils$.getCookie(cookieWidths);if(theSavedWidths!=""){let arrSavedWidths=theSavedWidths.split(";");$.each(columns,(index,value)=>{let theCrrWidth=_Utils$.format_number_int(parseInt(arrSavedWidths[index]));if(theCrrWidth<5){theCrrWidth=5}else if(theCrrWidth>1500){theCrrWidth=1500}columns[index].width=theCrrWidth})}_C$.grid.autosizeColumns();_C$.grid.onColumnsResized=colWidths=>{let savedWidths="",j=0;for(let j=0;j<colWidths.length;j++){savedWidths+=String(colWidths[j])+";"}_BwUtils$.setCookie(cookieWidths,savedWidths)};_C$.grid.onSort=(sortCol,sortAsc)=>{sortColumn=sortCol.field;if(sortCol.sortNumeric){sortType="numeric"}else{sortType="text"}if(sortAsc!==true){sortDir="DESC"}else{sortDir="ASC"}loadGridData(0)}};_C$.initGrid=initGrid;const getOffset=function(){return _Utils$.format_number_int(parseInt(crrOffset))};_C$.getOffset=getOffset;const initNavPager=function(pager_id,pagerDisplayPages=5){if(pager_id==undefined||pager_id==""){throw"ERR: "+_N$+": Invalid PagerID on initNavPager !";return}pagerDisplayPages=_Utils$.format_number_int(pagerDisplayPages,false);if(pagerDisplayPages<1||pagerDisplayPages>50){pagerDisplayPages=5}_C$.navPager=$("#"+String(pager_id));if(typeof _C$.navPager.pagination=="undefined"){throw"ERR: "+_N$+": NavPager is N/A on initNavPager !";return}_C$.navPager.pagination({ellipseClass:"ux-field",cssStyle:"light-theme",displayedPages:pagerDisplayPages,edges:pagerDisplayPages,onPageClick:(pageNumber,event)=>{if(event!=undefined){if(event.type=="click"){crrOffset=_Utils$.format_number_int((pageNumber-1)*itemsPerPage,false);loadGridData(crrOffset)}}return false},itemsOnPage:itemsPerPage,items:itemsTotal})};_C$.initNavPager=initNavPager;const getSelectedRows=function(selectedDataColumn){if(!selectedDataColumn){return[]}let arr_sel_items=[];if(_C$.data.length<=0){return arr_sel_items}let rows_selected=_C$.grid.getSelectedRows();if(rows_selected.length<=0){return arr_sel_items}let theRowIndexSelected=-1;for(let i=0;i<rows_selected.length;i++){if(rows_selected[i]!=undefined){theRowIndexSelected=_Utils$.format_number_int(rows_selected[i],false);if(theRowIndexSelected>=0&&theRowIndexSelected<_C$.data.length){arr_sel_items[String(theRowIndexSelected)]=_C$.data[theRowIndexSelected][selectedDataColumn]}}}return arr_sel_items};_C$.getSelectedRows=getSelectedRows;const reloadGrid=function(redirect=null){if(redirect!=undefined&&redirect!=""){self.location=String(redirect)}else{self.location=self.location}};_C$.reloadGrid=reloadGrid}};Object.freeze(SmartGrid);window.SmartGrid=SmartGrid}
// #END
