// JS-Script (UM): dataTables.rowReorder.js @ 2022-09-20 09:51:01 +0000
(function(r){if(typeof define==="function"&&define.amd){define(["jquery","datatables.net"],function(e){return r(e,window,document)})}else if(typeof exports==="object"){module.exports=function(e,t){if(!e){e=window}if(!t||!t.fn.dataTable){t=require("datatables.net")(e,t).$}return r(t,e,e.document)}}else{r(jQuery,window,document)}})(function(m,a,b,e){"use strict";var s=m.fn.dataTable;var d=function(e,t){if(!s.versionCheck||!s.versionCheck("1.10.8")){throw"DataTables RowReorder requires DataTables 1.10.8 or newer"}this.c=m.extend(true,{},s.defaults.rowReorder,d.defaults,t);this.s={bodyTop:null,dt:new s.Api(e),getDataFn:s.ext.oApi._fnGetObjectDataFn(this.c.dataSrc),middles:null,scroll:{},scrollInterval:null,setDataFn:s.ext.oApi._fnSetObjectDataFn(this.c.dataSrc),start:{top:0,left:0,offsetTop:0,offsetLeft:0,nodes:[]},windowHeight:0,documentOuterHeight:0,domCloneOuterHeight:0};this.dom={clone:null,dtScroll:m("div.dataTables_scrollBody",this.s.dt.table().container())};var r=this.s.dt.settings()[0];var o=r.rowreorder;if(o){return o}r.rowreorder=this;this._constructor()};m.extend(d.prototype,{_constructor:function(){var o=this;var i=this.s.dt;var e=m(i.table().node());if(e.css("position")==="static"){e.css("position","relative")}m(i.table().container()).on("mousedown.rowReorder touchstart.rowReorder",this.c.selector,function(e){if(!o.c.enable){return}if(m(e.target).is(o.c.excludedChildren)){return true}var t=m(this).closest("tr");var r=i.row(t);if(r.any()){o._emitEvent("pre-row-reorder",{node:r.node(),index:r.index()});o._mouseDown(e,t);return false}});i.on("destroy.rowReorder",function(){m(i.table().container()).off(".rowReorder");i.off(".rowReorder")})},_cachePositions:function(){var r=this.s.dt;var o=m(r.table().node()).find("thead").outerHeight();var e=m.unique(r.rows({page:"current"}).nodes().toArray());var i=m.map(e,function(e,t){return m(e).position().top-o});var t=m.map(i,function(e,t){return i.length<t-1?(e+i[t+1])/2:(e+e+m(r.row(":last-child").node()).outerHeight())/2});this.s.middles=t;this.s.bodyTop=m(r.table().body()).offset().top;this.s.windowHeight=m(a).height();this.s.documentOuterHeight=m(b).outerHeight()},_clone:function(e){var t=this.s.dt;var r=m(t.table().node().cloneNode(false)).addClass("dt-rowReorder-float").append("<tbody></tbody>").append(e.clone(false));var o=e.outerWidth();var i=e.outerHeight();var n=e.children().map(function(){return m(this).width()});r.width(o).height(i).find("tr").children().each(function(e){this.style.width=n[e]+"px"});r.appendTo("body");this.dom.clone=r;this.s.domCloneOuterHeight=r.outerHeight()},_clonePosition:function(e){var t=this.s.start;var r=this._eventToPage(e,"Y")-t.top;var o=this._eventToPage(e,"X")-t.left;var i=this.c.snapX;var n;var s=r+t.offsetTop;if(i===true){n=t.offsetLeft}else if(typeof i==="number"){n=t.offsetLeft+i}else{n=o+t.offsetLeft}if(s<0){s=0}else if(s+this.s.domCloneOuterHeight>this.s.documentOuterHeight){s=this.s.documentOuterHeight-this.s.domCloneOuterHeight}this.dom.clone.css({top:s,left:n})},_emitEvent:function(r,o){this.s.dt.iterator("table",function(e,t){m(e.nTable).triggerHandler(r+".dt",o)})},_eventToPage:function(e,t){if(e.type.indexOf("touch")!==-1){return e.originalEvent.touches[0]["page"+t]}return e["page"+t]},_mouseDown:function(e,t){var r=this;var o=this.s.dt;var i=this.s.start;var n=t.offset();i.top=this._eventToPage(e,"Y");i.left=this._eventToPage(e,"X");i.offsetTop=n.top;i.offsetLeft=n.left;i.nodes=m.unique(o.rows({page:"current"}).nodes().toArray());this._cachePositions();this._clone(t);this._clonePosition(e);this.dom.target=t;t.addClass("dt-rowReorder-moving");m(b).on("mouseup.rowReorder touchend.rowReorder",function(e){r._mouseUp(e)}).on("mousemove.rowReorder touchmove.rowReorder",function(e){r._mouseMove(e)});if(m(a).width()===m(b).width()){m(b.body).addClass("dt-rowReorder-noOverflow")}var s=this.dom.dtScroll;this.s.scroll={windowHeight:m(a).height(),windowWidth:m(a).width(),dtTop:s.length?s.offset().top:null,dtLeft:s.length?s.offset().left:null,dtHeight:s.length?s.outerHeight():null,dtWidth:s.length?s.outerWidth():null}},_mouseMove:function(e){this._clonePosition(e);var t=this._eventToPage(e,"Y")-this.s.bodyTop;var r=this.s.middles;var o=null;var i=this.s.dt;var n=i.table().body();for(var s=0,a=r.length;s<a;s++){if(t<r[s]){o=s;break}}if(o===null){o=r.length}if(this.s.lastInsert===null||this.s.lastInsert!==o){if(o===0){this.dom.target.prependTo(n)}else{var d=m.unique(i.rows({page:"current"}).nodes().toArray());if(o>this.s.lastInsert){this.dom.target.insertAfter(d[o-1])}else{this.dom.target.insertBefore(d[o])}}this._cachePositions();this.s.lastInsert=o}this._shiftScroll(e)},_mouseUp:function(e){var r=this;var o=this.s.dt;var i,n;var s=this.c.dataSrc;this.dom.clone.remove();this.dom.clone=null;this.dom.target.removeClass("dt-rowReorder-moving");m(b).off(".rowReorder");m(b.body).removeClass("dt-rowReorder-noOverflow");clearInterval(this.s.scrollInterval);this.s.scrollInterval=null;var t=this.s.start.nodes;var a=m.unique(o.rows({page:"current"}).nodes().toArray());var d={};var l=[];var f=[];var u=this.s.getDataFn;var h=this.s.setDataFn;for(i=0,n=t.length;i<n;i++){if(t[i]!==a[i]){var c=o.row(a[i]).id();var v=o.row(a[i]).data();var w=o.row(t[i]).data();if(c){d[c]=u(w)}l.push({node:a[i],oldData:u(v),newData:u(w),newPosition:i,oldPosition:m.inArray(a[i],t)});f.push(a[i])}}var p=[l,{dataSrc:s,nodes:f,values:d,triggerRow:o.row(this.dom.target)}];this._emitEvent("row-reorder",p);var g=function(){if(r.c.update){for(i=0,n=l.length;i<n;i++){var e=o.row(l[i].node);var t=e.data();h(t,l[i].newData);o.columns().every(function(){if(this.dataSrc()===s){o.cell(l[i].node,this.index()).invalidate("data")}})}r._emitEvent("row-reordered",p);o.draw(false)}};if(this.c.editor){this.c.enable=false;this.c.editor.edit(f,false,m.extend({submit:"changed"},this.c.formOptions)).multiSet(s,d).one("preSubmitCancelled.rowReorder",function(){r.c.enable=true;r.c.editor.off(".rowReorder");o.draw(false)}).one("submitUnsuccessful.rowReorder",function(){o.draw(false)}).one("submitSuccess.rowReorder",function(){g()}).one("submitComplete",function(){r.c.enable=true;r.c.editor.off(".rowReorder")}).submit()}else{g()}},_shiftScroll:function(e){var t=this;var r=this.s.dt;var o=this.s.scroll;var i=false;var n=5;var s=65;var a=e.pageY-b.body.scrollTop,d,l;if(a<s){d=n*-1}else if(a>o.windowHeight-s){d=n}if(o.dtTop!==null&&e.pageY<o.dtTop+s){l=n*-1}else if(o.dtTop!==null&&e.pageY>o.dtTop+o.dtHeight-s){l=n}if(d||l){o.windowVert=d;o.dtVert=l;i=true}else if(this.s.scrollInterval){clearInterval(this.s.scrollInterval);this.s.scrollInterval=null}if(!this.s.scrollInterval&&i){this.s.scrollInterval=setInterval(function(){if(o.windowVert){b.body.scrollTop+=o.windowVert}if(o.dtVert){var e=t.dom.dtScroll[0];if(o.dtVert){e.scrollTop+=o.dtVert}}},20)}}});d.defaults={dataSrc:0,editor:null,enable:true,formOptions:{},selector:"td:first-child",snapX:false,update:true,excludedChildren:"a"};var t=m.fn.dataTable.Api;t.register("rowReorder()",function(){return this});t.register("rowReorder.enable()",function(t){if(t===e){t=true}return this.iterator("table",function(e){if(e.rowreorder){e.rowreorder.c.enable=t}})});t.register("rowReorder.disable()",function(){return this.iterator("table",function(e){if(e.rowreorder){e.rowreorder.c.enable=false}})});d.version="1.2.5";m.fn.dataTable.RowReorder=d;m.fn.DataTable.RowReorder=d;m(b).on("init.dt.dtr",function(e,t,r){if(e.namespace!=="dt"){return}var o=t.oInit.rowReorder;var i=s.defaults.rowReorder;if(o||i){var n=m.extend({},o,i);if(o!==false){new d(t,n)}}});return d});
// #END
