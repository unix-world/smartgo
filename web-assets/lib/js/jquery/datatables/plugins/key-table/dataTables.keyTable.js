// JS-Script (UM): dataTables.keyTable.js @ 2022-09-20 09:51:00 +0000
(function(i){if(typeof define==="function"&&define.amd){define(["jquery","datatables.net"],function(e){return i(e,window,document)})}else if(typeof exports==="object"){module.exports=function(e,t){if(!e){e=window}if(!t||!t.fn.dataTable){t=require("datatables.net")(e,t).$}return i(t,e,e.document)}}else{i(jQuery,window,document)}})(function(h,v,p,y){"use strict";var r=h.fn.dataTable;var l=function(e,t){if(!r.versionCheck||!r.versionCheck("1.10.8")){throw"KeyTable requires DataTables 1.10.8 or newer"}this.c=h.extend(true,{},r.defaults.keyTable,l.defaults,t);this.s={dt:new r.Api(e),enable:true,focusDraw:false,waitingForDraw:false,lastFocus:null};this.dom={};var i=this.s.dt.settings()[0];var a=i.keytable;if(a){return a}i.keytable=this;this._constructor()};h.extend(l.prototype,{blur:function(){this._blur()},enable:function(e){this.s.enable=e},focus:function(e,t){this._focus(this.s.dt.cell(e,t))},focused:function(e){var t=this.s.lastFocus;if(!t){return false}var i=this.s.lastFocus.cell.index();return e.row===i.row&&e.column===i.column},_constructor:function(){this._tabInput();var n=this;var r=this.s.dt;var e=h(r.table().node());if(e.css("position")==="static"){e.css("position","relative")}h(r.table().body()).on("click.keyTable","th, td",function(e){if(n.s.enable===false){return}var t=r.cell(this);if(!t.any()){return}n._focus(t,null,false,e)});h(p).on("keydown.keyTable",function(e){n._key(e)});if(this.c.blurable){h(p).on("mousedown.keyTable",function(e){if(h(e.target).parents(".dataTables_filter").length){n._blur()}if(h(e.target).parents().filter(r.table().container()).length){return}if(h(e.target).parents("div.DTE").length){return}if(h(e.target).parents("div.editor-datetime").length){return}if(h(e.target).parents().filter(".DTFC_Cloned").length){return}n._blur()})}if(this.c.editor){var a=this.c.editor;a.on("open.keyTableMain",function(e,t,i){if(t!=="inline"&&n.s.enable){n.enable(false);a.one("close.keyTable",function(){n.enable(true)})}});if(this.c.editOnFocus){r.on("key-focus.keyTable key-refocus.keyTable",function(e,t,i,a){n._editor(null,a,true)})}r.on("key.keyTable",function(e,t,i,a,s){n._editor(i,s,false)});h(r.table().body()).on("dblclick.keyTable","th, td",function(e){if(n.s.enable===false){return}var t=r.cell(this);if(!t.any()){return}n._editor(null,e,true)})}if(r.settings()[0].oFeatures.bStateSave){r.on("stateSaveParams.keyTable",function(e,t,i){i.keyTable=n.s.lastFocus?n.s.lastFocus.cell.index():null})}r.on("draw.keyTable",function(e){if(n.s.focusDraw){return}var t=n.s.lastFocus;if(t&&t.node&&h(t.node).closest("body")===p.body){var i=n.s.lastFocus.relative;var a=r.page.info();var s=i.row+a.start;if(a.recordsDisplay===0){return}if(s>=a.recordsDisplay){s=a.recordsDisplay-1}n._focus(s,i.column,true,e)}});if(this.c.clipboard){this._clipboard()}r.on("destroy.keyTable",function(){r.off(".keyTable");h(r.table().body()).off("click.keyTable","th, td");h(p).off("keydown.keyTable").off("click.keyTable").off("copy.keyTable").off("paste.keyTable")});var t=r.state.loaded();if(t&&t.keyTable){r.one("init",function(){var e=r.cell(t.keyTable);if(e.any()){e.focus()}})}else if(this.c.focus){r.cell(this.c.focus).focus()}},_blur:function(){if(!this.s.enable||!this.s.lastFocus){return}var e=this.s.lastFocus.cell;h(e.node()).removeClass(this.c.className);this.s.lastFocus=null;this._updateFixedColumns(e.index().column);this._emitEvent("key-blur",[this.s.dt,e])},_clipboard:function(){var r=this.s.dt;var l=this;if(!v.getSelection){return}h(p).on("copy.keyTable",function(e){var t=e.originalEvent;var i=v.getSelection().toString();var a=l.s.lastFocus;if(!i&&a){t.clipboardData.setData("text/plain",a.cell.render(l.c.clipboardOrthogonal));t.preventDefault()}});h(p).on("paste.keyTable",function(e){var t=e.originalEvent;var i=l.s.lastFocus;var a=p.activeElement;var s=l.c.editor;var n;if(i&&(!a||a.nodeName.toLowerCase()==="body")){t.preventDefault();if(v.clipboardData&&v.clipboardData.getData){n=v.clipboardData.getData("Text")}else if(t.clipboardData&&t.clipboardData.getData){n=t.clipboardData.getData("text/plain")}if(s){s.inline(i.cell.index()).set(s.displayed()[0],n).submit()}else{i.cell.data(n);r.draw(false)}}})},_columns:function(){var e=this.s.dt;var t=e.columns(this.c.columns).indexes();var i=[];e.columns(":visible").every(function(e){if(t.indexOf(e)!==-1){i.push(e)}});return i},_editor:function(e,t,i){var a=this;var s=this.s.dt;var n=this.c.editor;var r=this.s.lastFocus.cell;if(h("div.DTE",r.node()).length){return}if(e!==null&&(e>=0&&e<=9||e===11||e===12||e>=14&&e<=31||e>=112&&e<=123||e>=127&&e<=159)){return}t.stopPropagation();if(e===13){t.preventDefault()}var l=function(){n.one("open.keyTable",function(){n.off("cancelOpen.keyTable");if(!i){h("div.DTE_Field_InputControl input, div.DTE_Field_InputControl textarea").select()}s.keys.enable(i?"tab-only":"navigation-only");s.on("key-blur.editor",function(){if(n.displayed()){n.submit()}});if(i){h(s.table().container()).addClass("dtk-focus-alt")}n.on("submitUnsuccessful.keyTable",function(){a._focus(r,null,false)});n.one("close",function(){s.keys.enable(true);s.off("key-blur.editor");n.off(".keyTable");h(s.table().container()).removeClass("dtk-focus-alt")})}).one("cancelOpen.keyTable",function(){n.off(".keyTable")}).inline(r.index())};if(e===13){i=true;h(p).one("keyup",function(){l()})}else{l()}},_emitEvent:function(i,a){this.s.dt.iterator("table",function(e,t){h(e.nTable).triggerHandler(i,a)})},_focus:function(e,t,i,a){var s=this;var n=this.s.dt;var r=n.page.info();var l=this.s.lastFocus;if(!a){a=null}if(!this.s.enable){return}if(typeof e!=="number"){if(!e.any()){return}var o=e.index();t=o.column;e=n.rows({filter:"applied",order:"applied"}).indexes().indexOf(o.row);if(e<0){return}if(r.serverSide){e+=r.start}}if(r.length!==-1&&(e<r.start||e>=r.start+r.length)){this.s.focusDraw=true;this.s.waitingForDraw=true;n.one("draw",function(){s.s.focusDraw=false;s.s.waitingForDraw=false;s._focus(e,t,y,a)}).page(Math.floor(e/r.length)).draw(false);return}if(h.inArray(t,this._columns())===-1){return}if(r.serverSide){e-=r.start}var u=n.cells(null,t,{search:"applied",order:"applied"}).flatten();var f=n.cell(u[e]);if(l){if(l.node===f.node()){this._emitEvent("key-refocus",[this.s.dt,f,a||null]);return}this._blur()}var c=h(f.node());c.addClass(this.c.className);this._updateFixedColumns(t);if(i===y||i===true){this._scroll(h(v),h(p.body),c,"offset");var d=n.table().body().parentNode;if(d!==n.table().header().parentNode){var b=h(d.parentNode);this._scroll(b,b,c,"position")}}this.s.lastFocus={cell:f,node:f.node(),relative:{row:n.rows({page:"current"}).indexes().indexOf(f.index().row),column:f.index().column}};this._emitEvent("key-focus",[this.s.dt,f,a||null]);n.state.save()},_key:function(e){if(this.s.waitingForDraw){e.preventDefault();return}var t=this.s.enable;var i=t===true||t==="navigation-only";if(!t){return}if((e.keyCode===0||e.ctrlKey||e.metaKey||e.altKey)&&!(e.ctrlKey&&e.altKey)){return}var a=this.s.lastFocus;if(!a){return}var s=this;var n=this.s.dt;var r=this.s.dt.settings()[0].oScroll.sY?true:false;if(this.c.keys&&h.inArray(e.keyCode,this.c.keys)===-1){return}switch(e.keyCode){case 9:this._shift(e,e.shiftKey?"left":"right",true);break;case 27:if(this.s.blurable&&t===true){this._blur()}break;case 33:case 34:if(i&&!r){e.preventDefault();n.page(e.keyCode===33?"previous":"next").draw(false)}break;case 35:case 36:if(i){e.preventDefault();var l=n.cells({page:"current"}).indexes();var o=this._columns();this._focus(n.cell(l[e.keyCode===35?l.length-1:o[0]]),null,true,e)}break;case 37:if(i){this._shift(e,"left")}break;case 38:if(i){this._shift(e,"up")}break;case 39:if(i){this._shift(e,"right")}break;case 40:if(i){this._shift(e,"down")}break;default:if(t===true){this._emitEvent("key",[n,e.keyCode,this.s.lastFocus.cell,e])}break}},_scroll:function(e,t,i,a){var s=i[a]();var n=i.outerHeight();var r=i.outerWidth();var l=t.scrollTop();var o=t.scrollLeft();var u=e.height();var f=e.width();if(a==="position"){s.top+=parseInt(i.closest("table").css("top"),10)}if(s.top<l){t.scrollTop(s.top)}if(s.left<o){t.scrollLeft(s.left)}if(s.top+n>l+u&&n<u){t.scrollTop(s.top+n-u)}if(s.left+r>o+f&&r<f){t.scrollLeft(s.left+r-f)}},_shift:function(e,t,i){var a=this;var s=this.s.dt;var n=s.page.info();var r=n.recordsDisplay;var l=this.s.lastFocus.cell;var o=this._columns();if(!l){return}var u=s.rows({filter:"applied",order:"applied"}).indexes().indexOf(l.index().row);if(n.serverSide){u+=n.start}var f=s.columns(o).indexes().indexOf(l.index().column);var c=u,d=o[f];if(t==="right"){if(f>=o.length-1){c++;d=o[0]}else{d=o[f+1]}}else if(t==="left"){if(f===0){c--;d=o[o.length-1]}else{d=o[f-1]}}else if(t==="up"){c--}else if(t==="down"){c++}if(c>=0&&c<r&&h.inArray(d,o)!==-1){e.preventDefault();this._focus(c,d,true,e)}else if(!i||!this.c.blurable){e.preventDefault()}else{this._blur()}},_tabInput:function(){var t=this;var i=this.s.dt;var e=this.c.tabIndex!==null?this.c.tabIndex:i.settings()[0].iTabIndex;if(e==-1){return}var a=h('<div><input type="text" tabindex="'+e+'"></div>').css({position:"absolute",height:1,width:0,overflow:"hidden"}).insertBefore(i.table().node());a.children().on("focus",function(e){if(i.cell(":eq(0)",{page:"current"}).any()){t._focus(i.cell(":eq(0)","0:visible",{page:"current"}),null,true,e)}})},_updateFixedColumns:function(e){var t=this.s.dt;var i=t.settings()[0];if(i._oFixedColumns){var a=i._oFixedColumns.s.iLeftColumns;var s=i.aoColumns.length-i._oFixedColumns.s.iRightColumns;if(e<a||e>=s){t.fixedColumns().update()}}}});l.defaults={blurable:true,className:"focus",clipboard:true,clipboardOrthogonal:"display",columns:"",editor:null,editOnFocus:false,focus:null,keys:null,tabIndex:null};l.version="2.5.0";h.fn.dataTable.KeyTable=l;h.fn.DataTable.KeyTable=l;r.Api.register("cell.blur()",function(){return this.iterator("table",function(e){if(e.keytable){e.keytable.blur()}})});r.Api.register("cell().focus()",function(){return this.iterator("cell",function(e,t,i){if(e.keytable){e.keytable.focus(t,i)}})});r.Api.register("keys.disable()",function(){return this.iterator("table",function(e){if(e.keytable){e.keytable.enable(false)}})});r.Api.register("keys.enable()",function(t){return this.iterator("table",function(e){if(e.keytable){e.keytable.enable(t===y?true:t)}})});r.ext.selector.cell.push(function(e,t,i){var a=t.focused;var s=e.keytable;var n=[];if(!s||a===y){return i}for(var r=0,l=i.length;r<l;r++){if(a===true&&s.focused(i[r])||a===false&&!s.focused(i[r])){n.push(i[r])}}return n});h(p).on("preInit.dt.dtk",function(e,t,i){if(e.namespace!=="dt"){return}var a=t.oInit.keys;var s=r.defaults.keys;if(a||s){var n=h.extend({},s,a);if(a!==false){new l(t,n)}}});return l});
// #END
