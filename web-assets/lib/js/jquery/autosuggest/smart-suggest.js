// JS-Script (UM): smart-suggest.js @ 2022-09-20 09:50:58 +0000
const SmartAutoSuggest=new class{constructor(){const _N$="SmartAutoSuggest";const _C$=this;const _p$=console;let SECURED=false;_C$.secureClass=()=>{if(SECURED===true){_p$.warn(_N$,"Class is already SECURED")}else{SECURED=true;Object.freeze(_C$)}};const $=jQuery;const _Utils$=smartJ$Utils;const bindToInput=function(e,t,A,s,i,l,o,a){o=_Utils$.format_number_int(o,false);if(o<0){o=0}if(o>255){o=255}const n=$("#"+t);n.attr("autocomplete","off");if(A!=""&&A!=null){n.attr("placeholder",A)}if(e==="multilist"){i=false}let r=null;if(i===true){$('<button id="'+t+'-AutosuggestBttnAction" data-status="closed">...</button>').insertAfter("#"+t);r=$("#"+t+"-AutosuggestBttnAction").click(()=>{const t=$("#Smart_Suggest_Container").attr("data-status");if(t=="closed"){AutoSuggestAction(n,e,l,s,o,a)}else{AutoSuggestHide()}})}else{if(o<1){o=1}}const g=38;const u=40;const c=13;const d=9;const S=27;let f=null;n.dblclick(t=>{$(t.currentTarget).val("")}).blur(()=>{if(i!==true){setTimeout(()=>{AutoSuggestHide()},500)}}).bind("keydown",t=>{if(t.keyCode!=c&&t.keyCode!=u&&t.keyCode!=g&&t.keyCode!=d&&t.keyCode!=S){if(r===null){if(f!=null){clearTimeout(f)}f=setTimeout(()=>{f=null;AutoSuggestAction(n,e,l,s,o,a)},500)}}else{t.preventDefault()}if(t.keyCode==c||t.keyCode==u){AutoSuggestAction(n,e,l,s,o,a)}return t.keyCode!=c});return n};_C$.bindToInput=bindToInput;const handleSelection=function(y_type,y_id,id,value,label,data,evcode){if(y_type==="multilist"){$("#"+y_id).val(_Utils$.addToList(value,$("#"+y_id).val(),","))}else{$("#"+y_id).val(value)}_Utils$.evalJsFxCode(_N$+".handleSelection",typeof evcode==="function"?()=>{"use strict";evcode(id,value,label,data)}:()=>{"use strict";!!evcode?eval(evcode):null});setTimeout(()=>{AutoSuggestHide()},100)};_C$.handleSelection=handleSelection;const AutoSuggestShow=function(t,e,A){if(e==undefined||e==""){e="auto"}else{e=_Utils$.format_number_int(e,false);if(e<50){e=50}else if(e>920){e=920}e=e+"px"}const s=t.offset();$("#Smart_Suggest_Container").css({position:"fixed",top:_Utils$.format_number_int(s.top-$(window).scrollTop())+t.outerHeight()+1+"px",left:_Utils$.format_number_int(s.left-$(window).scrollLeft())+"px",width:e,"min-width":"25px","max-width":"920px",height:"auto","min-height":"25px","max-height":"225px",overflow:"auto","z-index":9e3,"text-align":"left"}).show().attr("data-status","opened").empty().html(A)};const AutoSuggestHide=()=>{$("#Smart_Suggest_Container").css({position:"fixed",top:"-50px",left:"-50px",width:"1px",height:"1px","z-index":1}).empty().html("").attr("data-status","closed").hide()};const AutoSuggestAction=function(e,o,a,t,A,n){const s=String(_Utils$.arrayGetLast(_Utils$.stringSplitbyComma(e.val())));if(s.length<A){return}const r=String(e.attr("id")||"");if(!r){return}const i=String(String(t)+String(_Utils$.escape_url(s)));const l="POST";const g='<table width="100%" border="0" cellpadding="0" cellspacing="0">';const u="</table>";const c="data:image/gif;base64,R0lGODlhEAAQAPQAAN7n7MRCQtzi58hlZ9GXmcRFRcdaW9nM0NSussZQUM+OkM6DhdvV2dKkp9jCxcpwccx5egAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAkKAAAALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkECQoAAAAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkECQoAAAAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAkKAAAALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAkKAAAALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA==";AutoSuggestShow(e,a,'<div><center><img src="'+_Utils$.escape_html(c)+'"></center></div>');setTimeout(()=>{$.ajax({async:true,cache:false,timeout:0,type:l,url:i,data:"",dataType:"json",success:A=>{if(!(A instanceof Array)){return}let s=1;for(let t=0;t<A.length;t++){if(A[t].label instanceof Array){s=Math.max(s,A[t].label.length)}}let i=0;let t=0;let l=g;for(let e=0;e<A.length;e++){l+='<tr valign="top" onclick="'+_Utils$.escape_html(String(_N$))+".handleSelection('"+_Utils$.escape_js(String(o))+"', '"+_Utils$.escape_js(String(r))+"', '"+_Utils$.escape_js(String(A[e].id))+"', '"+_Utils$.escape_js(String(A[e].value))+"', '"+_Utils$.escape_js(typeof A[e].label=="string"?String(A[e].label):JSON.stringify(A[e].label))+"', '"+_Utils$.escape_js(JSON.stringify(A[e].data))+"', ";if(typeof n==="function"){l+=String(n)}else{l+="'"+_Utils$.escape_js(n)+"'"}l+=');" title="'+_Utils$.escape_html(t+1)+'">';l+="<th>";l+=_Utils$.escape_html(A[e].id);l+="</th>";if(A[e].label instanceof Array){i=A[e].label.length;for(let t=0;t<i;t++){if(A[e].label[t].hasOwnProperty("color")){l+='<td style="color:'+_Utils$.escape_html(A[e].label[t].color)+'!important;">'+_Utils$.escape_html(A[e].label[t].text)+"</td>"}else{l+="<td>"+_Utils$.escape_html(A[e].label[t])+"</td>"}}}else{i=1;l+="<td>"+_Utils$.escape_html(A[e].label)+"</td>"}if(i<s){for(let t=0;t<s-i;t++){l+="<td>&nbsp;</td>"}}l+="</tr>";t+=1}l+=u;if(t>0){AutoSuggestShow(e,a,l)}else{AutoSuggestShow(e,a,g+"<tr><td> [No Matching Results] </td></tr>"+u)}t=0;l=""},error:t=>{AutoSuggestShow(e,a,'<div style="background:#FF3300;">ERROR (JS-Smart-Suggest): Invalid Server Response !<br>'+$("<div>"+t.responseText+"</div>").text()+"</div>")}})},250)};$(()=>{$("body").append('\x3c!-- SmartJS.AutoSuggest :: Start --\x3e<div id="Smart_Suggest_Container"></div>\x3c!-- END: SmartJS.AutoSuggest --\x3e');AutoSuggestHide()})}};SmartAutoSuggest.secureClass();window.SmartAutoSuggest=SmartAutoSuggest;
// #END
