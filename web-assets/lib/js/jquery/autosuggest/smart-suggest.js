// JS-Script (US): smart-suggest.js @ 2022-10-19 22:05:20 +0000
const SmartAutoSuggest=new class{constructor(){const _N$="SmartAutoSuggest";const _C$=this;const _p$=console;let SECURED=false;_C$.secureClass=()=>{if(SECURED===true){_p$.warn(_N$,"Class is already SECURED")}else{SECURED=true;Object.freeze(_C$)}};const $=jQuery;const _Utils$=smartJ$Utils;const bindToInput=function(y_type,y_id,y_txt,y_res_url,y_use_bttn,y_size,min_term_len,evcode){min_term_len=_Utils$.format_number_int(min_term_len,false);if(min_term_len<0){min_term_len=0}if(min_term_len>255){min_term_len=255}const input=$("#"+y_id);input.attr("autocomplete","off");if(y_txt!=""&&y_txt!=null){input.attr("placeholder",y_txt)}if(y_type==="multilist"){y_use_bttn=false}let bttn=null;if(y_use_bttn===true){$('<button id="'+y_id+'-AutosuggestBttnAction" data-status="closed">...</button>').insertAfter("#"+y_id);bttn=$("#"+y_id+"-AutosuggestBttnAction").click(()=>{const status=$("#Smart_Suggest_Container").attr("data-status");if(status=="closed"){AutoSuggestAction(input,y_type,y_size,y_res_url,min_term_len,evcode)}else{AutoSuggestHide()}})}else{if(min_term_len<1){min_term_len=1}}const arrow_up=38;const arrow_down=40;const enter=13;const tab=9;const esc=27;let globalTimeout=null;input.dblclick(e=>{$(e.currentTarget).val("")}).blur(()=>{if(y_use_bttn!==true){setTimeout(()=>{AutoSuggestHide()},500)}}).bind("keydown",evt=>{if(evt.keyCode!=enter&&evt.keyCode!=arrow_down&&evt.keyCode!=arrow_up&&evt.keyCode!=tab&&evt.keyCode!=esc){if(bttn===null){if(globalTimeout!=null){clearTimeout(globalTimeout)}globalTimeout=setTimeout(()=>{globalTimeout=null;AutoSuggestAction(input,y_type,y_size,y_res_url,min_term_len,evcode)},500)}}else{evt.preventDefault()}if(evt.keyCode==enter||evt.keyCode==arrow_down){AutoSuggestAction(input,y_type,y_size,y_res_url,min_term_len,evcode)}return evt.keyCode!=enter});return input};_C$.bindToInput=bindToInput;const handleSelection=function(y_type,y_id,id,value,label,data,evcode){if(y_type==="multilist"){$("#"+y_id).val(_Utils$.addToList(value,$("#"+y_id).val(),","))}else{$("#"+y_id).val(value)}_Utils$.evalJsFxCode(_N$+".handleSelection",typeof evcode==="function"?()=>{"use strict";evcode(id,value,label,data)}:()=>{"use strict";!!evcode?eval(evcode):null});setTimeout(()=>{AutoSuggestHide()},100)};_C$.handleSelection=handleSelection;const AutoSuggestShow=function(input,size,html){if(size==undefined||size==""){size="auto"}else{size=_Utils$.format_number_int(size,false);if(size<50){size=50}else if(size>920){size=920}size=size+"px"}const offset=input.offset();$("#Smart_Suggest_Container").css({position:"fixed",top:_Utils$.format_number_int(offset.top-$(window).scrollTop())+input.outerHeight()+1+"px",left:_Utils$.format_number_int(offset.left-$(window).scrollLeft())+"px",width:size,"min-width":"25px","max-width":"920px",height:"auto","min-height":"25px","max-height":"225px",overflow:"auto","z-index":9e3,"text-align":"left"}).show().attr("data-status","opened").empty().html(html)};const AutoSuggestHide=()=>{$("#Smart_Suggest_Container").css({position:"fixed",top:"-50px",left:"-50px",width:"1px",height:"1px","z-index":1}).empty().html("").attr("data-status","closed").hide()};const AutoSuggestAction=function(input,y_type,y_size,y_res_url,min_term_len,evcode){const typedTxt=String(_Utils$.arrayGetLast(_Utils$.stringSplitbyComma(input.val())));if(typedTxt.length<min_term_len){return}const theID=String(input.attr("id")||"");if(!theID){return}const url=String(String(y_res_url)+String(_Utils$.escape_url(typedTxt)));const method="POST";const table_code_start='<table width="100%" border="0" cellpadding="0" cellspacing="0">';const table_code_end="</table>";const theImg="data:image/gif;base64,R0lGODlhEAAQAPQAAN7n7MRCQtzi58hlZ9GXmcRFRcdaW9nM0NSussZQUM+OkM6DhdvV2dKkp9jCxcpwccx5egAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAkKAAAALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkECQoAAAAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkECQoAAAAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAkKAAAALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAkKAAAALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA==";AutoSuggestShow(input,y_size,'<div><center><img src="'+_Utils$.escape_html(theImg)+'"></center></div>');setTimeout(()=>{$.ajax({async:true,cache:false,timeout:0,type:method,url:url,data:"",dataType:"json",success:answer=>{if(!(answer instanceof Array)){return}let extcols=1;for(let i=0;i<answer.length;i++){if(answer[i].label instanceof Array){extcols=Math.max(extcols,answer[i].label.length)}}let cols=0;let el=0;let suggest=table_code_start;for(let i=0;i<answer.length;i++){suggest+='<tr valign="top" onclick="'+_Utils$.escape_html(String(_N$))+".handleSelection('"+_Utils$.escape_js(String(y_type))+"', '"+_Utils$.escape_js(String(theID))+"', '"+_Utils$.escape_js(String(answer[i].id))+"', '"+_Utils$.escape_js(String(answer[i].value))+"', '"+_Utils$.escape_js(typeof answer[i].label=="string"?String(answer[i].label):JSON.stringify(answer[i].label))+"', '"+_Utils$.escape_js(JSON.stringify(answer[i].data))+"', ";if(typeof evcode==="function"){suggest+=String(evcode)}else{suggest+="'"+_Utils$.escape_js(evcode)+"'"}suggest+=');" title="'+_Utils$.escape_html(el+1)+'">';suggest+="<th>";suggest+=_Utils$.escape_html(answer[i].id);suggest+="</th>";if(answer[i].label instanceof Array){cols=answer[i].label.length;for(let j=0;j<cols;j++){if(answer[i].label[j].hasOwnProperty("color")){suggest+='<td style="color:'+_Utils$.escape_html(answer[i].label[j].color)+'!important;">'+_Utils$.escape_html(answer[i].label[j].text)+"</td>"}else{suggest+="<td>"+_Utils$.escape_html(answer[i].label[j])+"</td>"}}}else{cols=1;suggest+="<td>"+_Utils$.escape_html(answer[i].label)+"</td>"}if(cols<extcols){for(let k=0;k<extcols-cols;k++){suggest+="<td>&nbsp;</td>"}}suggest+="</tr>";el+=1}suggest+=table_code_end;if(el>0){AutoSuggestShow(input,y_size,suggest)}else{AutoSuggestShow(input,y_size,table_code_start+"<tr><td> [No Matching Results] </td></tr>"+table_code_end)}el=0;suggest=""},error:answer=>{AutoSuggestShow(input,y_size,'<div style="background:#FF3300;">ERROR (JS-Smart-Suggest): Invalid Server Response !<br>'+$("<div>"+answer.responseText+"</div>").text()+"</div>")}})},250)};$(()=>{$("body").append('\x3c!-- SmartJS.AutoSuggest :: Start --\x3e<div id="Smart_Suggest_Container"></div>\x3c!-- END: SmartJS.AutoSuggest --\x3e');AutoSuggestHide()})}};SmartAutoSuggest.secureClass();window.SmartAutoSuggest=SmartAutoSuggest;
// #END
