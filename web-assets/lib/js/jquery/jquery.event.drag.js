// JS-Script (UM): jquery.event.drag.js @ 2022-09-20 09:51:14 +0000
(function(g){g.fn.drag=function(e,t,a){var r=typeof e=="string"?e:"",n=g.isFunction(e)?e:g.isFunction(t)?t:null;if(r.indexOf("drag")!==0)r="drag"+r;a=(e==n?t:a)||{};return n?this.on(r,a,n):this.trigger(r)};var h=g.event,r=h.special,v=r.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:false,drop:true,click:false},datakey:"dragdata",noBubble:true,add:function(e){var a=g.data(this,v.datakey),r=e.data||{};a.related+=1;g.each(v.defaults,function(e,t){if(r[e]!==undefined)a[e]=r[e]})},remove:function(){g.data(this,v.datakey).related-=1},setup:function(){if(g.data(this,v.datakey))return;var e=g.extend({related:0},v.defaults);g.data(this,v.datakey,e);h.add(this,"touchstart mousedown",v.init,e);if(this.attachEvent)this.attachEvent("ondragstart",v.dontstart)},teardown:function(){var e=g.data(this,v.datakey)||{};if(e.related)return;g.removeData(this,v.datakey);h.remove(this,"touchstart mousedown",v.init);v.textselect(true);if(this.detachEvent)this.detachEvent("ondragstart",v.dontstart)},init:function(e){if(v.touched)return;var t=e.data,a;if(e.which!=0&&t.which>0&&e.which!=t.which)return;if(g(e.target).is(t.not))return;if(t.handle&&!g(e.target).closest(t.handle,e.currentTarget).length)return;v.touched=e.type=="touchstart"?this:null;t.propagates=1;t.mousedown=this;t.interactions=[v.interaction(this,t)];t.target=e.target;t.pageX=e.pageX;t.pageY=e.pageY;t.dragging=null;a=v.hijack(e,"draginit",t);if(!t.propagates)return;a=v.flatten(a);if(a&&a.length){t.interactions=[];g.each(a,function(){t.interactions.push(v.interaction(this,t))})}t.propagates=t.interactions.length;if(t.drop!==false&&r.drop)r.drop.handler(e,t);v.textselect(false);if(v.touched)h.add(v.touched,"touchmove touchend",v.handler,t);else h.add(document,"mousemove mouseup",v.handler,t);if(!v.touched||t.live)return false},interaction:function(e,t){var a=e&&e.ownerDocument?g(e)[t.relative?"position":"offset"]()||{top:0,left:0}:{top:0,left:0};return{drag:e,callback:new v.callback,droppable:[],offset:a}},handler:function(e){var t=e.data;switch(e.type){case!t.dragging&&"touchmove":e.preventDefault();case!t.dragging&&"mousemove":if(Math.pow(e.pageX-t.pageX,2)+Math.pow(e.pageY-t.pageY,2)<Math.pow(t.distance,2))break;e.target=t.target;v.hijack(e,"dragstart",t);if(t.propagates)t.dragging=true;case"touchmove":e.preventDefault();case"mousemove":if(t.dragging){v.hijack(e,"drag",t);if(t.propagates){if(t.drop!==false&&r.drop)r.drop.handler(e,t);break}e.type="mouseup"}case"touchend":case"mouseup":default:if(v.touched)h.remove(v.touched,"touchmove touchend",v.handler);else h.remove(document,"mousemove mouseup",v.handler);if(t.dragging){if(t.drop!==false&&r.drop)r.drop.handler(e,t);v.hijack(e,"dragend",t)}v.textselect(true);if(t.click===false&&t.dragging)g.data(t.mousedown,"suppress.click",(new Date).getTime()+5);t.dragging=v.touched=false;break}},hijack:function(a,r,n,e,t){if(!n)return;var i={event:a.originalEvent,type:a.type},o=r.indexOf("drop")?"drag":"drop",d,s=e||0,l,u,c,p=!isNaN(e)?e:n.interactions.length;a.type=r;var f=function(){};a.originalEvent=new jQuery.Event(i.event,{preventDefault:f,stopPropagation:f,stopImmediatePropagation:f});n.results=[];do{if(l=n.interactions[s]){if(r!=="dragend"&&l.cancelled)continue;c=v.properties(a,n,l);l.results=[];g(t||l[o]||n.droppable).each(function(e,t){c.target=t;a.isPropagationStopped=function(){return false};d=t?h.dispatch.call(t,a,c):null;if(d===false){if(o=="drag"){l.cancelled=true;n.propagates-=1}if(r=="drop"){l[o][e]=null}}else if(r=="dropinit")l.droppable.push(v.element(d)||t);if(r=="dragstart")l.proxy=g(v.element(d)||l.drag)[0];l.results.push(d);delete a.result;if(r!=="dropinit")return d});n.results[s]=v.flatten(l.results);if(r=="dropinit")l.droppable=v.flatten(l.droppable);if(r=="dragstart"&&!l.cancelled)c.update()}}while(++s<p);a.type=i.type;a.originalEvent=i.event;return v.flatten(n.results)},properties:function(e,t,a){var r=a.callback;r.drag=a.drag;r.proxy=a.proxy||a.drag;r.startX=t.pageX;r.startY=t.pageY;r.deltaX=e.pageX-t.pageX;r.deltaY=e.pageY-t.pageY;r.originalX=a.offset.left;r.originalY=a.offset.top;r.offsetX=r.originalX+r.deltaX;r.offsetY=r.originalY+r.deltaY;r.drop=v.flatten((a.drop||[]).slice());r.available=v.flatten((a.droppable||[]).slice());return r},element:function(e){if(e&&(e.jquery||e.nodeType==1))return e},flatten:function(e){return g.map(e,function(e){return e&&e.jquery?g.makeArray(e):e&&e.length?v.flatten(e):e})},textselect:function(e){g(document)[e?"off":"on"]("selectstart",v.dontstart).css("MozUserSelect",e?"":"none");document.unselectable=e?"off":"on"},dontstart:function(){return false},callback:function(){}};v.callback.prototype={update:function(){if(r.drop&&this.available.length)g.each(this.available,function(e){r.drop.locate(this,e)})}};var t=h.dispatch;h.dispatch=function(e){if(g.data(this,"suppress."+e.type)-(new Date).getTime()>0){g.removeData(this,"suppress."+e.type);return}return t.apply(this,arguments)};r.draginit=r.dragstart=r.dragend=v})(jQuery);
// #END
