// JS-Script (UM): mathquill.js @ 2023-11-25 11:00:49 +0000
(function(){var I=window.jQuery,p,z="mathquill-command-id",d="mathquill-block-id",M=Math.min,B=Math.max;function x(){}var F=[].slice;function $(i){var n=i.length-1;return function(){var t=F.call(arguments,0,n);var e=F.call(arguments,n);return i.apply(this,t.concat([e]))}}var N=$(function(i,n){return $(function(t,e){if(i in t){return t[i].apply(t,n.concat(e))}})});function P(n){return $(function(e,i){if(typeof e!=="function"){e=N(e)}var t=function(t){return e.apply(t,[t].concat(i))};return n.call(this,t)})}function r(t){var e=F.call(arguments,1);return function(){return t.apply(this,e)}}function g(t,e){if(!e){throw new Error("prayer failed: "+t)}}var n=function(l,c,u){function f(t){return typeof t==="object"}function h(t){return typeof t==="function"}function p(){}return function e(i,t){if(t===u){t=i;i=Object}function n(){var t=new r;if(h(t.init)){t.init.apply(t,arguments)}return t}function r(){}n.Bare=r;var s=p[l]=i[l];var a=r[l]=n[l]=n.p=new p;var o;a.constructor=n;n.mixin=function(t){r[l]=n[l]=e(n,t)[l];return n};return(n.open=function(t){o={};if(h(t)){o=t.call(n,a,s,n,i)}else if(f(t)){o=t}if(f(o)){for(var e in o){if(c.call(o,e)){a[e]=o[e]}}}if(!h(a.init)){a.init=i}return n})(t)}}("prototype",{}.hasOwnProperty);var m=-1;var b=1;function o(t){g("a direction was passed",t===m||t===b)}var v=n(I,function(t){t.insDirOf=function(t,e){return t===m?this.insertBefore(e.first()):this.insertAfter(e.last())};t.insAtDirEnd=function(t,e){return t===m?this.prependTo(e):this.appendTo(e)}});var f=n(function(t){t.parent=0;t[m]=0;t[b]=0;t.init=function(t,e,i){this.parent=t;this[m]=e;this[b]=i};this.copy=function(t){return f(t.parent,t[m],t[b])}});var w=n(function(t){t[m]=0;t[b]=0;t.parent=0;var e=0;function i(){return e+=1}this.byId={};t.init=function(){this.id=i();w.byId[this.id]=this;this.ends={};this.ends[m]=0;this.ends[b]=0};t.dispose=function(){delete w.byId[this.id]};t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"};t.jQ=v();t.jQadd=function(t){return this.jQ=this.jQ.add(t)};t.jQize=function(t){var t=v(t||this.html());function n(t){if(t.getAttribute){var e=t.getAttribute("mathquill-command-id");var i=t.getAttribute("mathquill-block-id");if(e){w.byId[e].jQadd(t)}if(i){w.byId[i].jQadd(t)}}for(t=t.firstChild;t;t=t.nextSibling){n(t)}}for(var e=0;e<t.length;e+=1){n(t[e])}return t};t.createDir=function(t,e){o(t);var i=this;i.jQize();i.jQ.insDirOf(t,e.jQ);e[t]=i.adopt(e.parent,e[m],e[b]);return i};t.createLeftOf=function(t){return this.createDir(m,t)};t.selectChildren=function(t,e){return H(t,e)};t.bubble=P(function(t){for(var e=this;e;e=e.parent){var i=t(e);if(i===false){break}}return this});t.postOrder=P(function(i){(function t(e){e.eachChild(t);i(e)})(this);return this});t.isEmpty=function(){return this.ends[m]===0&&this.ends[b]===0};t.children=function(){return q(this.ends[m],this.ends[b])};t.eachChild=function(){var t=this.children();t.each.apply(t,arguments);return this};t.foldChildren=function(t,e){return this.children().fold(t,e)};t.withDirAdopt=function(t,e,i,n){q(this,this).withDirAdopt(t,e,i,n);return this};t.adopt=function(t,e,i){q(this,this).adopt(t,e,i);return this};t.disown=function(){q(this,this).disown();return this};t.remove=function(){this.jQ.remove();this.postOrder("dispose");return this.disown()}});function U(t,e,i){g("a parent is always present",t);g("leftward is properly set up",function(){if(!e){return t.ends[m]===i}return e[b]===i&&e.parent===t}());g("rightward is properly set up",function(){if(!i){return t.ends[b]===e}return i[m]===e&&i.parent===t}())}var q=n(function(t){t.init=function(t,e,i){if(i===p){i=m}o(i);g("no half-empty fragments",!t===!e);this.ends={};if(!t){return}g("withDir is passed to Fragment",t instanceof w);g("oppDir is passed to Fragment",e instanceof w);g("withDir and oppDir have the same parent",t.parent===e.parent);this.ends[i]=t;this.ends[-i]=e;var n=this.fold([],function(t,e){t.push.apply(t,e.jQ.get());return t});this.jQ=this.jQ.add(n)};t.jQ=v();t.withDirAdopt=function(t,e,i,n){return t===m?this.adopt(e,i,n):this.adopt(e,n,i)};t.adopt=function(e,i,t){U(e,i,t);var n=this;n.disowned=false;var r=n.ends[m];if(!r){return this}var s=n.ends[b];if(i){}else{e.ends[m]=r}if(t){t[m]=s}else{e.ends[b]=s}n.ends[b][b]=t;n.each(function(t){t[m]=i;t.parent=e;if(i){i[b]=t}i=t});return n};t.disown=function(){var t=this;var e=t.ends[m];if(!e||t.disowned){return t}t.disowned=true;var i=t.ends[b];var n=e.parent;U(n,e[m],e);U(n,i,i[b]);if(e[m]){e[m][b]=i[b]}else{n.ends[m]=i[b]}if(i[b]){i[b][m]=e[m]}else{n.ends[b]=e[m]}return t};t.remove=function(){this.jQ.remove();this.each("postOrder","dispose");return this.disown()};t.each=P(function(t){var e=this;var i=e.ends[m];if(!i){return e}for(;i!==e.ends[b][b];i=i[b]){var n=t(i);if(n===false){break}}return e});t.fold=function(e,i){this.each(function(t){e=i.call(this,e,t)});return e}});var y={},s={};var W=n(f,function(t){t.init=function(t,e){this.parent=t;this.options=e;var i=this.jQ=this._jQ=v('<span class="mq-cursor">&#8203;</span>');this.blink=function(){i.toggleClass("mq-blink")};this.upDownCache={}};t.show=function(){this.jQ=this._jQ.removeClass("mq-blink");if("intervalId"in this){clearInterval(this.intervalId)}else{if(this[b]){if(this.selection&&this.selection.ends[m][m]===this[m]){this.jQ.insertBefore(this.selection.jQ)}else{this.jQ.insertBefore(this[b].jQ.first())}}else{this.jQ.appendTo(this.parent.jQ)}this.parent.focus()}this.intervalId=setInterval(this.blink,500);return this};t.hide=function(){if("intervalId"in this){clearInterval(this.intervalId)}delete this.intervalId;this.jQ.detach();this.jQ=v();return this};t.withDirInsertAt=function(t,e,i,n){var r=this.parent;this.parent=e;this[t]=i;this[-t]=n;if(r!==e&&r.blur){r.blur()}};t.insDirOf=function(t,e){o(t);this.jQ.insDirOf(t,e.jQ);this.withDirInsertAt(t,e.parent,e[t],e);this.parent.jQ.addClass("mq-hasCursor");return this};t.insLeftOf=function(t){return this.insDirOf(m,t)};t.insRightOf=function(t){return this.insDirOf(b,t)};t.insAtDirEnd=function(t,e){o(t);this.jQ.insAtDirEnd(t,e.jQ);this.withDirInsertAt(t,e,0,e.ends[t]);e.focus();return this};t.insAtLeftEnd=function(t){return this.insAtDirEnd(m,t)};t.insAtRightEnd=function(t){return this.insAtDirEnd(b,t)};t.jumpUpDown=function(t,e){var i=this;i.upDownCache[t.id]=f.copy(i);var n=i.upDownCache[e.id];if(n){n[b]?i.insLeftOf(n[b]):i.insAtRightEnd(n.parent)}else{var r=i.offset().left;e.seek(r,i)}};t.offset=function(){var t=this,e=t.jQ.removeClass("mq-cursor").offset();t.jQ.addClass("mq-cursor");return e};t.unwrapGramp=function(){var e=this.parent.parent;var i=e.parent;var n=e[b];var t=this;var r=e[m];e.disown().eachChild(function(t){if(t.isEmpty()){return}t.children().adopt(i,r,n).each(function(t){t.jQ.insertBefore(e.jQ.first())});r=t.ends[b]});if(!this[b]){if(this[m]){this[b]=this[m][b]}else{while(!this[b]){this.parent=this.parent[b];if(this.parent){this[b]=this.parent.ends[m]}else{this[b]=e[b];this.parent=i;break}}}}if(this[b]){this.insLeftOf(this[b])}else{this.insAtRightEnd(i)}e.jQ.remove();if(e[m].siblingDeleted){e[m].siblingDeleted(t.options,b)}if(e[b].siblingDeleted){e[b].siblingDeleted(t.options,m)}};t.startSelection=function(){var t=this.anticursor=f.copy(this);var e=t.ancestors={};for(var i=t;i.parent;i=i.parent){e[i.parent.id]=i}};t.endSelection=function(){delete this.anticursor};t.select=function(){var t=this.anticursor;if(this[m]===t[m]&&this.parent===t.parent){return false}for(var e=this;e.parent;e=e.parent){if(e.parent.id in t.ancestors){var i=e.parent;break}}g("cursor and anticursor in the same tree",i);var n=t.ancestors[i.id];var r,s,a=b;if(e[m]!==n){for(var o=e;o;o=o[b]){if(o[b]===n[b]){a=m;r=e;s=n;break}}}if(a===b){r=n;s=e}if(r instanceof f){r=r[b]}if(s instanceof f){s=s[m]}this.hide().selection=i.selectChildren(r,s);this.insDirOf(a,this.selection.ends[a]);this.selectionChanged();return true};t.clearSelection=function(){if(this.selection){this.selection.clear();delete this.selection;this.selectionChanged()}return this};t.deleteSelection=function(){if(!this.selection){return}this[m]=this.selection.ends[m][m];this[b]=this.selection.ends[b][b];this.selection.remove();this.selectionChanged();delete this.selection};t.replaceSelection=function(){var t=this.selection;if(t){this[m]=t.ends[m][m];this[b]=t.ends[b][b];delete this.selection}return t}});var H=n(q,function(t,e){t.init=function(){e.init.apply(this,arguments);this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()};t.adopt=function(){this.jQ.replaceWith(this.jQ=this.jQ.children());return e.adopt.apply(this,arguments)};t.clear=function(){this.jQ.replaceWith(this.jQ[0].childNodes);return this};t.join=function(i){return this.fold("",function(t,e){return t+e[i]()})}});var c=n(function(t){t.init=function(t,e,i){this.id=t.id;this.data={};this.root=t;this.container=e;this.options=i;t.controller=this;this.cursor=t.cursor=W(t,i)};t.handle=function(t,e){var i=this.options.handlers;if(i&&i.fns[t]){var n=i.APIClasses[this.KIND_OF_MQ](this);if(e===m||e===b){i.fns[t](e,n)}else{i.fns[t](n)}}};var e=[];this.onNotify=function(t){e.push(t)};t.notify=function(){for(var t=0;t<e.length;t+=1){e[t].apply(this.cursor,arguments)}return this}});var u={},h=n(),G={},K=n(),Y={};function X(){if(window.console){console.warn("You are using the MathQuill API without specifying an interface version, "+"which will fail in v1.0.0. You can fix this easily by doing this before "+"doing anything else:\n"+"\n"+"    MathQuill = MathQuill.getInterface(1);\n"+"    // now MathQuill.MathField() works like it used to\n"+"\n"+'See also the "`dev` branch (2014\u20132015) \u2192 v0.10.0 Migration Guide" at\n'+"  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide")}}function i(t){X();return $t(t)}i.prototype=K.p;i.interfaceVersion=function(t){if(t!==1){throw"Only interface version 1 supported. You specified: "+t}X=function(){if(window.console){console.warn("You called MathQuill.interfaceVersion(1); to specify the interface "+"version, which will fail in v1.0.0. You can fix this easily by doing "+"this before doing anything else:\n"+"\n"+"    MathQuill = MathQuill.getInterface(1);\n"+"    // now MathQuill.MathField() works like it used to\n"+"\n"+'See also the "`dev` branch (2014\u20132015) \u2192 v0.10.0 Migration Guide" at\n'+"  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide")}};X();return i};i.getInterface=J;var Z=J.MIN=1,V=J.MAX=2;function J(a){if(!(Z<=a&&a<=V)){throw"Only interface versions between "+Z+" and "+V+" supported. You specified: "+a}function o(t){if(!t||!t.nodeType){return null}var e=v(t).children(".mq-root-block").attr(d);var i=e&&w.byId[e].controller;return i?l[i.KIND_OF_MQ](i):null}var l={};o.L=m;o.R=b;function e(t,e){if(e&&e.handlers){e.handlers={fns:e.handlers,APIClasses:l}}for(var i in e){if(e.hasOwnProperty(i)){var n=e[i],r=G[i];t[i]=r?r(n):n}}}o.config=function(t){e(h.p,t);return this};o.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t)){throw"Embed name must start with letter and be only letters and digits"}Y[t]=e};var t=l.AbstractMathQuill=n(K,function(t){t.init=function(t){this.__controller=t;this.__options=t.options;this.id=t.id;this.data=t.data};t.__mathquillify=function(t){var e=this.__controller,i=e.root,n=e.container;e.createTextarea();var r=n.addClass(t).contents().detach();i.jQ=v('<span class="mq-root-block"></span>').attr(d,i.id).appendTo(n);this.latex(r.text());this.revert=function(){return n.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(r)}};t.config=function(t){e(this.__options,t);return this};t.el=function(){return this.__controller.container[0]};t.text=function(){return this.__controller.exportText()};t.latex=function(t){if(arguments.length>0){this.__controller.renderLatexMath(t);if(this.__controller.blurred){this.__controller.cursor.hide().parent.blur()}return this}return this.__controller.exportLatex()};t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")};t.reflow=function(){this.__controller.root.postOrder("reflow");return this}});o.prototype=t.prototype;l.EditableField=n(t,function(t,e){t.__mathquillify=function(){e.__mathquillify.apply(this,arguments);this.__controller.editable=true;this.__controller.delegateMouseEvents();this.__controller.editablesTextareaEvents();return this};t.focus=function(){this.__controller.textarea.focus();return this};t.blur=function(){this.__controller.textarea.blur();return this};t.write=function(t){this.__controller.writeLatex(t);this.__controller.scrollHoriz();if(this.__controller.blurred){this.__controller.cursor.hide().parent.blur()}return this};t.cmd=function(t){var e=this.__controller.notify(),i=e.cursor;if(/^\\[a-z]+$/i.test(t)){t=t.slice(1);var n=y[t];if(n){t=n(t);if(i.selection){t.replaces(i.replaceSelection())}t.createLeftOf(i.show());this.__controller.scrollHoriz()}else{}}else{i.parent.write(i,t)}if(e.blurred){i.hide().parent.blur()}return this};t.select=function(){var t=this.__controller;t.notify("move").cursor.insAtRightEnd(t.root);while(t.cursor[m]){t.selectLeft()}return this};t.clearSelection=function(){this.__controller.cursor.clearSelection();return this};t.moveToDirEnd=function(t){this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root);return this};t.moveToLeftEnd=function(){return this.moveToDirEnd(m)};t.moveToRightEnd=function(){return this.moveToDirEnd(b)};t.keystroke=function(t){var t=t.replace(/^\s+|\s+$/g,"").split(/\s+/);for(var e=0;e<t.length;e+=1){this.__controller.keystroke(t[e],{preventDefault:x})}return this};t.typedText=function(t){for(var e=0;e<t.length;e+=1){this.__controller.typedText(t.charAt(e))}return this};t.dropEmbedded=function(t,e,i){var n=t-v(window).scrollLeft();var r=e-v(window).scrollTop();var s=document.elementFromPoint(n,r);this.__controller.seek(v(s),t,e);var a=Ft().setOptions(i);a.createLeftOf(this.__controller.cursor)}});o.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"};o.EditableField.prototype=l.EditableField.prototype;for(var i in u){(function(r,t){var s=l[r]=t(l);o[r]=function(t,e){var i=o(t);if(i instanceof s||!t||!t.nodeType){return i}var n=c(s.RootBlock(),v(t),h());n.KIND_OF_MQ=r;return s(n).__mathquillify(e,a)};o[r].prototype=s.prototype})(i,u[i])}return o}i.noConflict=function(){window.MathQuill=tt;return i};var tt=window.MathQuill;window.MathQuill=i;function et(t){var e="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" ");for(var i=0;i<e.length;i+=1){(function(e){t[e]=function(t){this.controller.handle(e,t)}})(e[i])}t.reflow=function(){this.controller.handle("reflow");this.controller.handle("edited");this.controller.handle("edit")}}var O=n(function(t,e,o){function i(t,e){if(t){t="'"+t+"'"}else{t="EOF"}throw"Parse Error: "+e+" at "+t}t.init=function(t){this._=t};t.parse=function(t){return this.skip(v)._(""+t,e,i);function e(t,e){return e}};t.or=function(r){g("or is passed a parser",r instanceof o);var s=this;return o(function(e,i,n){return s._(e,i,t);function t(t){return r._(e,i,n)}})};t.then=function(s){var i=this;return o(function(t,n,r){return i._(t,e,r);function e(t,e){var i=s instanceof o?s:s(e);g("a parser is returned",i instanceof o);return i._(t,n,r)}})};t.many=function(){var a=this;return o(function(i,t,e){var n=[];while(a._(i,r,s)){}return t(i,n);function r(t,e){i=t;n.push(e);return true}function s(){return false}})};t.times=function(u,f){if(arguments.length<2){f=u}var h=this;return o(function(i,t,e){var n=[];var r=true;var s;for(var a=0;a<u;a+=1){r=h._(i,o,l);if(!r){return e(i,s)}}for(;a<f&&r;a+=1){r=h._(i,o,c)}return t(i,n);function o(t,e){n.push(e);i=t;return true}function l(t,e){s=e;i=t;return false}function c(t,e){return false}})};t.result=function(t){return this.then(s(t))};t.atMost=function(t){return this.times(0,t)};t.atLeast=function(t){var i=this;return i.times(t).then(function(e){return i.many().map(function(t){return e.concat(t)})})};t.map=function(e){return this.then(function(t){return s(e(t))})};t.skip=function(e){return this.then(function(t){return e.result(t)})};var n=this.string=function(r){var s=r.length;var a="expected '"+r+"'";return o(function(t,e,i){var n=t.slice(0,s);if(n===r){return e(t.slice(s),n)}else{return i(t,a)}})};var r=this.regex=function(s){g("regexp parser is anchored",s.toString().charAt(1)==="^");var a="expected "+s;return o(function(t,e,i){var n=s.exec(t);if(n){var r=n[0];return e(t.slice(r.length),r)}else{return i(t,a)}})};var s=o.succeed=function(i){return o(function(t,e){return e(t,i)})};var a=o.fail=function(n){return o(function(t,e,i){return i(t,n)})};var l=o.letter=r(/^[a-z]/i);var c=o.letters=r(/^[a-z]*/i);var u=o.digit=r(/^[0-9]/);var f=o.digits=r(/^[0-9]*/);var h=o.whitespace=r(/^\s+/);var p=o.optWhitespace=r(/^\s*/);var d=o.any=o(function(t,e,i){if(!t){return i(t,"expected any character")}return e(t.slice(1),t.charAt(0))});var m=o.all=o(function(t,e,i){return e("",t)});var v=o.eof=o(function(t,e,i){if(t){return i(t,"expected EOF")}return e(t,t)})});var it=function(){var s={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};function q(t){var e=t.which||t.keyCode;var i=s[e];var n;var r=[];if(t.ctrlKey){r.push("Ctrl")}if(t.originalEvent&&t.originalEvent.metaKey){r.push("Meta")}if(t.altKey){r.push("Alt")}if(t.shiftKey){r.push("Shift")}n=i||String.fromCharCode(e);if(!r.length&&!i){return n}r.push(n);return r.join("-")}return function t(e,i){var n=null;var r=null;var s=I(e);var a=I(i.container||s);var o=x,l;function c(t){o=t;clearTimeout(l);l=setTimeout(t)}a.bind("keydown keypress input keyup focusout paste",function(t){o(t)});function u(t){o();o=x;clearTimeout(l);s.val(t);if(t&&s[0].select){s[0].select()}f=!!t}var f=false;function h(){var t=s[0];if(!("selectionStart"in t)){return false}return t.selectionStart!==t.selectionEnd}function p(){i.keystroke(q(n),n)}function d(t){n=t;r=null;if(f){c(function(t){if(!(t&&t.type==="focusout")&&s[0].select){s[0].select()}o=x;clearTimeout(l)})}p()}function m(t){if(n&&r){p()}r=t;c(v)}function v(){if(h()){return}var t=s.val();if(t.length===1){s.val("");i.typedText(t)}else if(t&&s[0].select){s[0].select()}}function g(){n=r=null}function b(t){s.focus();c(w)}function w(){var t=s.val();s.val("");if(t){i.paste(t)}}a.bind({keydown:d,keypress:m,focusout:g,paste:b});return{select:u}}}();c.open(function(t,e){t.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})}});c.open(function(t){t.focusBlurEvents=function(){var t=this,e=t.root,i=t.cursor;var n;t.textarea.focus(function(){t.blurred=false;clearTimeout(n);t.container.addClass("mq-focused");if(!i.parent){i.insAtRightEnd(e)}if(i.selection){i.selection.jQ.removeClass("mq-blur");t.selectionChanged()}else{i.show()}}).blur(function(){t.blurred=true;n=setTimeout(function(){e.postOrder("intentionalBlur");i.clearSelection().endSelection();s()});v(window).on("blur",r)});function r(){clearTimeout(n);if(i.selection){i.selection.jQ.addClass("mq-blur")}s()}function s(){i.hide().parent.blur();t.container.removeClass("mq-focused");v(window).off("blur",r)}t.blurred=true;i.hide().parent.blur()}});c.open(function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}});w.open(function(t){t.keystroke=function(t,e,i){var n=i.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":i.ctrlDeleteDir(m);break;case"Shift-Backspace":case"Backspace":i.backspace();break;case"Esc":case"Tab":i.escapeDir(b,t,e);return;case"Shift-Tab":case"Shift-Esc":i.escapeDir(m,t,e);return;case"End":i.notify("move").cursor.insAtRightEnd(n.parent);break;case"Ctrl-End":i.notify("move").cursor.insAtRightEnd(i.root);break;case"Shift-End":while(n[b]){i.selectRight()}break;case"Ctrl-Shift-End":while(n[b]||n.parent!==i.root){i.selectRight()}break;case"Home":i.notify("move").cursor.insAtLeftEnd(n.parent);break;case"Ctrl-Home":i.notify("move").cursor.insAtLeftEnd(i.root);break;case"Shift-Home":while(n[m]){i.selectLeft()}break;case"Ctrl-Shift-Home":while(n[m]||n.parent!==i.root){i.selectLeft()}break;case"Left":i.moveLeft();break;case"Shift-Left":i.selectLeft();break;case"Ctrl-Left":break;case"Right":i.moveRight();break;case"Shift-Right":i.selectRight();break;case"Ctrl-Right":break;case"Up":i.moveUp();break;case"Down":i.moveDown();break;case"Shift-Up":if(n[m]){while(n[m]){i.selectLeft()}}else{i.selectLeft()}case"Shift-Down":if(n[b]){while(n[b]){i.selectRight()}}else{i.selectRight()}case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":i.ctrlDeleteDir(b);break;case"Shift-Del":case"Del":i.deleteForward();break;case"Meta-A":case"Ctrl-A":i.notify("move").cursor.insAtRightEnd(i.root);while(n[m]){i.selectLeft()}break;default:return}e.preventDefault();i.scrollHoriz()};t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){g("overridden or never called on this node")}});c.open(function(t){this.onNotify(function(t){if(t==="move"||t==="upDown"){this.show().clearSelection()}});t.escapeDir=function(t,e,i){o(t);var n=this.cursor;if(n.parent!==this.root){i.preventDefault()}if(n.parent===this.root){return}n.parent.moveOutOf(t,n);return this.notify("move")};G.leftRightIntoCmdGoes=function(t){if(t&&t!=="up"&&t!=="down"){throw'"up" or "down" required for leftRightIntoCmdGoes option, '+'got "'+t+'"'}return t};t.moveDir=function(t){o(t);var e=this.cursor,i=e.options.leftRightIntoCmdGoes;if(e.selection){e.insDirOf(t,e.selection.ends[t])}else if(e[t]){e[t].moveTowards(t,e,i)}else{e.parent.moveOutOf(t,e,i)}return this.notify("move")};t.moveLeft=function(){return this.moveDir(m)};t.moveRight=function(){return this.moveDir(b)};t.moveUp=function(){return e(this,"up")};t.moveDown=function(){return e(this,"down")};function e(t,e){var i=t.notify("upDown").cursor;var n=e+"Into",r=e+"OutOf";if(i[b][n]){i.insAtLeftEnd(i[b][n])}else if(i[m][n]){i.insAtRightEnd(i[m][n])}else{i.parent.bubble(function(t){var e=t[r];if(e){if(typeof e==="function"){e=t[r](i)}if(e instanceof w){i.jumpUpDown(t,e)}if(e!==true){return false}}})}return t}this.onNotify(function(t){if(t!=="upDown"){this.upDownCache={}}});this.onNotify(function(t){if(t==="edit"){this.show().deleteSelection()}});t.deleteDir=function(t){o(t);var e=this.cursor;var i=e.selection;this.notify("edit");if(!i){if(e[t]){e[t].deleteTowards(t,e)}else{e.parent.deleteOutOf(t,e)}}if(e[m].siblingDeleted){e[m].siblingDeleted(e.options,b)}if(e[b].siblingDeleted){e[b].siblingDeleted(e.options,m)}e.parent.bubble("reflow");return this};t.ctrlDeleteDir=function(t){o(t);var e=this.cursor;if(!e[m]||e.selection){return ctrlr.deleteDir()}this.notify("edit");q(e.parent.ends[m],e[m]).remove();e.insAtDirEnd(m,e.parent);if(e[m].siblingDeleted){e[m].siblingDeleted(e.options,b)}if(e[b].siblingDeleted){e[b].siblingDeleted(e.options,m)}e.parent.bubble("reflow");return this};t.backspace=function(){return this.deleteDir(m)};t.deleteForward=function(){return this.deleteDir(b)};this.onNotify(function(t){if(t!=="select"){this.endSelection()}});t.selectDir=function(t){var e=this.notify("select").cursor,i=e.selection;o(t);if(!e.anticursor){e.startSelection()}var n=e[t];if(n){if(i&&i.ends[t]===n&&e.anticursor[-t]!==n){n.unselectInto(t,e)}else{n.selectTowards(t,e)}}else{e.parent.selectOutOf(t,e)}e.clearSelection();e.select()||e.show()};t.selectLeft=function(){return this.selectDir(m)};t.selectRight=function(){return this.selectDir(b)}});var k=function(){function t(t){var e=T();t.adopt(e,0,0);return e}function e(t){var e=t[0]||T();for(var i=1;i<t.length;i+=1){t[i].children().adopt(e,e.ends[b],0)}return e}var i=O.string;var n=O.regex;var r=O.letter;var s=O.any;var a=O.optWhitespace;var o=O.succeed;var l=O.fail;var c=r.map(function(t){return D(t)});var u=n(/^[^${}\\_^]/).map(function(t){return j(t)});var f=n(/^[^\\a-eg-zA-Z]/).or(i("\\").then(n(/^[a-z]+/i).or(n(/^\s+/).result(" ")).or(s))).then(function(t){var e=y[t];if(e){return e(t).parser()}else{return l("unknown command: \\"+t)}});var h=f.or(c).or(u);var p=i("{").then(function(){return m}).skip(i("}"));var d=a.then(p.or(h.map(t)));var m=d.many().map(e).skip(a);var v=i("[").then(d.then(function(t){return t.join("latex")!=="]"?o(t):l()}).many().map(e).skip(a)).skip(i("]"));var g=m;g.block=d;g.optBlock=v;return g}();c.open(function(t,e){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")};t.writeLatex=function(t){var e=this.notify("edit").cursor;var i=O.all;var n=O.eof;var r=k.skip(n).or(i.result(false)).parse(t);if(r&&!r.isEmpty()){r.children().adopt(e.parent,e[m],e[b]);var s=r.jQize();s.insertBefore(e.jQ);e[m]=r.ends[b];r.finalizeInsert(e.options,e);if(r.ends[b][b].siblingCreated){r.ends[b][b].siblingCreated(e.options,m)}if(r.ends[m][m].siblingCreated){r.ends[m][m].siblingCreated(e.options,b)}e.parent.bubble("reflow")}return this};t.renderLatexMath=function(t){var e=this.root,i=this.cursor;var n=O.all;var r=O.eof;var s=k.skip(r).or(n.result(false)).parse(t);e.eachChild("postOrder","dispose");e.ends[m]=e.ends[b]=0;if(s){s.children().adopt(e,0,0)}var a=e.jQ;if(s){var o=s.join("html");a.html(o);e.jQize(a.children());e.finalizeInsert(i.options)}else{a.empty()}delete i.selection;i.insAtRightEnd(e)};t.renderLatexText=function(t){var e=this.root,n=this.cursor;e.jQ.children().slice(1).remove();e.eachChild("postOrder","dispose");e.ends[m]=e.ends[b]=0;delete n.selection;n.show().insAtRightEnd(e);var i=O.regex;var r=O.string;var s=O.eof;var a=O.all;var o=r("$").then(k).skip(r("$").or(s)).map(function(t){var e=at(n);e.createBlocks();var i=e.ends[m];t.children().adopt(i,0,0);return e});var l=r("\\$").result("$");var c=l.or(i(/^[^$]/)).map(j);var u=o.or(c).many();var f=u.skip(s).or(a.result(false)).parse(t);if(f){for(var h=0;h<f.length;h+=1){f[h].adopt(e,e.ends[b],0)}e.jQize().appendTo(e.jQ);e.finalizeInsert(n.options)}}});c.open(function(t){t.delegateMouseEvents=function(){var h=this.root.jQ;this.container.bind("mousedown.mathquill",function(t){var e=v(t.target).closest(".mq-root-block");var i=w.byId[e.attr(d)||h.attr(d)];var n=i.controller,r=n.cursor,s=r.blink;var a=n.textareaSpan,o=n.textarea;var l;function c(t){l=v(t.target)}function u(t){if(!r.anticursor){r.startSelection()}n.seek(l,t.pageX,t.pageY).cursor.select();l=p}function f(t){r.blink=s;if(!r.selection){if(n.editable){r.show()}else{a.detach()}}e.unbind("mousemove",c);v(t.target.ownerDocument).unbind("mousemove",u).unbind("mouseup",f)}if(n.blurred){if(!n.editable){e.prepend(a)}o.focus()}t.preventDefault();t.target.unselectable=true;r.blink=x;n.seek(v(t.target),t.pageX,t.pageY).cursor.startSelection();e.mousemove(c);v(t.target.ownerDocument).mousemove(u).mouseup(f)})}});c.open(function(t){t.seek=function(t,e,i){var n=this.notify("select").cursor;if(t){var r=t.attr(d)||t.attr(z);if(!r){var s=t.parent();r=s.attr(d)||s.attr(z)}}var a=r?w.byId[r]:this.root;g("nodeId is the id of some Node that exists",a);n.clearSelection().show();a.seek(e,n);this.scrollHoriz();return this}});c.open(function(t){t.scrollHoriz=function(){var t=this.cursor,e=t.selection;var i=this.root.jQ[0].getBoundingClientRect();if(!e){var n=t.jQ[0].getBoundingClientRect().left;if(n>i.right-20){var r=n-(i.right-20)}else if(n<i.left+20){var r=n-(i.left+20)}else{return}}else{var s=e.jQ[0].getBoundingClientRect();var a=s.left-(i.left+20);var o=s.right-(i.right-20);if(e.ends[m]===t[b]){if(a<0){var r=a}else if(o>0){if(s.left-o<i.left+20){var r=a}else{var r=o}}else{return}}else{if(o>0){var r=o}else if(a<0){if(s.right-a>i.right-20){var r=o}else{var r=a}}else{return}}}this.root.jQ.stop().animate({scrollLeft:"+="+r},100)}});c.open(function(t){h.p.substituteTextarea=function(){return v("<textarea autocapitalize=off autocomplete=off autocorrect=off "+"spellcheck=false x-palm-disable-ste-all=true></textarea>")[0]};t.createTextarea=function(){var t=this.textareaSpan=v('<span class="mq-textarea"></span>'),e=this.options.substituteTextarea();if(!e.nodeType){throw"substituteTextarea() must return a DOM element, got "+e}e=this.textarea=v(e).appendTo(t);var i=this;i.cursor.selectionChanged=function(){i.selectionChanged()};i.container.bind("copy",function(){i.setTextareaSelection()})};t.selectionChanged=function(){var t=this;qt(t.container[0]);if(t.textareaSelectionTimeout===p){t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()})}};t.setTextareaSelection=function(){this.textareaSelectionTimeout=p;var t="";if(this.cursor.selection){t=this.cursor.selection.join("latex");if(this.options.statelessClipboard){t="$"+t+"$"}}this.selectFn(t)};t.staticMathTextareaEvents=function(){var t=this,e=t.root,i=t.cursor,n=t.textarea,r=t.textareaSpan;this.container.prepend('<span class="mq-selectable">$'+t.exportLatex()+"$</span>");t.blurred=true;n.bind("cut paste",false).focus(function(){t.blurred=false}).blur(function(){if(i.selection){i.selection.clear()}setTimeout(s)});function s(){r.detach();t.blurred=true}t.selectFn=function(t){n.val(t);if(t){n.select()}}};t.editablesTextareaEvents=function(){var e=this,t=e.root,i=e.cursor,n=e.textarea,r=e.textareaSpan;var s=it(n,this);this.selectFn=function(t){s.select(t)};this.container.prepend(r).on("cut",function(t){if(i.selection){setTimeout(function(){e.notify("edit");i.parent.bubble("reflow")})}});this.focusBlurEvents()};t.typedText=function(t){if(t==="\n"){return this.handle("enter")}var e=this.notify().cursor;e.parent.write(e,t);this.scrollHoriz()};t.paste=function(t){if(this.options.statelessClipboard){if(t.slice(0,1)==="$"&&t.slice(-1)==="$"){t=t.slice(1,-1)}else{t="\\text{"+t+"}"}}this.writeLatex(t).cursor.show()}});var nt=n(w,function(t,e){t.finalizeInsert=function(t,e){var i=this;i.postOrder("finalizeTree",t);i.postOrder("contactWeld",e);i.postOrder("blur");i.postOrder("reflow");if(i[b].siblingCreated){i[b].siblingCreated(t,m)}if(i[m].siblingCreated){i[m].siblingCreated(t,b)}i.bubble("reflow")}});var e=n(nt,function(t,r){t.init=function(t,e,i){var n=this;r.init.call(n);if(!n.ctrlSeq){n.ctrlSeq=t}if(e){n.htmlTemplate=e}if(i){n.textTemplate=i}};t.replaces=function(t){t.disown();this.replacedFragment=t};t.isEmpty=function(){return this.foldChildren(true,function(t,e){return t&&e.isEmpty()})};t.parser=function(){var t=k.block;var i=this;return t.times(i.numBlocks()).map(function(t){i.blocks=t;for(var e=0;e<t.length;e+=1){t[e].adopt(i,i.ends[b],0)}return i})};t.createLeftOf=function(t){var e=this;var i=e.replacedFragment;e.createBlocks();r.createLeftOf.call(e,t);if(i){i.adopt(e.ends[m],0,0);i.jQ.appendTo(e.ends[m].jQ)}e.finalizeInsert(t.options);e.placeCursor(t)};t.createBlocks=function(){var t=this,e=t.numBlocks(),i=t.blocks=Array(e);for(var n=0;n<e;n+=1){var r=i[n]=T();r.adopt(t,t.ends[b],0)}};t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[m],function(t,e){return t.isEmpty()?t:e}))};t.moveTowards=function(t,e,i){var n=i&&this[i+"Into"];e.insAtDirEnd(-t,n||this.ends[-t])};t.deleteTowards=function(t,e){if(this.isEmpty()){e[t]=this.remove()[t]}else{this.moveTowards(t,e,null)}};t.selectTowards=function(t,e){e[-t]=this;e[t]=this[t]};t.selectChildren=function(){return H(this,this)};t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])};t.seek=function(i,n){function r(t){var e={};e[m]=t.jQ.offset().left;e[b]=e[m]+t.jQ.outerWidth();return e}var s=this;var a=r(s);if(i<a[m]){return n.insLeftOf(s)}if(i>a[b]){return n.insRightOf(s)}var o=a[m];s.eachChild(function(t){var e=r(t);if(i<e[m]){if(i-o<e[m]-i){if(t[m]){n.insAtRightEnd(t[m])}else{n.insLeftOf(s)}}else{n.insAtLeftEnd(t)}return false}else if(i>e[b]){if(t[b]){o=e[b]}else{if(a[b]-i<i-e[b]){n.insRightOf(s)}else{n.insAtRightEnd(t)}}}else{t.seek(i,n);return false}})};t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0};t.html=function(){var t=this;var i=t.blocks;var e=" mathquill-command-id="+t.id;var n=t.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);g("no unmatched angle brackets",n.join("")===this.htmlTemplate);for(var r=0,s=n[0];s;r+=1,s=n[r]){if(s.slice(-2)==="/>"){n[r]=s.slice(0,-2)+e+"/>"}else if(s.charAt(0)==="<"){g("not an unmatched top-level close tag",s.charAt(1)!=="/");n[r]=s.slice(0,-1)+e+">";var a=1;do{r+=1,s=n[r];g("no missing close tags",s);if(s.slice(0,2)==="</"){a-=1}else if(s.charAt(0)==="<"&&s.slice(-2)!=="/>"){a+=1}}while(a>0)}}return n.join("").replace(/>&(\d+)/g,function(t,e){return" mathquill-block-id="+i[e].id+">"+i[e].join("html")})};t.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})};t.textTemplate=[""];t.text=function(){var n=this,r=0;return n.foldChildren(n.textTemplate[r],function(t,e){r+=1;var i=e.text();if(t&&n.textTemplate[r]==="("&&i[0]==="("&&i.slice(-1)===")"){return t+i.slice(1,-1)+n.textTemplate[r]}return t+e.text()+(n.textTemplate[r]||"")})}});var l=n(e,function(t,n){t.init=function(t,e,i){if(!i){i=t&&t.length>1?t.slice(1):t}n.init.call(this,t,e,[i])};t.parser=function(){return O.succeed(this)};t.numBlocks=function(){return 0};t.replaces=function(t){t.remove()};t.createBlocks=x;t.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ);e[-t]=this;e[t]=this[t]};t.deleteTowards=function(t,e){e[t]=this.remove()[t]};t.seek=function(t,e){if(t-this.jQ.offset().left<this.jQ.outerWidth()/2){e.insLeftOf(this)}else{e.insRightOf(this)}};t.latex=function(){return this.ctrlSeq};t.text=function(){return this.textTemplate};t.placeCursor=x;t.isEmpty=function(){return true}});var j=n(l,function(t,i){t.init=function(t,e){i.init.call(this,t,"<span>"+(e||t)+"</span>")}});var Q=n(l,function(t,n){t.init=function(t,e,i){n.init.call(this,t,'<span class="mq-binary-operator">'+e+"</span>",i)}});var T=n(nt,function(t,n){t.join=function(i){return this.foldChildren("",function(t,e){return t+e[i]()})};t.html=function(){return this.join("html")};t.latex=function(){return this.join("latex")};t.text=function(){return this.ends[m]===this.ends[b]&&this.ends[m]!==0?this.ends[m].text():this.join("text")};t.keystroke=function(t,e,i){if(i.options.spaceBehavesLikeTab&&(t==="Spacebar"||t==="Shift-Spacebar")){e.preventDefault();i.escapeDir(t==="Shift-Spacebar"?m:b,t,e);return}return n.keystroke.apply(this,arguments)};t.moveOutOf=function(t,e,i){var n=i&&this.parent[i+"Into"];if(!n&&this[t]){e.insAtDirEnd(-t,this[t])}else{e.insDirOf(t,this.parent)}};t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)};t.deleteOutOf=function(t,e){e.unwrapGramp()};t.seek=function(t,e){var i=this.ends[b];if(!i||i.jQ.offset().left+i.jQ.outerWidth()<t){return e.insAtRightEnd(this)}if(t<this.ends[m].jQ.offset().left){return e.insAtLeftEnd(this)}while(t<i.jQ.offset().left){i=i[m]}return i.seek(t,e)};t.chToCmd=function(t){var e;if(t.match(/^[a-eg-zA-Z]$/)){return D(t)}else if(/^\d$/.test(t)){return ct(t)}else if(e=s[t]||y[t]){return e(t)}else{return j(t)}};t.write=function(t,e){var i=this.chToCmd(e);if(t.selection){i.replaces(t.replaceSelection())}i.createLeftOf(t.show())};t.focus=function(){this.jQ.addClass("mq-hasCursor");this.jQ.removeClass("mq-empty");return this};t.blur=function(){this.jQ.removeClass("mq-hasCursor");if(this.isEmpty()){this.jQ.addClass("mq-empty")}return this}});u.StaticMath=function(i){return n(i.AbstractMathQuill,function(t,e){this.RootBlock=T;t.__mathquillify=function(){e.__mathquillify.call(this,"mq-math-mode");this.__controller.delegateMouseEvents();this.__controller.staticMathTextareaEvents();return this};t.init=function(){e.init.apply(this,arguments);this.__controller.root.postOrder("registerInnerField",this.innerFields=[],i.MathField)};t.latex=function(){var t=e.latex.apply(this,arguments);if(arguments.length>0){this.__controller.root.postOrder("registerInnerField",this.innerFields=[],i.MathField)}return t}})};var rt=n(T,et);u.MathField=function(t){return n(t.EditableField,function(t,i){this.RootBlock=rt;t.__mathquillify=function(t,e){this.config(t);if(e>1){this.__controller.root.reflow=x}i.__mathquillify.call(this,"mq-editable-field mq-math-mode");delete this.__controller.root.reflow;return this}})};var st=n(w,function(t,r){t.ctrlSeq="\\text";t.replaces=function(t){if(t instanceof q){this.replacedText=t.remove().jQ.text()}else if(typeof t==="string"){this.replacedText=t}};t.jQadd=function(t){r.jQadd.call(this,t);if(this.ends[m]){this.ends[m].jQadd(this.jQ[0].firstChild)}};t.createLeftOf=function(t){var e=this;r.createLeftOf.call(this,t);if(e[b].siblingCreated){e[b].siblingCreated(t.options,m)}if(e[m].siblingCreated){e[m].siblingCreated(t.options,b)}e.bubble("reflow");t.insAtRightEnd(e);if(e.replacedText){for(var i=0;i<e.replacedText.length;i+=1){e.write(t,e.replacedText.charAt(i))}}};t.parser=function(){var e=this;var t=O.string;var i=O.regex;var n=O.optWhitespace;return n.then(t("{")).then(i(/^[^}]*/)).skip(t("}")).map(function(t){C(t).adopt(e,0,0);return e})};t.textContents=function(){return this.foldChildren("",function(t,e){return t+e.text})};t.text=function(){return'"'+this.textContents()+'"'};t.latex=function(){return"\\text{"+this.textContents()+"}"};t.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"};t.moveTowards=function(t,e){e.insAtDirEnd(-t,this)};t.moveOutOf=function(t,e){e.insDirOf(t,this)};t.unselectInto=t.moveTowards;t.selectTowards=e.prototype.selectTowards;t.deleteTowards=e.prototype.deleteTowards;t.selectOutOf=function(t,e){e.insDirOf(t,this)};t.deleteOutOf=function(t,e){if(this.isEmpty()){e.insRightOf(this)}};t.write=function(t,e){t.show().deleteSelection();if(e!=="$"){if(!t[m]){C(e).createLeftOf(t)}else{t[m].appendText(e)}}else if(this.isEmpty()){t.insRightOf(this);j("\\$","$").createLeftOf(t)}else if(!t[b]){t.insRightOf(this)}else if(!t[m]){t.insLeftOf(this)}else{var i=st();var n=this.ends[m];n.disown();n.adopt(i,0,0);t.insLeftOf(this);r.createLeftOf.call(i,t)}};t.seek=function(t,e){e.hide();var i=u(this);var n=this.jQ.width()/this.text.length;var r=Math.round((t-this.jQ.offset().left)/n);if(r<=0){e.insAtLeftEnd(this)}else if(r>=i.text.length){e.insAtRightEnd(this)}else{e.insLeftOf(i.splitRight(r))}var s=t-e.show().offset().left;var a=s&&s<0?m:b;var o=a;while(e[a]&&s*o>0){e[a].moveTowards(a,e);o=s;s=t-e.offset().left}if(a*s<-a*o){e[-a].moveTowards(-a,e)}if(!e.anticursor){this.anticursorPosition=e[m]&&e[m].text.length}else if(e.anticursor.parent===this){var l=e[m]&&e[m].text.length;if(this.anticursorPosition===l){e.anticursor=f.copy(e)}else{if(this.anticursorPosition<l){var c=e[m].splitRight(this.anticursorPosition);e[m]=c}else{var c=e[b].splitRight(this.anticursorPosition-l)}e.anticursor=f(this,c[m],c)}}};t.blur=function(){T.prototype.blur.call(this);u(this)};function u(t){t.jQ[0].normalize();var e=t.jQ[0].firstChild;g("only node in TextBlock span is Text node",e.nodeType===3);var i=C(e.data);i.jQadd(e);t.children().disown();return i.adopt(t,0,0)}t.focus=T.prototype.focus});var C=n(w,function(t,e){t.init=function(t){e.init.call(this);this.text=t};t.jQadd=function(t){this.dom=t;this.jQ=v(t)};t.jQize=function(){return this.jQadd(document.createTextNode(this.text))};t.appendText=function(t){this.text+=t;this.dom.appendData(t)};t.prependText=function(t){this.text=t+this.text;this.dom.insertData(0,t)};t.insTextAtDirEnd=function(t,e){o(e);if(e===b){this.appendText(t)}else{this.prependText(t)}};t.splitRight=function(t){var e=C(this.text.slice(t)).adopt(this.parent,this,this[b]);e.jQadd(this.dom.splitText(t));this.text=this.text.slice(0,t);return e};function a(t,e){return e.charAt(t===m?0:-1+e.length)}t.moveTowards=function(t,e){o(t);var i=a(-t,this.text);var n=this[-t];if(n){n.insTextAtDirEnd(i,t)}else{C(i).createDir(-t,e)}return this.deleteTowards(t,e)};t.latex=function(){return this.text};t.deleteTowards=function(t,e){if(this.text.length>1){if(t===b){this.dom.deleteData(0,1);this.text=this.text.slice(1)}else{this.dom.deleteData(-1+this.text.length,1);this.text=this.text.slice(0,-1)}}else{this.remove();this.jQ.remove();e[t]=this[t]}};t.selectTowards=function(t,e){o(t);var i=e.anticursor;var n=a(-t,this.text);if(i[t]===this){var r=C(n).createDir(t,e);i[t]=r;e.insDirOf(t,r)}else{var s=this[-t];if(s){s.insTextAtDirEnd(n,t)}else{var r=C(n).createDir(-t,e);r.jQ.insDirOf(-t,e.selection.jQ)}if(this.text.length===1&&i[-t]===this){i[-t]=this[-t]}}return this.deleteTowards(t,e)}});s.$=y.text=y.textnormal=y.textrm=y.textup=y.textmd=st;function t(t,e,i){return n(st,{ctrlSeq:t,htmlTemplate:"<"+e+" "+i+">&0</"+e+">"})}y.em=y.italic=y.italics=y.emph=y.textit=y.textsl=t("\\textit","i",'class="mq-text-mode"');y.strong=y.bold=y.textbf=t("\\textbf","b",'class="mq-text-mode"');y.sf=y.textsf=t("\\textsf","span",'class="mq-sans-serif mq-text-mode"');y.tt=y.texttt=t("\\texttt","span",'class="mq-monospace mq-text-mode"');y.textsc=t("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"');y.uppercase=t("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"');y.lowercase=t("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"');var at=n(e,function(t,e){t.init=function(t){e.init.call(this,"$");this.cursor=t};t.htmlTemplate='<span class="mq-math-mode">&0</span>';t.createBlocks=function(){e.createBlocks.call(this);this.ends[m].cursor=this.cursor;this.ends[m].write=function(t,e){if(e!=="$"){T.prototype.write.call(this,t,e)}else if(this.isEmpty()){t.insRightOf(this.parent);this.parent.deleteTowards(dir,t);j("\\$","$").createLeftOf(t.show())}else if(!t[b]){t.insRightOf(this.parent)}else if(!t[m]){t.insLeftOf(this.parent)}else{T.prototype.write.call(this,t,e)}}};t.latex=function(){return"$"+this.ends[m].latex()+"$"}});var ot=n(rt,function(t,e){t.keystroke=function(t){if(t==="Spacebar"||t==="Shift-Spacebar"){return}return e.keystroke.apply(this,arguments)};t.write=function(t,e){t.show().deleteSelection();if(e==="$"){at(t).createLeftOf(t)}else{var i;if(e==="<"){i="&lt;"}else if(e===">"){i="&gt;"}j(e,i).createLeftOf(t)}}});u.TextField=function(t){return n(t.EditableField,function(t,e){this.RootBlock=ot;t.__mathquillify=function(){return e.__mathquillify.call(this,"mq-editable-field mq-text-mode")};t.latex=function(t){if(arguments.length>0){this.__controller.renderLatexText(t);if(this.__controller.blurred){this.__controller.cursor.hide().parent.blur()}return this}return this.__controller.exportLatex()}})};var lt=s["\\"]=n(e,function(t,n){t.ctrlSeq="\\";t.replaces=function(t){this._replacedFragment=t.disown();this.isEmpty=function(){return false}};t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>';t.textTemplate=["\\"];t.createBlocks=function(){n.createBlocks.call(this);this.ends[m].focus=function(){this.parent.jQ.addClass("mq-hasCursor");if(this.isEmpty()){this.parent.jQ.removeClass("mq-empty")}return this};this.ends[m].blur=function(){this.parent.jQ.removeClass("mq-hasCursor");if(this.isEmpty()){this.parent.jQ.addClass("mq-empty")}return this};this.ends[m].write=function(t,e){t.show().deleteSelection();if(e.match(/[a-z]/i)){j(e).createLeftOf(t)}else{this.parent.renderCommand(t);if(e!=="\\"||!this.isEmpty()){this.parent.parent.write(t,e)}}};this.ends[m].keystroke=function(t,e,i){if(t==="Tab"||t==="Enter"||t==="Spacebar"){this.parent.renderCommand(i.cursor);e.preventDefault();return}return n.keystroke.apply(this,arguments)}};t.createLeftOf=function(t){n.createLeftOf.call(this,t);if(this._replacedFragment){var e=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(t){v(t.target=e).trigger(t);return false}).insertBefore(this.jQ).add(this.jQ)}};t.latex=function(){return"\\"+this.ends[m].latex()+" "};t.renderCommand=function(t){this.jQ=this.jQ.last();this.remove();if(this[b]){t.insLeftOf(this[b])}else{t.insAtRightEnd(this.parent)}var e=this.ends[m].latex();if(!e){e=" "}var i=y[e];if(i){i=i(e);if(this._replacedFragment){i.replaces(this._replacedFragment)}i.createLeftOf(t)}else{i=st();i.replaces(e);i.createLeftOf(t);t.insRightOf(i);if(this._replacedFragment){this._replacedFragment.remove()}}}});y.notin=y.cong=y.equiv=y.oplus=y.otimes=n(Q,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}});y["\u2260"]=y.ne=y.neq=r(Q,"\\ne ","&ne;");y.ast=y.star=y.loast=y.lowast=r(Q,"\\ast ","&lowast;");y.therefor=y.therefore=r(Q,"\\therefore ","&there4;");y.cuz=y.because=r(Q,"\\because ","&#8757;");y.prop=y.propto=r(Q,"\\propto ","&prop;");y["\u2248"]=y.asymp=y.approx=r(Q,"\\approx ","&asymp;");y.isin=y["in"]=r(Q,"\\in ","&isin;");y.ni=y.contains=r(Q,"\\ni ","&ni;");y.notni=y.niton=y.notcontains=y.doesnotcontain=r(Q,"\\not\\ni ","&#8716;");y.sub=y.subset=r(Q,"\\subset ","&sub;");y.sup=y.supset=y.superset=r(Q,"\\supset ","&sup;");y.nsub=y.notsub=y.nsubset=y.notsubset=r(Q,"\\not\\subset ","&#8836;");y.nsup=y.notsup=y.nsupset=y.notsupset=y.nsuperset=y.notsuperset=r(Q,"\\not\\supset ","&#8837;");y.sube=y.subeq=y.subsete=y.subseteq=r(Q,"\\subseteq ","&sube;");y.supe=y.supeq=y.supsete=y.supseteq=y.supersete=y.superseteq=r(Q,"\\supseteq ","&supe;");y.nsube=y.nsubeq=y.notsube=y.notsubeq=y.nsubsete=y.nsubseteq=y.notsubsete=y.notsubseteq=r(Q,"\\not\\subseteq ","&#8840;");y.nsupe=y.nsupeq=y.notsupe=y.notsupeq=y.nsupsete=y.nsupseteq=y.notsupsete=y.notsupseteq=y.nsupersete=y.nsuperseteq=y.notsupersete=y.notsuperseteq=r(Q,"\\not\\supseteq ","&#8841;");y.N=y.naturals=y.Naturals=r(j,"\\mathbb{N}","&#8469;");y.P=y.primes=y.Primes=y.projective=y.Projective=y.probability=y.Probability=r(j,"\\mathbb{P}","&#8473;");y.Z=y.integers=y.Integers=r(j,"\\mathbb{Z}","&#8484;");y.Q=y.rationals=y.Rationals=r(j,"\\mathbb{Q}","&#8474;");y.R=y.reals=y.Reals=r(j,"\\mathbb{R}","&#8477;");y.C=y.complex=y.Complex=y.complexes=y.Complexes=y.complexplane=y.Complexplane=y.ComplexPlane=r(j,"\\mathbb{C}","&#8450;");y.H=y.Hamiltonian=y.quaternions=y.Quaternions=r(j,"\\mathbb{H}","&#8461;");y.quad=y.emsp=r(j,"\\quad ","    ");y.qquad=r(j,"\\qquad ","        ");y.diamond=r(j,"\\diamond ","&#9671;");y.bigtriangleup=r(j,"\\bigtriangleup ","&#9651;");y.ominus=r(j,"\\ominus ","&#8854;");y.uplus=r(j,"\\uplus ","&#8846;");y.bigtriangledown=r(j,"\\bigtriangledown ","&#9661;");y.sqcap=r(j,"\\sqcap ","&#8851;");y.triangleleft=r(j,"\\triangleleft ","&#8882;");y.sqcup=r(j,"\\sqcup ","&#8852;");y.triangleright=r(j,"\\triangleright ","&#8883;");y.odot=y.circledot=r(j,"\\odot ","&#8857;");y.bigcirc=r(j,"\\bigcirc ","&#9711;");y.dagger=r(j,"\\dagger ","&#0134;");y.ddagger=r(j,"\\ddagger ","&#135;");y.wr=r(j,"\\wr ","&#8768;");y.amalg=r(j,"\\amalg ","&#8720;");y.models=r(j,"\\models ","&#8872;");y.prec=r(j,"\\prec ","&#8826;");y.succ=r(j,"\\succ ","&#8827;");y.preceq=r(j,"\\preceq ","&#8828;");y.succeq=r(j,"\\succeq ","&#8829;");y.simeq=r(j,"\\simeq ","&#8771;");y.mid=r(j,"\\mid ","&#8739;");y.ll=r(j,"\\ll ","&#8810;");y.gg=r(j,"\\gg ","&#8811;");y.parallel=r(j,"\\parallel ","&#8741;");y.nparallel=r(j,"\\nparallel ","&#8742;");y.bowtie=r(j,"\\bowtie ","&#8904;");y.sqsubset=r(j,"\\sqsubset ","&#8847;");y.sqsupset=r(j,"\\sqsupset ","&#8848;");y.smile=r(j,"\\smile ","&#8995;");y.sqsubseteq=r(j,"\\sqsubseteq ","&#8849;");y.sqsupseteq=r(j,"\\sqsupseteq ","&#8850;");y.doteq=r(j,"\\doteq ","&#8784;");y.frown=r(j,"\\frown ","&#8994;");y.vdash=r(j,"\\vdash ","&#8870;");y.dashv=r(j,"\\dashv ","&#8867;");y.nless=r(j,"\\nless ","&#8814;");y.ngtr=r(j,"\\ngtr ","&#8815;");y.longleftarrow=r(j,"\\longleftarrow ","&#8592;");y.longrightarrow=r(j,"\\longrightarrow ","&#8594;");y.Longleftarrow=r(j,"\\Longleftarrow ","&#8656;");y.Longrightarrow=r(j,"\\Longrightarrow ","&#8658;");y.longleftrightarrow=r(j,"\\longleftrightarrow ","&#8596;");y.updownarrow=r(j,"\\updownarrow ","&#8597;");y.Longleftrightarrow=r(j,"\\Longleftrightarrow ","&#8660;");y.Updownarrow=r(j,"\\Updownarrow ","&#8661;");y.mapsto=r(j,"\\mapsto ","&#8614;");y.nearrow=r(j,"\\nearrow ","&#8599;");y.hookleftarrow=r(j,"\\hookleftarrow ","&#8617;");y.hookrightarrow=r(j,"\\hookrightarrow ","&#8618;");y.searrow=r(j,"\\searrow ","&#8600;");y.leftharpoonup=r(j,"\\leftharpoonup ","&#8636;");y.rightharpoonup=r(j,"\\rightharpoonup ","&#8640;");y.swarrow=r(j,"\\swarrow ","&#8601;");y.leftharpoondown=r(j,"\\leftharpoondown ","&#8637;");y.rightharpoondown=r(j,"\\rightharpoondown ","&#8641;");y.nwarrow=r(j,"\\nwarrow ","&#8598;");y.ldots=r(j,"\\ldots ","&#8230;");y.cdots=r(j,"\\cdots ","&#8943;");y.vdots=r(j,"\\vdots ","&#8942;");y.ddots=r(j,"\\ddots ","&#8945;");y.surd=r(j,"\\surd ","&#8730;");y.triangle=r(j,"\\triangle ","&#9651;");y.ell=r(j,"\\ell ","&#8467;");y.top=r(j,"\\top ","&#8868;");y.flat=r(j,"\\flat ","&#9837;");y.natural=r(j,"\\natural ","&#9838;");y.sharp=r(j,"\\sharp ","&#9839;");y.wp=r(j,"\\wp ","&#8472;");y.bot=r(j,"\\bot ","&#8869;");y.clubsuit=r(j,"\\clubsuit ","&#9827;");y.diamondsuit=r(j,"\\diamondsuit ","&#9826;");y.heartsuit=r(j,"\\heartsuit ","&#9825;");y.spadesuit=r(j,"\\spadesuit ","&#9824;");y.parallelogram=r(j,"\\parallelogram ","&#9649;");y.square=r(j,"\\square ","&#11036;");y.oint=r(j,"\\oint ","&#8750;");y.bigcap=r(j,"\\bigcap ","&#8745;");y.bigcup=r(j,"\\bigcup ","&#8746;");y.bigsqcup=r(j,"\\bigsqcup ","&#8852;");y.bigvee=r(j,"\\bigvee ","&#8744;");y.bigwedge=r(j,"\\bigwedge ","&#8743;");y.bigodot=r(j,"\\bigodot ","&#8857;");y.bigotimes=r(j,"\\bigotimes ","&#8855;");y.bigoplus=r(j,"\\bigoplus ","&#8853;");y.biguplus=r(j,"\\biguplus ","&#8846;");y.lfloor=r(j,"\\lfloor ","&#8970;");y.rfloor=r(j,"\\rfloor ","&#8971;");y.lceil=r(j,"\\lceil ","&#8968;");y.rceil=r(j,"\\rceil ","&#8969;");y.opencurlybrace=y.lbrace=r(j,"\\lbrace ","{");y.closecurlybrace=y.rbrace=r(j,"\\rbrace ","}");y.lbrack=r(j,"[");y.rbrack=r(j,"]");y["\u222b"]=y["int"]=y.integral=r(l,"\\int ","<big>&int;</big>");y.slash=r(j,"/");y.vert=r(j,"|");y.perp=y.perpendicular=r(j,"\\perp ","&perp;");y.nabla=y.del=r(j,"\\nabla ","&nabla;");y.hbar=r(j,"\\hbar ","&#8463;");y.AA=y.Angstrom=y.angstrom=r(j,"\\text\\AA ","&#8491;");y.ring=y.circ=y.circle=r(j,"\\circ ","&#8728;");y.bull=y.bullet=r(j,"\\bullet ","&bull;");y.setminus=y.smallsetminus=r(j,"\\setminus ","&#8726;");y.not=y["\xac"]=y.neg=r(j,"\\neg ","&not;");y["\u2026"]=y.dots=y.ellip=y.hellip=y.ellipsis=y.hellipsis=r(j,"\\dots ","&hellip;");y.converges=y.darr=y.dnarr=y.dnarrow=y.downarrow=r(j,"\\downarrow ","&darr;");y.dArr=y.dnArr=y.dnArrow=y.Downarrow=r(j,"\\Downarrow ","&dArr;");y.diverges=y.uarr=y.uparrow=r(j,"\\uparrow ","&uarr;");y.uArr=y.Uparrow=r(j,"\\Uparrow ","&uArr;");y.to=r(Q,"\\to ","&rarr;");y.rarr=y.rightarrow=r(j,"\\rightarrow ","&rarr;");y.implies=r(Q,"\\Rightarrow ","&rArr;");y.rArr=y.Rightarrow=r(j,"\\Rightarrow ","&rArr;");y.gets=r(Q,"\\gets ","&larr;");y.larr=y.leftarrow=r(j,"\\leftarrow ","&larr;");y.impliedby=r(Q,"\\Leftarrow ","&lArr;");y.lArr=y.Leftarrow=r(j,"\\Leftarrow ","&lArr;");y.harr=y.lrarr=y.leftrightarrow=r(j,"\\leftrightarrow ","&harr;");y.iff=r(Q,"\\Leftrightarrow ","&hArr;");y.hArr=y.lrArr=y.Leftrightarrow=r(j,"\\Leftrightarrow ","&hArr;");y.Re=y.Real=y.real=r(j,"\\Re ","&real;");y.Im=y.imag=y.image=y.imagin=y.imaginary=y.Imaginary=r(j,"\\Im ","&image;");y.part=y.partial=r(j,"\\partial ","&part;");y.infty=y.infin=y.infinity=r(j,"\\infty ","&infin;");y.alef=y.alefsym=y.aleph=y.alephsym=r(j,"\\aleph ","&alefsym;");y.xist=y.xists=y.exist=y.exists=r(j,"\\exists ","&exist;");y.and=y.land=y.wedge=r(j,"\\wedge ","&and;");y.or=y.lor=y.vee=r(j,"\\vee ","&or;");y.o=y.O=y.empty=y.emptyset=y.oslash=y.Oslash=y.nothing=y.varnothing=r(Q,"\\varnothing ","&empty;");y.cup=y.union=r(Q,"\\cup ","&cup;");y.cap=y.intersect=y.intersection=r(Q,"\\cap ","&cap;");y.deg=y.degree=r(j,"\\degree ","&deg;");y.ang=y.angle=r(j,"\\angle ","&ang;");y.measuredangle=r(j,"\\measuredangle ","&#8737;");var ct=n(j,function(t,e){t.createLeftOf=function(t){if(t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[m]instanceof a&&t[m].isItalic!==false||t[m]instanceof A&&t[m][m]instanceof a&&t[m][m].isItalic!==false)){y._().createLeftOf(t);e.createLeftOf.call(this,t);t.insRightOf(t.parent.parent)}else{e.createLeftOf.call(this,t)}}});var a=n(l,function(t,i){t.init=function(t,e){i.init.call(this,t,"<dfn>"+(e||t)+"</dfn>")};t.text=function(){var t=this.ctrlSeq;if(this[m]&&!(this[m]instanceof a)&&!(this[m]instanceof Q)&&this[m].ctrlSeq!=="\\ "){t="*"+t}if(this[b]&&!(this[b]instanceof Q)&&!(this[b]instanceof A)){t+="*"}return t}});h.p.autoCommands={_maxLength:0};G.autoCommands=function(t){if(!/^[a-z]+(?: [a-z]+)*$/i.test(t)){throw'"'+t+'" not a space-delimited list of only letters'}var e=t.split(" "),i={},n=0;for(var r=0;r<e.length;r+=1){var s=e[r];if(s.length<2){throw'autocommand "'+s+'" not minimum length of 2'}if(y[s]===ht){throw'"'+s+'" is a built-in operator name'}i[s]=1;n=B(n,s.length)}i._maxLength=n;return i};var D=n(a,function(t,a){t.init=function(t){return a.init.call(this,this.letter=t)};t.createLeftOf=function(t){var e=t.options.autoCommands,i=e._maxLength;if(i>0){var n=this.letter,r=t[m],s=1;while(r instanceof D&&s<i){n=r.letter+n,r=r[m],s+=1}while(n.length){if(e.hasOwnProperty(n)){for(var s=2,r=t[m];s<n.length;s+=1,r=r[m]){}q(r,t[m]).remove();t[m]=r[m];return y[n](n).createLeftOf(t)}n=n.slice(1)}}a.createLeftOf.apply(this,arguments)};t.italicize=function(t){this.isItalic=t;this.jQ.toggleClass("mq-operator-name",!t);return this};t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){if(e!==m&&this[b]instanceof D){return}this.autoUnItalicize(t)};t.autoUnItalicize=function(t){var e=t.autoOperatorNames;if(e._maxLength===0){return}var i=this.letter;for(var n=this[m];n instanceof D;n=n[m]){i=n.letter+i}for(var r=this[b];r instanceof D;r=r[b]){i+=r.letter}q(n[b]||this.parent.ends[m],r[m]||this.parent.ends[b]).each(function(t){t.italicize(true).jQ.removeClass("mq-first mq-last");t.ctrlSeq=t.letter});t:for(var s=0,a=n[b]||this.parent.ends[m];s<i.length;s+=1,a=a[b]){for(var o=M(e._maxLength,i.length-s);o>0;o-=1){var l=i.slice(s,s+o);if(e.hasOwnProperty(l)){for(var c=0,u=a;c<o;c+=1,u=u[b]){u.italicize(false);var f=u}var h=ut.hasOwnProperty(l);a.ctrlSeq=(h?"\\":"\\operatorname{")+a.ctrlSeq;f.ctrlSeq+=h?" ":"}";if(ft.hasOwnProperty(l)){f[m][m][m].jQ.addClass("mq-last")}if(p(a[m])){a.jQ.addClass("mq-first")}if(p(f[b])){f.jQ.addClass("mq-last")}s+=o-1;a=f;continue t}}}};function p(t){return t instanceof l&&!(t instanceof Q)}});var ut={};var _=h.p.autoOperatorNames={_maxLength:9};var ft={limsup:1,liminf:1,projlim:1,injlim:1};(function(){var t=("arg deg det dim exp gcd hom inf ker lg lim ln log max min sup"+" limsup liminf injlim projlim Pr").split(" ");for(var e=0;e<t.length;e+=1){ut[t[e]]=_[t[e]]=1}var i="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" ");for(var e=0;e<i.length;e+=1){ut[i[e]]=1}var n="sin cos tan sec cosec csc cotan cot ctg".split(" ");for(var e=0;e<n.length;e+=1){_[n[e]]=_["arc"+n[e]]=_[n[e]+"h"]=_["ar"+n[e]+"h"]=_["arc"+n[e]+"h"]=1}var r="gcf hcf lcm proj span".split(" ");for(var e=0;e<r.length;e+=1){_[r[e]]=1}})();G.autoOperatorNames=function(t){if(!/^[a-z]+(?: [a-z]+)*$/i.test(t)){throw'"'+t+'" not a space-delimited list of only letters'}var e=t.split(" "),i={},n=0;for(var r=0;r<e.length;r+=1){var s=e[r];if(s.length<2){throw'"'+s+'" not minimum length of 2'}i[s]=1;n=B(n,s.length)}i._maxLength=n;return i};var ht=n(l,function(t,e){t.init=function(t){this.ctrlSeq=t};t.createLeftOf=function(t){var e=this.ctrlSeq;for(var i=0;i<e.length;i+=1){D(e.charAt(i)).createLeftOf(t)}};t.parser=function(){var t=this.ctrlSeq;var e=T();for(var i=0;i<t.length;i+=1){D(t.charAt(i)).adopt(e,e.ends[b],0)}return O.succeed(e.children())}});for(var pt in _){if(_.hasOwnProperty(pt)){y[pt]=ht}}y.operatorname=n(e,function(t){t.createLeftOf=x;t.numBlocks=function(){return 1};t.parser=function(){return k.block.map(function(t){return t.children()})}});y.f=n(D,function(t,e){t.init=function(){l.p.init.call(this,this.letter="f",'<dfn class="mq-f">f</dfn>')};t.italicize=function(t){this.jQ.html("f").toggleClass("mq-f",t);return e.italicize.apply(this,arguments)}});y[" "]=y.space=r(j,"\\ ","&nbsp;");y["'"]=y.prime=r(j,"'","&prime;");y.backslash=r(j,"\\backslash ","\\");if(!s["\\"]){s["\\"]=y.backslash}y.$=r(j,"\\$","$");var S=n(l,function(t,i){t.init=function(t,e){i.init.call(this,t,'<span class="mq-nonSymbola">'+(e||t)+"</span>")}});y["@"]=S;y["&"]=r(S,"\\&","&amp;");y["%"]=r(S,"\\%","%");y.alpha=y.beta=y.gamma=y.delta=y.zeta=y.eta=y.theta=y.iota=y.kappa=y.mu=y.nu=y.xi=y.rho=y.sigma=y.tau=y.chi=y.psi=y.omega=n(a,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}});y.phi=r(a,"\\phi ","&#981;");y.phiv=y.varphi=r(a,"\\varphi ","&phi;");y.epsilon=r(a,"\\epsilon ","&#1013;");y.epsiv=y.varepsilon=r(a,"\\varepsilon ","&epsilon;");y.piv=y.varpi=r(a,"\\varpi ","&piv;");y.sigmaf=y.sigmav=y.varsigma=r(a,"\\varsigma ","&sigmaf;");y.thetav=y.vartheta=y.thetasym=r(a,"\\vartheta ","&thetasym;");y.upsilon=y.upsi=r(a,"\\upsilon ","&upsilon;");y.gammad=y.Gammad=y.digamma=r(a,"\\digamma ","&#989;");y.kappav=y.varkappa=r(a,"\\varkappa ","&#1008;");y.rhov=y.varrho=r(a,"\\varrho ","&#1009;");y.pi=y["\u03c0"]=r(S,"\\pi ","&pi;");y.lambda=r(S,"\\lambda ","&lambda;");y.Upsilon=y.Upsi=y.upsih=y.Upsih=r(l,"\\Upsilon ",'<dfn style="font-family: serif">&upsih;</dfn>');y.Gamma=y.Delta=y.Theta=y.Lambda=y.Xi=y.Pi=y.Sigma=y.Phi=y.Psi=y.Omega=y.forall=n(j,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}});var L=n(e,function(t){t.init=function(t){this.latex=t};t.createLeftOf=function(t){var e=k.parse(this.latex);e.children().adopt(t.parent,t[m],t[b]);t[m]=e.ends[b];e.jQize().insertBefore(t.jQ);e.finalizeInsert(t.options,t);if(e.ends[b][b].siblingCreated){e.ends[b][b].siblingCreated(t.options,m)}if(e.ends[m][m].siblingCreated){e.ends[m][m].siblingCreated(t.options,b)}t.parent.bubble("reflow")};t.parser=function(){var t=k.parse(this.latex).children();return O.succeed(t)}});y["\xb9"]=r(L,"^1");y["\xb2"]=r(L,"^2");y["\xb3"]=r(L,"^3");y["\xbc"]=r(L,"\\frac14");y["\xbd"]=r(L,"\\frac12");y["\xbe"]=r(L,"\\frac34");var dt=n(Q,function(t){t.init=j.prototype.init;t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){if(e===b){return}this.jQ[0].className=!this[m]||this[m]instanceof Q?"":"mq-binary-operator";return this}});y["+"]=r(dt,"+","+");y["\u2013"]=y["-"]=r(dt,"-","&minus;");y["\xb1"]=y.pm=y.plusmn=y.plusminus=r(dt,"\\pm ","&plusmn;");y.mp=y.mnplus=y.minusplus=r(dt,"\\mp ","&#8723;");s["*"]=y.sdot=y.cdot=r(Q,"\\cdot ","&middot;","*");var mt=n(Q,function(t,n){t.init=function(t,e){this.data=t;this.strict=e;var i=e?"Strict":"";n.init.call(this,t["ctrlSeq"+i],t["html"+i],t["text"+i])};t.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e];this.jQ.html(this.data["html"+e]);this.textTemplate=[this.data["text"+e]]};t.deleteTowards=function(t,e){if(t===m&&!this.strict){this.swap(true);this.bubble("reflow");return}n.deleteTowards.apply(this,arguments)}});var vt={ctrlSeq:"\\le ",html:"&le;",text:"\u2264",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"};var gt={ctrlSeq:"\\ge ",html:"&ge;",text:"\u2265",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};y["<"]=y.lt=r(mt,vt,true);y[">"]=y.gt=r(mt,gt,true);y["\u2264"]=y.le=y.leq=r(mt,vt,false);y["\u2265"]=y.ge=y.geq=r(mt,gt,false);var bt=n(Q,function(t,e){t.init=function(){e.init.call(this,"=","=")};t.createLeftOf=function(t){if(t[m]instanceof mt&&t[m].strict){t[m].swap(false);t[m].bubble("reflow");return}e.createLeftOf.apply(this,arguments)}});y["="]=bt;y["\xd7"]=y.times=r(Q,"\\times ","&times;","[x]");y["\xf7"]=y.div=y.divide=y.divides=r(Q,"\\div ","&divide;","[/]");s["~"]=y.sim=r(Q,"\\sim ","~","~");var wt,qt=x,xt=document.createElement("div"),yt=xt.style,Ot={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1},kt;for(var jt in Ot){if(jt in yt){kt=jt;break}}if(kt){wt=function(t,e,i){t.css(kt,"scale("+e+","+i+")")}}else if("filter"in yt){qt=function(t){t.className=t.className};wt=function(t,e,i){e/=1+(i-1)/2;t.css("fontSize",i+"em");if(!t.hasClass("mq-matrixed-container")){t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>')}var n=t.children().css("filter","progid:DXImageTransform.Microsoft"+".Matrix(M11="+e+",SizingMethod='auto expand')");function r(){t.css("marginRight",(n.width()-1)*(e-1)/e+"px")}r();var s=setInterval(r);v(window).load(function(){clearTimeout(s);r()})}}else{wt=function(t,e,i){t.css("fontSize",i+"em")}}var E=n(e,function(t,n){t.init=function(t,e,i){n.init.call(this,t,"<"+e+" "+i+">&0</"+e+">")}});y.mathrm=r(E,"\\mathrm","span",'class="mq-roman mq-font"');y.mathit=r(E,"\\mathit","i",'class="mq-font"');y.mathbf=r(E,"\\mathbf","b",'class="mq-font"');y.mathsf=r(E,"\\mathsf","span",'class="mq-sans-serif mq-font"');y.mathtt=r(E,"\\mathtt","span",'class="mq-monospace mq-font"');y.underline=r(E,"\\underline","span",'class="mq-non-leaf mq-underline"');y.overline=y.bar=r(E,"\\overline","span",'class="mq-non-leaf mq-overline"');y.overrightarrow=r(E,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"');y.overleftarrow=r(E,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"');var Qt=y.textcolor=n(e,function(t,r){t.setColor=function(t){this.color=t;this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'};t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"};t.parser=function(){var e=this;var t=O.optWhitespace;var i=O.string;var n=O.regex;return t.then(i("{")).then(n(/^[#\w\s.,()%-]*/)).skip(i("}")).then(function(t){e.setColor(t);return r.parser.call(e)})}});var Tt=y["class"]=n(e,function(t,n){t.parser=function(){var e=this,t=O.string,i=O.regex;return O.optWhitespace.then(t("{")).then(i(/^[-\w\s\\\xA0-\xFF]*/)).skip(t("}")).then(function(t){e.htmlTemplate='<span class="mq-class '+t+'">&0</span>';return n.parser.call(e)})}});var A=n(e,function(t,n){t.ctrlSeq="_{...}^{...}";t.createLeftOf=function(t){if(!t[m]&&t.options.supSubsRequireOperand){return}return n.createLeftOf.apply(this,arguments)};t.contactWeld=function(t){for(var n=m;n;n=n===m?b:false){if(this[n]instanceof A){for(var e="sub";e;e=e==="sub"?"sup":false){var i=this[e],r=this[n][e];if(!i){continue}if(!r){this[n].addBlock(i.disown())}else if(!i.isEmpty()){i.jQ.children().insAtDirEnd(-n,r.jQ);var s=i.children().disown();var a=f(r,s.ends[b],r.ends[m]);if(n===m){s.adopt(r,r.ends[b],0)}else{s.adopt(r,0,r.ends[m])}}else{var a=f(r,0,r.ends[m])}this.placeCursor=function(e,i){return function(t){t.insAtDirEnd(-n,e||i)}}(r,i)}this.remove();if(t&&t[m]===this){if(n===b&&a){a[m]?t.insRightOf(a[m]):t.insAtLeftEnd(a.parent)}else{t.insRightOf(this[n])}}break}}this.respace()};h.p.charsThatBreakOutOfSupSub="";t.finalizeTree=function(){this.ends[m].write=function(t,e){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if(e==="_"){return}var i=this.chToCmd(e);if(i instanceof l){t.deleteSelection()}else{t.clearSelection().insRightOf(this.parent)}return i.createLeftOf(t.show())}if(t[m]&&!t[b]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1){t.insRightOf(this.parent)}T.p.write.apply(this,arguments)}};t.moveTowards=function(t,e,i){if(e.options.autoSubscriptNumerals&&!this.sup){e.insDirOf(t,this)}else{n.moveTowards.apply(this,arguments)}};t.deleteTowards=function(t,e){if(e.options.autoSubscriptNumerals&&this.sub){var i=this.sub.ends[-t];if(i instanceof l){i.remove()}else if(i){i.deleteTowards(t,e.insAtDirEnd(-t,this.sub))}if(this.sub.isEmpty()){this.sub.deleteOutOf(m,e.insAtLeftEnd(this.sub));if(this.sup){e.insDirOf(-t,this)}}}else{n.deleteTowards.apply(this,arguments)}};t.latex=function(){function t(t,e){var i=e&&e.latex();return e?t+(i.length===1?i:"{"+(i||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)};t.respace=t.siblingCreated=t.siblingDeleted=function(t,e){if(e===b){return}this.jQ.toggleClass("mq-limit",this[m].ctrlSeq==="\\int ")};t.addBlock=function(t){if(this.supsub==="sub"){this.sup=this.upInto=this.sub.upOutOf=t;t.adopt(this,this.sub,0).downOutOf=this.sub;t.jQ=v('<span class="mq-sup"></span>').append(t.jQ.children()).attr(d,t.id).prependTo(this.jQ)}else{this.sub=this.downInto=this.sup.downOutOf=t;t.adopt(this,0,this.sup).upOutOf=this.sup;t.jQ=v('<span class="mq-sub"></span>').append(t.jQ.children()).attr(d,t.id).appendTo(this.jQ.removeClass("mq-sup-only"));this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>')}for(var e=0;e<2;e+=1){(function(n,r,s,a){n[r].deleteOutOf=function(t,e){e.insDirOf(this[t]?-t:t,this.parent);if(!this.isEmpty()){var i=this.ends[t];this.children().disown().withDirAdopt(t,e.parent,e[t],e[-t]).jQ.insDirOf(-t,e.jQ);e[-t]=i}n.supsub=s;delete n[r];delete n[a+"Into"];n[s][a+"OutOf"]=Ct;delete n[s].deleteOutOf;if(r==="sub"){v(n.jQ.addClass("mq-sup-only")[0].lastChild).remove()}this.remove()}})(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])}}});function Ct(t){var e=this.parent,i=t;do{if(i[b]){return t.insLeftOf(e)}i=i.parent.parent}while(i!==e);t.insRightOf(e)}y.subscript=y._=n(A,function(t,e){t.supsub="sub";t.htmlTemplate='<span class="mq-supsub mq-non-leaf">'+'<span class="mq-sub">&0</span>'+'<span style="display:inline-block;width:0">&#8203;</span>'+"</span>";t.textTemplate=["_"];t.finalizeTree=function(){this.downInto=this.sub=this.ends[m];this.sub.upOutOf=Ct;e.finalizeTree.call(this)}});y.superscript=y.supscript=y["^"]=n(A,function(t,e){t.supsub="sup";t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only">'+'<span class="mq-sup">&0</span>'+"</span>";t.textTemplate=["^"];t.finalizeTree=function(){this.upInto=this.sup=this.ends[b];this.sup.downOutOf=Ct;e.finalizeTree.call(this)}});var Dt=n(e,function(t,e){t.init=function(t,e){var i='<span class="mq-large-operator mq-non-leaf">'+'<span class="mq-to"><span>&1</span></span>'+"<big>"+e+"</big>"+'<span class="mq-from"><span>&0</span></span>'+"</span>";l.prototype.init.call(this,t,i)};t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments);if(t.options.sumStartsWithNEquals){D("n").createLeftOf(t);bt().createLeftOf(t)}};t.latex=function(){function t(t){return t.length===1?t:"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[m].latex())+"^"+t(this.ends[b].latex())};t.parser=function(){var t=O.string;var e=O.optWhitespace;var i=O.succeed;var n=k.block;var r=this;var s=r.blocks=[T(),T()];for(var a=0;a<s.length;a+=1){s[a].adopt(r,r.ends[b],0)}return e.then(t("_").or(t("^"))).then(function(t){var e=s[t==="_"?0:1];return n.then(function(t){t.children().adopt(e,e.ends[b],0);return i(r)})}).many().result(r)};t.finalizeTree=function(){this.downInto=this.ends[m];this.upInto=this.ends[b];this.ends[m].upOutOf=this.ends[b];this.ends[b].downOutOf=this.ends[m]}});y["\u2211"]=y.sum=y.summation=r(Dt,"\\sum ","&sum;");y["\u220f"]=y.prod=y.product=r(Dt,"\\prod ","&prod;");y.coprod=y.coproduct=r(Dt,"\\coprod ","&#8720;");var _t=y.frac=y.dfrac=y.cfrac=y.fraction=n(e,function(t,e){t.ctrlSeq="\\frac";t.htmlTemplate='<span class="mq-fraction mq-non-leaf">'+'<span class="mq-numerator">&0</span>'+'<span class="mq-denominator">&1</span>'+'<span style="display:inline-block;width:0">&#8203;</span>'+"</span>";t.textTemplate=["(",")/(",")"];t.finalizeTree=function(){this.upInto=this.ends[b].upOutOf=this.ends[m];this.downInto=this.ends[m].downOutOf=this.ends[b]}});var St=y.over=s["/"]=n(_t,function(t,i){t.createLeftOf=function(t){if(!this.replacedFragment){var e=t[m];while(e&&!(e instanceof Q||e instanceof(y.text||x)||e instanceof Dt||e.ctrlSeq==="\\ "||/^[,;:]$/.test(e.ctrlSeq))){e=e[m]}if(e instanceof Dt&&e[b]instanceof A){e=e[b];if(e[b]instanceof A&&e[b].ctrlSeq!=e.ctrlSeq){e=e[b]}}if(e!==t[m]){this.replaces(q(e[b]||t.parent.ends[m],t[m]));t[m]=e}}i.createLeftOf.call(this,t)}});var Lt=y.sqrt=y["\u221a"]=n(e,function(t,e){t.ctrlSeq="\\sqrt";t.htmlTemplate='<span class="mq-non-leaf">'+'<span class="mq-scaled mq-sqrt-prefix">&radic;</span>'+'<span class="mq-non-leaf mq-sqrt-stem">&0</span>'+"</span>";t.textTemplate=["sqrt(",")"];t.parser=function(){return k.optBlock.then(function(i){return k.block.map(function(t){var e=At();e.blocks=[i,t];i.adopt(e,0,0);t.adopt(e,i,0);return e})}).or(e.parser.call(this))};t.reflow=function(){var t=this.ends[b].jQ;wt(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}});var Et=y.vec=n(e,function(t,e){t.ctrlSeq="\\vec";t.htmlTemplate='<span class="mq-non-leaf">'+'<span class="mq-vector-prefix">&rarr;</span>'+'<span class="mq-vector-stem">&0</span>'+"</span>";t.textTemplate=["vec(",")"]});var At=y.nthroot=n(Lt,function(t,e){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup>'+'<span class="mq-scaled">'+'<span class="mq-sqrt-prefix mq-scaled">&radic;</span>'+'<span class="mq-sqrt-stem mq-non-leaf">&1</span>'+"</span>";t.textTemplate=["sqrt[","](",")"];t.latex=function(){return"\\sqrt["+this.ends[m].latex()+"]{"+this.ends[b].latex()+"}"}});function Rt(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments);this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last"));this.contentjQ=this.jQ.children(":eq(1)")};t.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));wt(this.delimjQs,M(1+.2*(t-1),1.2),1.2*t)}}var R=n(n(e,Rt),function(t,s){t.init=function(t,e,i,n,r){s.init.call(this,"\\left"+n,p,[e,i]);this.side=t;this.sides={};this.sides[m]={ch:e,ctrlSeq:n};this.sides[b]={ch:i,ctrlSeq:r}};t.numBlocks=function(){return 1};t.html=function(){this.htmlTemplate='<span class="mq-non-leaf">'+'<span class="mq-scaled mq-paren'+(this.side===b?" mq-ghost":"")+'">'+this.sides[m].ch+"</span>"+'<span class="mq-non-leaf">&0</span>'+'<span class="mq-scaled mq-paren'+(this.side===m?" mq-ghost":"")+'">'+this.sides[b].ch+"</span>"+"</span>";return s.html.call(this)};t.latex=function(){return"\\left"+this.sides[m].ctrlSeq+this.ends[m].latex()+"\\right"+this.sides[b].ctrlSeq};t.oppBrack=function(t,e,i){return e instanceof R&&e.side&&e.side!==-i&&(this.sides[this.side].ch==="|"||e.side===-this.side)&&(!t.restrictMismatchedBrackets||It[this.sides[this.side].ch]===e.sides[e.side].ch||{"(":"]","[":")"}[this.sides[m].ch]===e.sides[b].ch)&&e};t.closeOpposing=function(t){t.side=0;t.sides[this.side]=this.sides[this.side];t.delimjQs.eq(this.side===m?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)};t.createLeftOf=function(t){if(!this.replacedFragment){var e=t.options;var i=this.oppBrack(e,t[m],m)||this.oppBrack(e,t[b],b)||this.oppBrack(e,t.parent.parent)}if(i){var n=this.side=-i.side;this.closeOpposing(i);if(i===t.parent.parent&&t[n]){q(t[n],t.parent.ends[n],-n).disown().withDirAdopt(-n,i.parent,i,i[n]).jQ.insDirOf(n,i.jQ);i.bubble("reflow")}}else{i=this,n=i.side;if(i.replacedFragment){i.side=0}else if(t[-n]){i.replaces(q(t[-n],t.parent.ends[-n],n));t[-n]=0}s.createLeftOf.call(i,t)}if(n===m){t.insAtLeftEnd(i.ends[m])}else{t.insRightOf(i)}};t.placeCursor=x;t.unwrap=function(){this.ends[m].children().disown().adopt(this.parent,this,this[b]).jQ.insertAfter(this.jQ);this.remove()};t.deleteSide=function(t,e,i){var n=this.parent,r=this[t],s=n.ends[t];if(t===this.side){this.unwrap();r?i.insDirOf(-t,r):i.insAtDirEnd(t,n);return}var a=i.options,o=!this.side;this.side=-t;if(this.oppBrack(a,this.ends[m].ends[this.side],t)){this.closeOpposing(this.ends[m].ends[this.side]);var l=this.ends[m].ends[t];this.unwrap();if(l.siblingCreated){l.siblingCreated(i.options,t)}r?i.insDirOf(-t,r):i.insAtDirEnd(t,n)}else{if(this.oppBrack(a,this.parent.parent,t)){this.parent.parent.closeOpposing(this);this.parent.parent.unwrap()}else if(e&&o){this.unwrap();r?i.insDirOf(-t,r):i.insAtDirEnd(t,n);return}else{this.sides[t]={ch:It[this.sides[this.side].ch],ctrlSeq:It[this.sides[this.side].ctrlSeq]};this.delimjQs.removeClass("mq-ghost").eq(t===m?0:1).addClass("mq-ghost").html(this.sides[t].ch)}if(r){var l=this.ends[m].ends[t];q(r,s,-t).disown().withDirAdopt(-t,this.ends[m],l,0).jQ.insAtDirEnd(t,this.ends[m].jQ.removeClass("mq-empty"));if(l.siblingCreated){l.siblingCreated(i.options,t)}i.insDirOf(-t,r)}else{e?i.insDirOf(t,this):i.insAtDirEnd(t,this.ends[m])}}};t.deleteTowards=function(t,e){this.deleteSide(-t,false,e)};t.finalizeTree=function(){this.ends[m].deleteOutOf=function(t,e){this.parent.deleteSide(t,true,e)};this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===m?1:0).removeClass("mq-ghost");this.side=0}};t.siblingCreated=function(t,e){if(e===-this.side){this.finalizeTree()}}});var It={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|"};function zt(t,e){var e=e||t,i=It[t],n=It[e];s[t]=r(R,m,t,i,e,n);s[i]=r(R,b,t,i,e,n)}zt("(");zt("[");zt("{","\\{");y.langle=r(R,m,"&lang;","&rang;","\\langle ","\\rangle ");y.rangle=r(R,b,"&lang;","&rang;","\\langle ","\\rangle ");s["|"]=r(R,m,"|","|","|","|");y.left=n(e,function(t){t.parser=function(){var t=O.regex;var e=O.string;var i=O.succeed;var a=O.optWhitespace;return a.then(t(/^(?:[([|]|\\\{)/)).then(function(r){var s=r.charAt(0)==="\\"?r.slice(1):r;return k.then(function(n){return e("\\right").skip(a).then(t(/^(?:[\])|]|\\\})/)).map(function(t){var e=t.charAt(0)==="\\"?t.slice(1):t;var i=R(0,s,e,r,t);i.blocks=[n];n.adopt(i,0,0);return i})})})}});y.right=n(e,function(t){t.parser=function(){return O.fail("unmatched \\right")}});var Mt=y.binom=y.binomial=n(n(e,Rt),function(t,e){t.ctrlSeq="\\binom";t.htmlTemplate='<span class="mq-non-leaf">'+'<span class="mq-paren mq-scaled">(</span>'+'<span class="mq-non-leaf">'+'<span class="mq-array mq-non-leaf">'+"<span>&0</span>"+"<span>&1</span>"+"</span>"+"</span>"+'<span class="mq-paren mq-scaled">)</span>'+"</span>";t.textTemplate=["choose(",",",")"]});var Bt=y.choose=n(Mt,function(t){t.createLeftOf=St.prototype.createLeftOf});y.editable=y.MathQuillMathField=n(e,function(t,r){t.ctrlSeq="\\MathQuillMathField";t.htmlTemplate='<span class="mq-editable-field">'+'<span class="mq-root-block">&0</span>'+"</span>";t.parser=function(){var e=this,t=O.string,i=O.regex,n=O.succeed;return t("[").then(i(/^[a-z][a-z0-9]*/i)).skip(t("]")).map(function(t){e.name=t}).or(n()).then(r.parser.call(e))};t.finalizeTree=function(){var t=c(this.ends[m],this.jQ,h());t.KIND_OF_MQ="MathField";t.editable=true;t.createTextarea();t.editablesTextareaEvents();t.cursor.insAtRightEnd(t.root);et(t.root)};t.registerInnerField=function(t,e){t.push(t[this.name]=e(this.ends[m].controller))};t.latex=function(){return this.ends[m].latex()};t.text=function(){return this.ends[m].text()}});var Ft=y.embed=n(l,function(t,e){t.setOptions=function(t){function e(){return""}this.text=t.text||e;this.htmlTemplate=t.htmlString||"";this.latex=t.latex||e;return this};t.parser=function(){var i=this;string=O.string,regex=O.regex,succeed=O.succeed;return string("{").then(regex(/^[a-z][a-z0-9]*/i)).skip(string("}")).then(function(e){return string("[").then(regex(/^[-\w\s]*/)).skip(string("]")).or(succeed()).map(function(t){return i.setOptions(Y[e](t))})})}});var $t=J(1);for(var Nt in $t){(function(t,e){if(typeof e==="function"){i[t]=function(){X();return e.apply(this,arguments)};i[t].prototype=e.prototype}else{i[t]=e}})(Nt,$t[Nt])}})();
// #END
