// JS-Script (US): date_utils.js @ 2022-04-04 22:54:15 +0000
const smartJ$Date=new class{constructor(){"use strict";const _N$="smartJ$Date";const _C$=this;const _p$=console;let SECURED=false;_C$.secureClass=()=>{if(SECURED===true){_p$.warn(_N$,"Class is already SECURED")}else{SECURED=true;Object.freeze(_C$)}};const _Utils$=smartJ$Utils;const createSafeDate=(year,month,day)=>{year=_Utils$.format_number_int(year);month=_Utils$.format_number_int(month,false);day=_Utils$.format_number_int(day,false);return normalizeAndClone({year:year,month:month,day:day})};_C$.createSafeDate=createSafeDate;const standardizeDate=function(date){if(date instanceof Date){let d=date;date=null;date={year:d.getFullYear(),month:d.getMonth()+1,day:d.getDate()};d=null}return normalizeAndClone(date)};_C$.standardizeDate=standardizeDate;const getIsoDate=function(date,withTime=false){if(date instanceof Date){let d=date;date=null;date={year:d.getFullYear(),month:d.getMonth()+1,day:d.getDate()};if(withTime===true){date.hour=d.getHours()||0;date.minute=d.getMinutes()||0;date.second=d.getSeconds()||0}d=null}if(withTime!==true){date=normalizeAndClone(date)}const add_d_m_LeadingZero=d_m=>{if(d_m<1){d_m=1}if(d_m<10){d_m="0"+String(d_m)}return String(d_m)};const add_h_m_s_LeadingZero=h_m_s=>{if(h_m_s<0){h_m_s=0}if(h_m_s<10){h_m_s="0"+String(h_m_s)}return String(h_m_s)};let y=String(date.year);let m=String(add_d_m_LeadingZero(date.month));let d=String(add_d_m_LeadingZero(date.day));if(withTime===true){return String(y+"-"+m+"-"+d+" "+add_h_m_s_LeadingZero(date.hour||0)+":"+add_h_m_s_LeadingZero(date.minute||0)+":"+add_h_m_s_LeadingZero(date.second||0))}else{return String(y+"-"+m+"-"+d)}};_C$.getIsoDate=getIsoDate;const calculateDaysOffset=function(sdate1,sdate2){let ofs1=toOffset(sdate1.year,sdate1.month,sdate1.day);let ofs2=toOffset(sdate2.year,sdate2.month,sdate2.day);return ofs2-ofs1};_C$.calculateDaysOffset=calculateDaysOffset;const calculateMonthsOffset=(sdate1,sdate2)=>(sdate2.year-sdate1.year)*12+(sdate2.month-sdate1.month);_C$.calculateMonthsOffset=calculateMonthsOffset;const addYears=function(date,years){years=_Utils$.format_number_int(years);let sd=normalizeAndClone(date);sd.year+=years;sd=clipDay(sd);return sd};_C$.addYears=addYears;const addMonths=function(date,months){months=_Utils$.format_number_int(months);let sd=normalizeAndClone(date);sd.month+=months;const wrapMonth=function(date){let yearOffset=yearOffsetForMonth(date.month);date.year+=yearOffset;date.month-=yearOffset*12;return date};sd=wrapMonth(sd);sd=clipDay(sd);return sd};_C$.addMonths=addMonths;const addDays=function(date,days){days=_Utils$.format_number_int(days);let normalized=normalizeAndClone(date);let offset=toOffset(normalized.year,normalized.month,normalized.day);return toDate(offset+days)};_C$.addDays=addDays;const isLeapYear=function(year){year=_Utils$.format_number_int(year);let leap=true;if(year%4!==0){leap=false}else if(year%400==0){leap=true}else if(year%100==0){leap=false}return leap};_C$.isLeapYear=isLeapYear;const daysInMonth=function(year,month){year=_Utils$.format_number_int(year);month=_Utils$.format_number_int(month);const DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31];let d=DAYS_IN_MONTH[month-1];if(month===2&&isLeapYear(year)){d=29}return d};_C$.daysInMonth=daysInMonth;const formatDate=function(format,date,settings){format=_Utils$.stringPureVal(format,true);if(format==""){format="yy-mm-dd"}if(!date){return""}const defaultSettings={monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};let iFormat,dayNamesShort=(settings?settings.dayNamesShort:null)||defaultSettings.dayNamesShort,dayNames=(settings?settings.dayNames:null)||defaultSettings.dayNames,monthNamesShort=(settings?settings.monthNamesShort:null)||defaultSettings.monthNamesShort,monthNames=(settings?settings.monthNames:null)||defaultSettings.monthNames,_ticksTo1970=((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+Math.floor(1970/400))*24*60*60*1e7,output="",literal=false;const lookAhead=function(match){let matches=iFormat+1<format.length&&format.charAt(iFormat+1)===match;if(matches){iFormat++}return matches};const formatNumber=function(match,value,len){let num=String(value);if(lookAhead(match)){while(num.length<len){num="0"+num}}return num};const formatName=(match,value,shortNames,longNames)=>lookAhead(match)?longNames[value]:shortNames[value];if(date){for(iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)==="'"&&!lookAhead("'")){literal=false}else{output+=format.charAt(iFormat)}}else{switch(format.charAt(iFormat)){case"d":output+=formatNumber("d",date.getDate(),2);break;case"D":output+=formatName("D",date.getDay(),dayNamesShort,dayNames);break;case"o":output+=formatNumber("o",Math.round((new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime()-new Date(date.getFullYear(),0,0).getTime())/864e5),3);break;case"m":output+=formatNumber("m",date.getMonth()+1,2);break;case"M":output+=formatName("M",date.getMonth(),monthNamesShort,monthNames);break;case"y":output+=lookAhead("y")?date.getFullYear():(date.getFullYear()%100<10?"0":"")+date.getFullYear()%100;break;case"@":output+=date.getTime();break;case"!":output+=date.getTime()*1e4+_ticksTo1970;break;case"'":if(lookAhead("'")){output+="'"}else{literal=true}break;default:output+=format.charAt(iFormat)}}}}return String(output)};_C$.formatDate=formatDate;const determineDate=function(date,defaultDate){if(defaultDate==undefined||defaultDate=="undefined"||defaultDate==""||!defaultDate){defaultDate=null}const _daylightSavingAdjust=date=>{if(!date){return null}date.setHours(date.getHours()>12?date.getHours()+2:0);return date};const offsetNumeric=function(offset){let date=new Date;date.setDate(date.getDate()+offset);return date};const offsetString=function(offset){let date=null;if(offset){date=defaultDate}if(date==null){date=new Date}let year=date.getFullYear(),month=date.getMonth(),day=date.getDate();let pattern=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,matches=pattern.exec(offset);while(matches){switch(matches[2]||"d"){case"d":case"D":day+=parseInt(matches[1],10);break;case"w":case"W":day+=parseInt(matches[1],10)*7;break;case"m":case"M":month+=parseInt(matches[1],10);day=Math.min(day,new Date(year,month+1,0).getDate());break;case"y":case"Y":year+=parseInt(matches[1],10);day=Math.min(day,new Date(year,month+1,0).getDate());break}matches=pattern.exec(offset)}return new Date(year,month,day)};let newDate=date==null||date===""?defaultDate:typeof date==="string"?offsetString(date):typeof date==="number"?!_Utils$.isFiniteNumber(date)?defaultDate:offsetNumeric(date):new Date(date.getTime());newDate=newDate&&newDate.toString()==="Invalid Date"?defaultDate:newDate;if(newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0)}return _daylightSavingAdjust(newDate)};_C$.determineDate=determineDate;const normalizeAndClone=function(date){let yearOffset=yearOffsetForMonth(date.month);let year=date.year+yearOffset;let month=date.month-yearOffset*12;return toDate(toOffset(year,month,date.day))};const clipDay=date=>{date.day=Math.min(date.day,daysInMonth(date.year,date.month));return date};const yearOffsetForMonth=function(month){let ofs=0;if(month>12){ofs=Math.ceil(month/12)-1}else if(month<1){ofs=Math.floor((month-1)/12)}return ofs};const toDate=function(z){z+=719468;let era=(z>=0?z:z-146096)/146097|0;let doe=z-era*146097;let yoe=Math.floor((doe-Math.floor(doe/1460)+Math.floor(doe/36524)-Math.floor(doe/146096))/365);let y=yoe+era*400;let doy=doe-(365*yoe+Math.floor(yoe/4)-Math.floor(yoe/100));let mp=Math.floor((5*doy+2)/153);let d=doy-Math.floor((153*mp+2)/5)+1;let m=mp+(mp<10?3:-9);return{year:y+(m<=2),month:m,day:d}};const toOffset=function(y,m,d){y-=m<=2;let era=(y>=0?y:y-399)/400|0;let yoe=y-era*400;let doy=Math.floor((153*(m+(m>2?-3:9))+2)/5)+d-1;let doe=yoe*365+Math.floor(yoe/4)-Math.floor(yoe/100)+doy;return era*146097+doe-719468}}};smartJ$Date.secureClass();if(typeof window!="undefined"){window.smartJ$Date=smartJ$Date}
// #END
