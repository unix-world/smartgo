// JS-Script (US): core_utils.js @ 2023-05-17 07:48:55 +0000
const smartJ$Utils=new class{constructor(){"use strict";const _N$="smartJ$Utils";const _C$=this;const _p$=console;let SECURED=false;_C$.secureClass=()=>{if(SECURED===true){_p$.warn(_N$,"Class is already SECURED")}else{SECURED=true;Object.freeze(_C$)}};const debug=false;const evalJsFxCode=(fxContext,jsCode,alertErr=false)=>{if(jsCode!=undefined){const _m$="evalJsFxCode";const errMsg="Js Code Eval FAILED";const errHint="See the javascript console for more details ...";fxContext=stringPureVal(fxContext);if(typeof jsCode==="function"){try{jsCode()}catch(err){_p$.error(_N$,_m$,"ERR:",errMsg,"Context:",fxContext,"[F]","JS Errors:",err);if(alertErr===true){alert("JS Errors: "+errMsg+" in [F] Context: "+fxContext+"\n"+errHint)}return false}}else{jsCode=stringPureVal(jsCode,true);if(stringIStartsWith(jsCode,"javascript:")){jsCode=jsCode.substr(11);jsCode=stringTrim(jsCode)}if(typeof jsCode==="string"&&jsCode!="undefined"&&jsCode!=""){try{eval("(() => { "+"\n"+" 'use strict';"+"\n"+String(jsCode)+"\n"+" })();")}catch(err){_p$.error(_N$,_m$,"ERR:",errMsg,"Context:",fxContext,"[S]","JS Errors:",err);if(alertErr===true){alert("JS Errors: "+errMsg+" in [S] Context: "+fxContext+"\n"+errHint)}return false}}}}return true};_C$.evalJsFxCode=evalJsFxCode;const isFiniteNumber=num=>!!(typeof num!="number")?false:!!(Number.isFinite(num)&&!Number.isNaN(num));_C$.isFiniteNumber=isFiniteNumber;const stringPureVal=(input,trim)=>{if(typeof input=="undefined"||input===undefined||input===null||input===false||typeof input==="object"||typeof input==="function"){input=""}else if(input===true){input="1"}else{input=String(input)}if(trim===true){input=stringTrim(input)}return String(input)};_C$.stringPureVal=stringPureVal;const stringTrim=str=>{str=String(str==undefined?"":str);if(str==""){return""}return String(str.replace(/^\s\s*/,"").replace(/\s\s*$/,""))};_C$.stringTrim=stringTrim;const stringUcFirst=str=>{str=String(str==undefined?"":str);if(str==""){return""}if(str.length>1){return String(str.charAt(0).toUpperCase()+str.substr(1))}else{return String(str.toUpperCase())}};_C$.stringUcFirst=stringUcFirst;const stringUcWords=str=>{str=String(str==undefined?"":str);if(str==""){return""}return String(str.toLowerCase().replace(/^(.)|\s+(.)/g,$1=>$1?String($1).toUpperCase():""))};_C$.stringUcWords=stringUcWords;const stringReplaceAll=(token,newToken,str)=>{str=String(str==undefined?"":str);if(str==""){return""}return String(str.split(token).join(newToken))};_C$.stringReplaceAll=stringReplaceAll;const stringIReplaceAll=function(token,newToken,str){str=String(str==undefined?"":str);if(str==""){return""}if(typeof token==="string"&&typeof newToken==="string"){token=token.toLowerCase();let i=-1;while((i=str.toLowerCase().indexOf(token,i>=0?i+newToken.length:0))!==-1){str=String(str.substring(0,i)+newToken+str.substring(i+token.length))}}return String(str)};_C$.stringIReplaceAll=stringIReplaceAll;const stringRegexMatchAll=function(str,regexp){str=String(str==undefined?"":str);if(str==""){return[]}if(regexp==undefined){return[]}if(!(regexp instanceof RegExp)){_p$.error(_N$,"ERR: stringRegexMatchAll: 2nd param must be a Regex and is not");return[]}let matches=[];if(String.prototype.matchAll){try{matches=Array.from(str.matchAll(regexp))}catch(err){_p$.error(_N$,"ERR: stringRegexMatchAll (1):",err);return[]}}else{const getRegexLimitCycles=()=>{const RegexRecursionLimit=8e5;const min=1e5;const max=min*10;let cycles=RegexRecursionLimit;if(cycles<min){cycles=min}else if(cycles>max){cycles=max}return cycles};const maxloops=getRegexLimitCycles();let match=null;let loopidx=0;try{while((match=regexp.exec(str))!==null){if(match.index===regexp.lastIndex){regexp.lastIndex++}matches.push(match);loopidx++;if(loopidx>=maxloops){_p$.warn(_N$,"WARN: stringRegexMatchAll hardlimit loop (2). Max recursion depth is",maxloops);break}}}catch(err){_p$.error(_N$,"ERR: stringRegexMatchAll (2):",err);return[]}}return matches};_C$.stringRegexMatchAll=stringRegexMatchAll;const strContains=(str,search,pos=0,caseInsensitive=false)=>{str=String(str==undefined?"":str);if(str==""){return false}search=String(search==undefined?"":search);if(search==""){return false}if(pos==undefined){pos=0}pos=format_number_int(pos);if(pos<0){_p$.error(_N$,"ERR: stringContains: Position is Negative:",pos);return false}if(caseInsensitive===true){str=str.toLowerCase();search=search.toLowerCase()}return!!str.includes(search,pos)};const stringContains=(str,search,pos=0)=>!!strContains(str,search,pos,false);_C$.stringContains=stringContains;const stringIContains=(str,search,pos=0)=>!!strContains(str,search,pos,true);_C$.stringIContains=stringIContains;const strStartsWith=(str,search,caseInsensitive=false)=>{str=String(str==undefined?"":str);if(str==""){return false}search=String(search==undefined?"":search);if(search==""){return false}if(caseInsensitive===true){str=str.toLowerCase();search=search.toLowerCase()}return!!str.startsWith(search,0)};const stringStartsWith=(str,search)=>!!strStartsWith(str,search,false);_C$.stringStartsWith=stringStartsWith;const stringIStartsWith=(str,search)=>!!strStartsWith(str,search,true);_C$.stringIStartsWith=stringIStartsWith;const strEndsWith=(str,search,caseInsensitive=false)=>{str=String(str==undefined?"":str);if(str==""){return false}search=String(search==undefined?"":search);if(search==""){return false}if(caseInsensitive===true){str=str.toLowerCase();search=search.toLowerCase()}return!!str.endsWith(search)};const stringEndsWith=(str,search)=>!!strEndsWith(str,search,false);_C$.stringEndsWith=stringEndsWith;const stringIEndsWith=(str,search)=>!!strEndsWith(str,search,true);_C$.stringIEndsWith=stringIEndsWith;const preg_quote=str=>{str=String(str==undefined?"":str);if(str==""){return""}return String(str.replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:\-\#])/g,"\\$1"))};_C$.preg_quote=preg_quote;const stringSplitbyChar=function(str,by){str=String(str==undefined?"":str);if(str==""){return[]}by=String(by==undefined?"":by);let regex=false;switch(by){case"=":regex=true;break;case":":regex=true;break;case";":regex=true;break;case",":regex=true;break;default:regex=false}if(!regex){return[]}regex=new RegExp("\\s*"+preg_quote(by)+"\\s*");str=stringTrim(str);return str.split(regex)};const stringSplitbyEqual=str=>stringSplitbyChar(str,"=");_C$.stringSplitbyEqual=stringSplitbyEqual;const stringSplitbyColon=str=>stringSplitbyChar(str,":");_C$.stringSplitbyColon=stringSplitbyColon;const stringSplitbySemicolon=str=>stringSplitbyChar(str,";");_C$.stringSplitbySemicolon=stringSplitbySemicolon;const stringSplitbyComma=str=>stringSplitbyChar(str,",");_C$.stringSplitbyComma=stringSplitbyComma;const arrayGetFirst=arr=>arr instanceof Array?arr.shift():null;_C$.arrayGetFirst=arrayGetFirst;const arrayGetLast=arr=>arr instanceof Array?arr.pop():null;_C$.arrayGetLast=arrayGetLast;const format_number_float=(num,allow_negatives=true)=>{if(num==undefined){num=0}num=Number(num);num=isFiniteNumber(num)?num:0;if(allow_negatives!==true){if(num<0){num=0}}num=Number(num);return isFiniteNumber(num)?num:0};_C$.format_number_float=format_number_float;const format_number_int=(num,allow_negatives=true)=>{if(num==undefined){num=0}num=Number(num);num=isFiniteNumber(num)?Math.round(num):0;if(!Number.isInteger(num)){num=0}if(allow_negatives!==true){if(num<0){num=0}}if(!Number.isSafeInteger(num)){if(num>0){num=Number.MAX_SAFE_INTEGER}else if(num<0){num=Number.MIN_SAFE_INTEGER}}num=Number(num);return isFiniteNumber(num)&&Number.isInteger(num)?num:0};_C$.format_number_int=format_number_int;const format_number_dec=(num,decimals=2,allow_negatives=true,discard_trailing_zeroes=false)=>{if(num==undefined){num=0}if(decimals==undefined){decimals=2}decimals=format_number_int(decimals,false);if(decimals<1){decimals=1}else if(decimals>13){decimals=13}if(allow_negatives!==false){allow_negatives=true}if(discard_trailing_zeroes!==true){discard_trailing_zeroes=false}num=format_number_float(num,allow_negatives);if(allow_negatives!==true){if(num<0){num=0}}num=num.toFixed(decimals);if(discard_trailing_zeroes!==false){num=Number.parseFloat(num)}return String(num)};_C$.format_number_dec=format_number_dec;const stripslashes=function(str){str=String(str==undefined?"":str);if(str==""){return""}const replacer=(s,n1)=>{switch(n1){case"\\":return"\\";case"0":return"\0";case"":return"";default:return String(n1)}};return String(str.replace(/\\(.?)/g,replacer))};_C$.stripslashes=stripslashes;const addcslashes=function(str,charlist){str=String(str==undefined?"":str);if(str==""){return""}charlist=String(charlist==undefined?"":charlist);if(charlist==""){return""}let target="",chrs=[],i=0,j=0,c="",next="",rangeBegin="",rangeEnd="",chr="",begin=0,end=0,octalLength=0,postOctalPos=0,cca=0,escHexGrp=[],encoded="";const percentHex=/%([\dA-Fa-f]+)/g;const _pad=(n,c)=>{if((n=String(n)).length<c){return new Array(++c-n.length).join("0")+n}return n};for(i=0;i<charlist.length;i++){c=charlist.charAt(i);next=charlist.charAt(i+1);if(c==="\\"&&next&&/\d/.test(next)){rangeBegin=charlist.slice(i+1).match(/^\d+/)[0];octalLength=rangeBegin.length;postOctalPos=i+octalLength+1;if(charlist.charAt(postOctalPos)+charlist.charAt(postOctalPos+1)===".."){begin=rangeBegin.charCodeAt(0);if(/\\\d/.test(charlist.charAt(postOctalPos+2)+charlist.charAt(postOctalPos+3))){rangeEnd=charlist.slice(postOctalPos+3).match(/^\d+/)[0];i+=1}else if(charlist.charAt(postOctalPos+2)){rangeEnd=charlist.charAt(postOctalPos+2)}else{_p$.error(_N$,"ERR: addcslashes: Range with no end point (1)")}end=rangeEnd.charCodeAt(0);if(end>begin){for(j=begin;j<=end;j++){chrs.push(String.fromCharCode(j))}}else{chrs.push(".",rangeBegin,rangeEnd)}i+=rangeEnd.length+2}else{chr=String.fromCharCode(parseInt(rangeBegin,8));chrs.push(chr)}i+=octalLength}else if(next+charlist.charAt(i+2)===".."){rangeBegin=c;begin=rangeBegin.charCodeAt(0);if(/\\\d/.test(charlist.charAt(i+3)+charlist.charAt(i+4))){rangeEnd=charlist.slice(i+4).match(/^\d+/)[0];i+=1}else if(charlist.charAt(i+3)){rangeEnd=charlist.charAt(i+3)}else{_p$.error(_N$,"ERR: addcslashes: Range with no end point (2)")}end=rangeEnd.charCodeAt(0);if(end>begin){for(j=begin;j<=end;j++){chrs.push(String.fromCharCode(j))}}else{chrs.push(".",rangeBegin,rangeEnd)}i+=rangeEnd.length+2}else{chrs.push(c)}}for(i=0;i<str.length;i++){c=str.charAt(i);if(chrs.indexOf(c)!==-1){target+="\\";cca=c.charCodeAt(0);if(cca<32||cca>126){switch(c){case"\n":target+="n";break;case"\t":target+="t";break;case"\r":target+="r";break;case"\x07":target+="a";break;case"\v":target+="v";break;case"\b":target+="b";break;case"\f":target+="f";break;default:encoded=encodeURIComponent(c);let escHexGrps=stringRegexMatchAll(encoded,percentHex);let z;for(z=0;z<escHexGrps.length;z++){if(z>0){target+="\\"}target+=_pad(parseInt(escHexGrps[z][1],16).toString(8),3)}break}}else{target+=c}}else{target+=c}}return String(target?target:"")};_C$.addcslashes=addcslashes;const escape_css=str=>{str=String(str==undefined?"":str);if(str==""){return""}return String(addcslashes(String(str==undefined?"":str),"\0..\x1f!\"#$%&'()*+,./:;<=>?@[\\]^`{|}~"))};_C$.escape_css=escape_css;const htmlspecialchars=(str,flag="ENT_COMPAT")=>{str=String(str==undefined?"":str);if(str==""){return""}flag=String(flag==undefined?"":flag);if(flag==""){flag="ENT_COMPAT"}str=str.replace(/&/g,"&amp;");str=str.replace(/\</g,"&lt;");str=str.replace(/\>/g,"&gt;");if(flag=="ENT_QUOTES"){str=str.replace(/"/g,"&quot;");str=str.replace(/'/g,"&#039;")}else if(flag!="ENT_NOQUOTES"){str=str.replace(/"/g,"&quot;")}return String(str)};_C$.htmlspecialchars=htmlspecialchars;const escape_html=str=>String(htmlspecialchars(str,"ENT_COMPAT"));_C$.escape_html=escape_html;const escape_js=function(str){str=String(str==undefined?"":str);if(str==""){return""}const escape_unicode=str=>{str=String(str==undefined?"":str);if(str==""){return""}return String("\\u"+("0000"+str.charCodeAt(0).toString(16)).slice(-4).toLowerCase())};const replace_meta=str=>{str=String(str==undefined?"":str);if(str==""){return""}switch(str){case"\b":str="\\b";break;case"\t":str="\\t";break;case"\n":str="\\n";break;case"\f":str="\\f";break;case"\r":str="\\r";break;case"\\":str="\\\\";break;default:str=escape_unicode(str)}return String(str)};let encoded="";encoded=str.replace(/[\x00-\x1f\x7f-\x9f\\]/g,a=>replace_meta(a));encoded=encoded.replace(/[\u007F-\uFFFF]/g,c=>escape_unicode(c));encoded=encoded.replace(/[\u0026]/g,"\\u0026");encoded=encoded.replace(/[\u0022]/g,"\\u0022");encoded=encoded.replace(/[\u0027]/g,"\\u0027");encoded=encoded.replace(/[\u003C]/g,"\\u003C");encoded=encoded.replace(/[\u003E]/g,"\\u003E");encoded=encoded.replace(/[\/]/g,"\\/");return String(encoded)};_C$.escape_js=escape_js;const escape_url=str=>{str=String(str==undefined?"":str);if(str==""){return""}str=String(encodeURIComponent(str));str=str.replace("!","%21");str=str.replace("'","%27");str=str.replace("(","%28");str=str.replace(")","%29");str=str.replace("*","%2A");return String(str)};_C$.escape_url=escape_url;const nl2br=str=>{str=String(str==undefined?"":str);if(str==""){return""}return String(str.replace(/\r\n/g,/\n/).replace(/\r/g,/\n/).replace(/\n/g,"<br>"))};_C$.nl2br=nl2br;const utf8_encode=function(str){str=String(str==undefined?"":str);if(str==""){return""}let utftext="";str=str.replace(/\r\n/g,/\n/).replace(/\r/g,/\n/);for(let n=0;n<str.length;n++){let c=str.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return String(utftext)};_C$.utf8_encode=utf8_encode;const utf8_decode=function(utftext){utftext=String(utftext==undefined?"":utftext);if(utftext==""){return""}let str="";let i=0;let c,c1,c2,c3;c=c1=c2=c3=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){str+=String.fromCharCode(c);i++}else if(c>191&&c<224){c2=utftext.charCodeAt(i+1);str+=String.fromCharCode((c&31)<<6|c2&63);i+=2}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);str+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63);i+=3}}return String(str)};_C$.utf8_decode=utf8_decode;const deaccent_str=function(strIn){strIn=String(strIn==undefined?"":strIn);if(strIn==""){return""}const data_accented="\xe1\xe2\xe3\xe4\xe5\u0101\u0103\u0105\xc1\xc2\xc3\xc4\xc5\u0100\u0102\u0104\u0107\u0109\u010d\xe7\u0106\u0108\u010c\xc7\u010f\u010e\xe8\xe9\xea\xeb\u0113\u0115\u0117\u011b\u0119\xc8\xc9\xca\xcb\u0112\u0114\u0116\u011a\u0118\u011d\u0123\u011c\u0122\u0125\u0127\u0124\u0126\xec\xed\xee\xef\u0129\u012b\u012d\u0209\u020b\u012f\xcc\xcd\xce\xcf\u0128\u012a\u012c\u0208\u020a\u012e\u0133\u0135\u0132\u0134\u0137\u0136\u013a\u013c\u013e\u0142\u0139\u013b\u013d\u0141\xf1\u0144\u0146\u0148\xd1\u0143\u0145\u0147\xf3\xf4\xf5\xf6\u014d\u014f\u0151\xf8\u0153\xd2\xd3\xd4\xd5\xd6\u014c\u014e\u0150\xd8\u0152\u0155\u0157\u0159\u0154\u0156\u0158\u0219\u015f\u0161\u015b\u015d\u0161\u0218\u015e\u0160\u015a\u015c\u0160\u021b\u0163\u0165\u021a\u0162\u0164\xf9\xfa\xfb\xfc\u0169\u016b\u016d\u016f\u0171\u0173\xd9\xda\xdb\xdc\u0168\u016a\u016c\u016e\u0170\u0172\u0175\u0174\u1e8f\u1ef3\u0177\xff\xfd\u1e8e\u1ef2\u0176\u0178\xdd\u017a\u017c\u017e\u0179\u017b\u017d";const data_deaccented="aaaaaaaaAAAAAAAAccccCCCCdDeeeeeeeeeEEEEEEEEEggGGhhHHiiiiiiiiiiIIIIIIIIIIjjJJkKllllLLLLnnnnNNNNoooooooooOOOOOOOOOOrrrRRRssssssSSSSSStttTTTuuuuuuuuuuUUUUUUUUUUwWyyyyyYYYYYzzzZZZ";strIn=strIn.split("");let len=strIn.length;let strOut=new Array;let theIdxFound=-1;for(let y=0;y<len;y++){theIdxFound=data_accented.indexOf(strIn[y]);if(theIdxFound!==-1){strOut[y]=data_deaccented.substr(theIdxFound,1)}else{strOut[y]=strIn[y]}}strOut=strOut.join("");return String(strOut)};_C$.deaccent_str=deaccent_str;const bin2hex=function(s,bin=false){s=String(s==undefined?"":s);if(s==""){return""}if(bin!==true){s=String(utf8_encode(s))}let hex="";let i,l,n;for(i=0,l=s.length;i<l;i++){n=s.charCodeAt(i).toString(16);hex+=n.length<2?"0"+n:n}return String(hex).toLowerCase()};_C$.bin2hex=bin2hex;const hex2bin=function(hex,bin=false){hex=String(hex==undefined?"":hex);hex=String(stringTrim(hex)).toLowerCase();if(hex==""){return""}let bytes=[],str;for(let i=0;i<hex.length-1;i+=2){bytes.push(parseInt(hex.substr(i,2),16))}if(bin!==true){return String(utf8_decode(String.fromCharCode.apply(String,bytes)))}else{return String.fromCharCode.apply(String,bytes)}};_C$.hex2bin=hex2bin;let tseed=(new Date).valueOf();const uuid=function(){let uuid=String((tseed++).toString(36)).toUpperCase().substr(-10);if(uuid.length<10){for(let i=0;i<uuid.length;i++){if(uuid.length<10){uuid=String("0"+uuid)}else{break}}}return String(uuid)};_C$.uuid=uuid;const addToList=function(newVal,textList,splitBy){newVal=String(newVal==undefined?"":stringTrim(newVal));if(newVal==""){return""}textList=String(textList==undefined?"":textList);let terms=[];splitBy=String(splitBy==undefined?"":splitBy);switch(splitBy){case",":terms=stringSplitbyComma(textList);break;case";":terms=stringSplitbySemicolon(textList);break;default:_p$.error(_N$,"ERR: addToList: Invalid splitBy separator. Must be any of [,;] and is:",splitBy);return""}let found=false;if(terms.length>0){terms.pop();for(let i=0;i<terms.length;i++){if(terms[i]==newVal){found=true;break}}}if(!found){terms.push(newVal)}terms.push("");return String(terms.join(splitBy+" "))};_C$.addToList=addToList;const textSort=function(property,useLocale=false){return(a,b)=>{a[property]=String(a[property]);b[property]=String(b[property]);let comparer=0;let localeFailed=false;if(useLocale===true){try{comparer=a[property].localeCompare(b[property]);if(comparer<0){comparer=-1}else if(comparer>0){comparer=1}else{comparer=0}}catch(e){localeFailed=true}}if(useLocale!==true||localeFailed===true){comparer=(a[property]<b[property]?-1:a[property]>b[property])?1:0}return comparer}};_C$.textSort=textSort;const numericSort=property=>{return(a,b)=>{if(!isFiniteNumber(a[property])||!isFiniteNumber(b[property])){return 0}if(a[property]>b[property]){return 1}else if(a[property]<b[property]){return-1}else{return 0}}};_C$.numericSort=numericSort;const url_add_suffix=function(url,suffix){url=stringPureVal(url,true);suffix=stringPureVal(suffix,true);if(stringStartsWith(suffix,"?")||stringStartsWith(suffix,"&")){suffix=stringPureVal(suffix.substring(1),true)}if(suffix==""){return String(url)}let separator="";if(stringContains(url,"?")){separator="&"}else{separator="?"}return String(url+separator+suffix)};_C$.url_add_suffix=url_add_suffix;const create_slug=(str,lowercase=false,maxlen=0)=>{str=stringPureVal(str,true);if(str==""){return""}str=String(deaccent_str(stringTrim(str)));str=str.replace(/[^a-zA-Z0-9_\-]/g,"-");str=str.replace(/[\-]+/g,"-");str=str.replace(/^[\-]+/,"").replace(/[\-]+$/,"");str=String(stringTrim(str));if(lowercase===true){str=str.toLowerCase()}maxlen=format_number_int(maxlen,false);if(maxlen>0){str=str.substr(0,maxlen);str=str.replace(/(\-)+$/,"")}return String(str)};_C$.create_slug=create_slug;const create_htmid=str=>{str=stringPureVal(str,true);if(str==""){return""}str=str.replace(/[^a-zA-Z0-9_\-]/g,"");str=stringTrim(str);return String(str)};_C$.create_htmid=create_htmid;const create_jsvar=str=>{str=stringPureVal(str,true);if(str==""){return""}str=str.replace(/[^a-zA-Z0-9_\$]/g,"");str=String(stringTrim(str));return String(str)};_C$.create_jsvar=create_jsvar;const revertNosyntaxContentMarkersTpl=tpl=>{if(typeof tpl!=="string"){return""}tpl=String(tpl);tpl=stringReplaceAll("\uff3b"+"###","["+"###",tpl);tpl=stringReplaceAll("###"+"\uff3d","###"+"]",tpl);tpl=stringReplaceAll("\uff3b"+"%%%","["+"%%%",tpl);tpl=stringReplaceAll("%%%"+"\uff3d","%%%"+"]",tpl);tpl=stringReplaceAll("\uff3b"+"@@@","["+"@@@",tpl);tpl=stringReplaceAll("@@@"+"\uff3d","@@@"+"]",tpl);tpl=stringReplaceAll("\uff3b"+":::","["+":::",tpl);tpl=stringReplaceAll(":::"+"\uff3d",":::"+"]",tpl);return String(tpl)};_C$.revertNosyntaxContentMarkersTpl=revertNosyntaxContentMarkersTpl;const prepareNosyntaxContentMarkersTpl=tpl=>{if(typeof tpl!=="string"){return""}tpl=String(tpl);tpl=stringReplaceAll("["+"###","\uff3b"+"###",tpl);tpl=stringReplaceAll("###"+"]","###"+"\uff3d",tpl);tpl=stringReplaceAll("["+"%%%","\uff3b"+"%%%",tpl);tpl=stringReplaceAll("%%%"+"]","%%%"+"\uff3d",tpl);tpl=stringReplaceAll("["+"@@@","\uff3b"+"@@@",tpl);tpl=stringReplaceAll("@@@"+"]","@@@"+"\uff3d",tpl);tpl=stringReplaceAll("["+":::","\uff3b"+":::",tpl);tpl=stringReplaceAll(":::"+"]",":::"+"\uff3d",tpl);return String(tpl)};_C$.prepareNosyntaxContentMarkersTpl=prepareNosyntaxContentMarkersTpl;const prepareNosyntaxHtmlMarkersTpl=tpl=>{if(typeof tpl!=="string"){return""}tpl=String(tpl);tpl=stringReplaceAll("["+"###","&lbrack;&num;&num;&num;",tpl);tpl=stringReplaceAll("###"+"]","&num;&num;&num;&rbrack;",tpl);tpl=stringReplaceAll("["+"%%%","&lbrack;&percnt;&percnt;&percnt;",tpl);tpl=stringReplaceAll("%%%"+"]","&percnt;&percnt;&percnt;&rbrack;",tpl);tpl=stringReplaceAll("["+"@@@","&lbrack;&commat;&commat;&commat;",tpl);tpl=stringReplaceAll("@@@"+"]","&commat;&commat;&commat;&rbrack;",tpl);tpl=stringReplaceAll("["+":::","&lbrack;&colon;&colon;&colon;",tpl);tpl=stringReplaceAll(":::"+"]","&colon;&colon;&colon;&rbrack;",tpl);tpl=stringReplaceAll("\uff3b"+"###","&lbrack;&num;&num;&num;",tpl);tpl=stringReplaceAll("###"+"\uff3d","&num;&num;&num;&rbrack;",tpl);tpl=stringReplaceAll("\uff3b"+"%%%","&lbrack;&percnt;&percnt;&percnt;",tpl);tpl=stringReplaceAll("%%%"+"\uff3d","&percnt;&percnt;&percnt;&rbrack;",tpl);tpl=stringReplaceAll("\uff3b"+"@@@","&lbrack;&commat;&commat;&commat;",tpl);tpl=stringReplaceAll("@@@"+"\uff3d","&commat;&commat;&commat;&rbrack;",tpl);tpl=stringReplaceAll("\uff3b"+":::","&lbrack;&colon;&colon;&colon;",tpl);tpl=stringReplaceAll(":::"+"\uff3d","&colon;&colon;&colon;&rbrack;",tpl);return String(tpl)};_C$.prepareNosyntaxHtmlMarkersTpl=prepareNosyntaxHtmlMarkersTpl;const renderMarkersTpl=function(template,arrobj,isEncoded=false,revertSyntax=false){if(typeof template==="string"&&typeof arrobj==="object"){if(isEncoded===true){template=String(decodeURIComponent(template))}if(revertSyntax===true){template=String(revertNosyntaxContentMarkersTpl(template))}template=stringTrim(template);if(stringContains(template,"["+"%%%COMMENT%%%"+"]")&&stringContains(template,"["+"%%%/COMMENT%%%"+"]")){let arr_comments=[];arr_comments=template.split("["+"%%%COMMENT%%%"+"]");for(let i=0;i<arr_comments.length;i++){if(stringContains(arr_comments[i],"["+"%%%/COMMENT%%%"+"]")){arr_comments[i]="["+"%%%COMMENT%%%"+"]"+arr_comments[i];arr_comments[i]=arr_comments[i].replace(/[\s\S]?\[\%\%\%COMMENT\%\%\%\]([\s\S]*?)\[\%\%\%\/COMMENT\%\%\%\][\s\S]?/g,"")}}template=stringTrim(arr_comments.join(""));arr_comments=null}if(template!=""){const regexp=/\[\#\#\#([A-Z0-9_\-\.]+)((\|[a-z0-9]+)*)\#\#\#\]/g;let markers=stringRegexMatchAll(template,regexp);if(markers.length){let marker,escaping;let tmp_marker_val,tmp_marker_id,tmp_marker_key,tmp_marker_esc,tmp_marker_arr_esc;let xnum,xlen,jsonObj;for(let i=0;i<markers.length;i++){marker=markers[i];if(marker.length){tmp_marker_val="";tmp_marker_id=marker[0]?String(marker[0]):"";tmp_marker_key=marker[1]?String(marker[1]):"";tmp_marker_esc=marker[2]?String(marker[2]):"";tmp_marker_arr_esc=[];if(tmp_marker_id!=null&&tmp_marker_id!=""&&tmp_marker_key!=null&&tmp_marker_key!=""&&stringContains(template,tmp_marker_id)){if(tmp_marker_key in arrobj){tmp_marker_val=arrobj[tmp_marker_key]?arrobj[tmp_marker_key]:"";tmp_marker_val=String(tmp_marker_val);tmp_marker_val=String(prepareNosyntaxContentMarkersTpl(tmp_marker_val));if(tmp_marker_esc){if(stringStartsWith(tmp_marker_esc,"|")){tmp_marker_esc=tmp_marker_esc.substr(1)}if(tmp_marker_esc){tmp_marker_arr_esc=tmp_marker_esc.split(/\|/);if(tmp_marker_arr_esc.length){for(let j=0;j<tmp_marker_arr_esc.length;j++){escaping=String("|"+String(tmp_marker_arr_esc[j]));if(escaping=="|bool"){if(tmp_marker_val){tmp_marker_val="true"}else{tmp_marker_val="false"}}else if(escaping=="|int"){tmp_marker_val=String(format_number_int(tmp_marker_val))}else if(escaping.substring(0,4)=="|dec"){xnum=format_number_int(escaping.substring(4));if(xnum<1){xnum=1}if(xnum>4){xnum=4}tmp_marker_val=String(format_number_dec(tmp_marker_val,xnum,true,false));xnum=null}else if(escaping=="|num"){tmp_marker_val=String(format_number_float(tmp_marker_val))}else if(escaping=="|idtxt"){tmp_marker_val=String(stringReplaceAll("_","-",tmp_marker_val));tmp_marker_val=String(stringUcWords(tmp_marker_val))}else if(escaping=="|slug"){tmp_marker_val=String(create_slug(tmp_marker_val,false))}else if(escaping=="|htmid"){tmp_marker_val=String(create_htmid(tmp_marker_val))}else if(escaping=="|jsvar"){tmp_marker_val=String(create_jsvar(tmp_marker_val))}else if(escaping.substring(0,7)=="|substr"||escaping.substring(0,7)=="|subtxt"){xnum=format_number_int(escaping.substring(7));if(xnum<1){xnum=1}if(xnum>65535){xnum=65535}if(xnum>=1&&xnum<=65535){xlen=tmp_marker_val.length;if(escaping.substring(0,7)=="|subtxt"){if(xnum<5){xnum=5}xnum=xnum-3;if(xlen>xnum){tmp_marker_val=tmp_marker_val.substring(0,xnum);tmp_marker_val=tmp_marker_val.replace(/\s+?(\S+)?$/,"");tmp_marker_val=String(tmp_marker_val)+"..."}}else{if(xlen>xnum){tmp_marker_val=tmp_marker_val.substring(0,xnum)}}xlen=null}xnum=null;tmp_marker_val=String(tmp_marker_val)}else if(escaping=="|lower"){tmp_marker_val=String(tmp_marker_val).toLowerCase()}else if(escaping=="|upper"){tmp_marker_val=String(tmp_marker_val).toUpperCase()}else if(escaping=="|ucfirst"){tmp_marker_val=String(stringUcFirst(tmp_marker_val))}else if(escaping=="|ucwords"){tmp_marker_val=String(stringUcWords(tmp_marker_val))}else if(escaping=="|trim"){tmp_marker_val=String(stringTrim(tmp_marker_val))}else if(escaping=="|url"){tmp_marker_val=String(escape_url(tmp_marker_val))}else if(escaping=="|json"){jsonObj=null;try{jsonObj=JSON.parse(tmp_marker_val)}catch(err){jsonObj=null}tmp_marker_val=JSON.stringify(jsonObj,null,null);tmp_marker_val=String(tmp_marker_val);tmp_marker_val=tmp_marker_val.replace(/[\u0026]/g,"\\u0026");tmp_marker_val=tmp_marker_val.replace(/[\u003C]/g,"\\u003C");tmp_marker_val=tmp_marker_val.replace(/[\u003E]/g,"\\u003E");tmp_marker_val=tmp_marker_val.replace(/[\/]/g,"\\/");tmp_marker_val=String(stringTrim(tmp_marker_val));if(tmp_marker_val==""){tmp_marker_val="null"}}else if(escaping=="|js"){tmp_marker_val=String(escape_js(tmp_marker_val))}else if(escaping=="|html"){tmp_marker_val=String(escape_html(tmp_marker_val))}else if(escaping=="|css"){tmp_marker_val=String(escape_css(tmp_marker_val))}else if(escaping=="|nl2br"){tmp_marker_val=String(nl2br(tmp_marker_val))}else if(escaping=="|smartlist"){tmp_marker_val=String(stringReplaceAll("<","\u2039",tmp_marker_val));tmp_marker_val=String(stringReplaceAll(">","\u203a",tmp_marker_val))}else if(escaping=="|syntaxhtml"){tmp_marker_val=String(prepareNosyntaxHtmlMarkersTpl(tmp_marker_val))}else if(escaping=="|hex"){tmp_marker_val=String(bin2hex(tmp_marker_val))}else{_p$.warn(_N$,"WARN: renderMarkersTpl: {### Invalid or Undefined Escaping for Marker: "+escaping+" - detected in Replacement Key: "+tmp_marker_id+" @ "+tmp_marker_val+" detected in Template: ^"+"\n"+template.substr(0,512)+"$(0..512)... ###}")}}}}}template=stringReplaceAll(tmp_marker_id,tmp_marker_val,template)}}}marker=null;escaping=null;tmp_marker_val=null;tmp_marker_id=null;tmp_marker_key=null;tmp_marker_esc=null;tmp_marker_arr_esc=null}}markers=null;if(stringContains(template,"["+"%%%|")){template=stringReplaceAll("["+"%%%|SB-L%%%"+"]","\uff3b",template);template=stringReplaceAll("["+"%%%|SB-R%%%"+"]","\uff3d",template);template=stringReplaceAll("["+"%%%|R%%%"+"]","\r",template);template=stringReplaceAll("["+"%%%|N%%%"+"]","\n",template);template=stringReplaceAll("["+"%%%|T%%%"+"]","\t",template);template=stringReplaceAll("["+"%%%|SPACE%%%"+"]"," ",template)}if(stringContains(template,"["+"###")){_p$.warn(_N$,"WARN: renderMarkersTpl:",stringRegexMatchAll(template,regexp),"{### Undefined Markers detected in Template:"+"\n"+template.substr(0,512)+"$(0..512)... ###}")}if(stringContains(template,"["+"%%%")){_p$.warn(_N$,"WARN: renderMarkersTpl: {### Undefined Marker Syntax detected in Template: ^"+"\n"+template.substr(0,512)+"$(0..512)... ###}")}if(stringContains(template,"["+"@@@")){_p$.warn(_N$,"WARN: renderMarkersTpl: {### Undefined Marker Sub-Templates detected in Template: ^"+"\n"+template.substr(0,512)+"$(0..512)... ###}")}}}else{_p$.error(_N$,"ERR: renderMarkersTpl: {### Invalid Marker-TPL Arguments ###}");template=""}return String(template)};_C$.renderMarkersTpl=renderMarkersTpl}};smartJ$Utils.secureClass();if(typeof window!="undefined"){window.smartJ$Utils=smartJ$Utils}
// #END
