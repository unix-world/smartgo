// JS-Script (UM): hardwrap.js @ 2022-09-20 09:51:38 +0000
(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(w){"use strict";var x=w.Pos;function l(e,r,t){var n=t.paragraphStart||e.getHelper(r,"paragraphStart");for(var a=r.line,o=e.firstLine();a>o;--a){var i=e.getLine(a);if(n&&n.test(i))break;if(!/\S/.test(i)){++a;break}}var f=t.paragraphEnd||e.getHelper(r,"paragraphEnd");for(var l=r.line+1,s=e.lastLine();l<=s;++l){var i=e.getLine(l);if(f&&f.test(i)){++l;break}if(!/\S/.test(i))break}return{from:a,to:l}}function S(e,r,t,n,a){var o=r;while(o<e.length&&e.charAt(o)==" ")o++;for(;o>0;--o)if(t.test(e.slice(o-1,o+1)))break;if(!a&&o<=e.match(/^[ \t]*/)[0].length){for(o=r+1;o<e.length-1;++o){if(t.test(e.slice(o-1,o+1)))break}}for(var i=true;;i=false){var f=o;if(n)while(e.charAt(f-1)==" ")--f;if(f==0&&i)o=r;else return{from:f,to:o}}}function s(t,e,r,n){e=t.clipPos(e);r=t.clipPos(r);var a=n.column||80;var o=n.wrapOn||/\s\S|-[^\.\d]/;var i=n.forceBreak!==false;var f=n.killTrailingSpace!==false;var l=[],s="",h=e.line;var c=t.getRange(e,r,false);if(!c.length)return null;var g=c[0].match(/^[ \t]*/)[0];if(g.length>=a)a=g.length+1;for(var v=0;v<c.length;++v){var p=c[v],u=s.length,m=0;if(s&&p&&!o.test(s.charAt(s.length-1)+p.charAt(0))){s+=" ";m=1}var d="";if(v){d=p.match(/^\s*/)[0];p=p.slice(d.length)}s+=p;if(v){var b=s.length>a&&g==d&&S(s,a,o,f,i);if(!b||b.from!=u||b.to!=u+m){l.push({text:[m?" ":""],from:x(h,u),to:x(h+1,d.length)})}else{s=g+p;++h}}while(s.length>a){var k=S(s,a,o,f,i);if(k.from!=k.to||i&&g!==s.slice(0,k.to)){l.push({text:["",g],from:x(h,k.from),to:x(h,k.to)});s=g+s.slice(k.to);++h}else{break}}}if(l.length)t.operation(function(){for(var e=0;e<l.length;++e){var r=l[e];if(r.text||w.cmpPos(r.from,r.to))t.replaceRange(r.text,r.from,r.to)}});return l.length?{from:l[0].from,to:w.changeEnd(l[l.length-1])}:null}w.defineExtension("wrapParagraph",function(e,r){r=r||{};if(!e)e=this.getCursor();var t=l(this,e,r);return s(this,x(t.from,0),x(t.to-1),r)});w.commands.wrapLines=function(i){i.operation(function(){var e=i.listSelections(),r=i.lastLine()+1;for(var t=e.length-1;t>=0;t--){var n=e[t],a;if(n.empty()){var o=l(i,n.head,{});a={from:x(o.from,0),to:x(o.to-1)}}else{a={from:n.from(),to:n.to()}}if(a.to.line>=r)continue;r=a.from.line;s(i,a.from,a.to,{})}})};w.defineExtension("wrapRange",function(e,r,t){return s(this,e,r,t||{})});w.defineExtension("wrapParagraphsInRange",function(e,r,t){t=t||{};var n=this,a=[];for(var o=e.line;o<=r.line;){var i=l(n,x(o,0),t);a.push(i);o=i.to}var f=false;if(a.length)n.operation(function(){for(var e=a.length-1;e>=0;--e)f=f||s(n,x(a[e].from,0),x(a[e].to-1),t)});return f})});
// #END
