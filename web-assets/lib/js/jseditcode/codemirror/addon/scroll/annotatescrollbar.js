// JS-Script (UM): annotatescrollbar.js @ 2023-11-25 11:00:42 +0000
(function(e){if(typeof exports=="object"&&typeof module=="object"){e(require("../../lib/codemirror"))}else if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],e)}else{e(CodeMirror)}})(function(e){"use strict";e.defineExtension("annotateScrollbar",function(e){if(typeof e=="string"){e={className:e}}return new t(this,e)});e.defineOption("scrollButtonHeight",0);function t(e,t){this.cm=e;this.options=t;this.buttonHeight=t.scrollButtonHeight||e.getOption("scrollButtonHeight");this.annotations=[];this.doRedraw=this.doUpdate=null;this.div=e.getWrapperElement().appendChild(document.createElement("div"));this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none";this.computeScale();function i(e){clearTimeout(n.doRedraw);n.doRedraw=setTimeout(function(){n.redraw()},e)}var n=this;e.on("refresh",this.resizeHandler=function(){clearTimeout(n.doUpdate);n.doUpdate=setTimeout(function(){if(n.computeScale()){i(20)}},100)});e.on("markerAdded",this.resizeHandler);e.on("markerCleared",this.resizeHandler);if(t.listenForChanges!==false){e.on("changes",this.changeHandler=function(){i(250)})}}t.prototype.computeScale=function(){var e=this.cm;var t=(e.getWrapperElement().clientHeight-e.display.barHeight-this.buttonHeight*2)/e.getScrollerElement().scrollHeight;if(t!=this.hScale){this.hScale=t;return true}};t.prototype.update=function(e){this.annotations=e;this.redraw()};t.prototype.redraw=function(e){if(e!==false){this.computeScale()}var r=this.cm,t=this.hScale;var i=document.createDocumentFragment(),n=this.annotations;var o=r.getOption("lineWrapping");var a=o&&r.defaultTextHeight()*1.5;var s=null,l=null;function h(e,t){if(s!=e.line){s=e.line;l=r.getLineHandle(e.line);var i=r.getLineHandleVisualStart(l);if(i!=l){s=r.getLineNumber(i);l=i}}if(l.widgets&&l.widgets.length||o&&l.height>a){return r.charCoords(e,"local")[t?"top":"bottom"]}var n=r.heightAtLine(l,"local");return n+(t?0:l.height)}var d=r.lastLine();if(r.display.barWidth){for(var c=0,f;c<n.length;c++){var u=n[c];if(u.to.line>d){continue}var p=f||h(u.from,true)*t;var m=h(u.to,false)*t;while(c<n.length-1){if(n[c+1].to.line>d){break}f=h(n[c+1].from,true)*t;if(f>m+.9){break}u=n[++c];m=h(u.to,false)*t}if(m==p){continue}var g=Math.max(m-p,3);var v=i.appendChild(document.createElement("div"));v.style.cssText="position: absolute; right: 0px; width: "+Math.max(r.display.barWidth-1,2)+"px; top: "+(p+this.buttonHeight)+"px; height: "+g+"px";v.className=this.options.className;if(u.id){v.setAttribute("annotation-id",u.id)}}}this.div.textContent="";this.div.appendChild(i)};t.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler);this.cm.off("markerAdded",this.resizeHandler);this.cm.off("markerCleared",this.resizeHandler);if(this.changeHandler){this.cm.off("changes",this.changeHandler)}this.div.parentNode.removeChild(this.div)}});
// #END
