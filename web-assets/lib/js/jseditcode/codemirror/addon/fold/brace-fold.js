// JS-Script (UM): brace-fold.js @ 2022-09-20 09:51:31 +0000
(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(h){"use strict";h.registerHelper("fold","brace",function(i,o){var f=o.line,l=i.getLine(f);var s;function e(e){for(var r=o.ch,n=0;;){var t=r<=0?-1:l.lastIndexOf(e,r-1);if(t==-1){if(n==1)break;n=1;r=l.length;continue}if(n==1&&t<o.ch)break;s=i.getTokenTypeAt(h.Pos(f,t+1));if(!/^(comment|string)/.test(s))return t+1;r=t-1}}var r=e("{"),n=e("[");var t,u,a;if(r!=null&&(n==null||n>r)){a=r;t="{";u="}"}else if(n!=null){a=n;t="[";u="]"}else{return}var d=1,c=i.lastLine(),g,v;e:for(var p=f;p<=c;++p){var m=i.getLine(p),P=p==f?a:0;for(;;){var k=m.indexOf(t,P),b=m.indexOf(u,P);if(k<0)k=m.length;if(b<0)b=m.length;P=Math.min(k,b);if(P==m.length)break;if(i.getTokenTypeAt(h.Pos(p,P+1))==s){if(P==k)++d;else if(!--d){g=p;v=P;break e}}++P}}if(g==null||f==g)return;return{from:h.Pos(f,a),to:h.Pos(g,v)}});h.registerHelper("fold","import",function(f,e){function r(e){if(e<f.firstLine()||e>f.lastLine())return null;var r=f.getTokenAt(h.Pos(e,1));if(!/\S/.test(r.string))r=f.getTokenAt(h.Pos(e,r.end+1));if(r.type!="keyword"||r.string!="import")return null;for(var n=e,t=Math.min(f.lastLine(),e+10);n<=t;++n){var i=f.getLine(n),o=i.indexOf(";");if(o!=-1)return{startCh:r.end,end:h.Pos(n,o)}}}var n=e.line,t=r(n),i;if(!t||r(n-1)||(i=r(n-2))&&i.end.line==n-1)return null;for(var o=t.end;;){var l=r(o.line+1);if(l==null)break;o=l.end}return{from:f.clipPos(h.Pos(n,t.startCh+1)),to:o}});h.registerHelper("fold","include",function(n,e){function r(e){if(e<n.firstLine()||e>n.lastLine())return null;var r=n.getTokenAt(h.Pos(e,1));if(!/\S/.test(r.string))r=n.getTokenAt(h.Pos(e,r.end+1));if(r.type=="meta"&&r.string.slice(0,8)=="#include")return r.start+8}var t=e.line,i=r(t);if(i==null||r(t-1)!=null)return null;for(var o=t;;){var f=r(o+1);if(f==null)break;++o}return{from:h.Pos(t,i+1),to:n.clipPos(h.Pos(o))}})});
// #END
