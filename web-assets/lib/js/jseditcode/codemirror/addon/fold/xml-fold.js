// JS-Script (UM): xml-fold.js @ 2023-11-25 11:00:29 +0000
(function(e){if(typeof exports=="object"&&typeof module=="object"){e(require("../../lib/codemirror"))}else if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],e)}else{e(CodeMirror)}})(function(e){"use strict";var l=e.Pos;function c(e,n){return e.line-n.line||e.ch-n.ch}var n="A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD";var t=n+"-:.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040";var r=new RegExp("<(/?)(["+n+"]["+t+"]*)","g");function a(e,n,t,r){this.line=n;this.ch=t;this.cm=e;this.text=e.getLine(n);this.min=r?Math.max(r.from,e.firstLine()):e.firstLine();this.max=r?Math.min(r.to-1,e.lastLine()):e.lastLine()}function i(e,n){var t=e.cm.getTokenTypeAt(l(e.line,n));return t&&/\btag\b/.test(t)}function f(e){if(e.line>=e.max){return}e.ch=0;e.text=e.cm.getLine(++e.line);return true}function u(e){if(e.line<=e.min){return}e.text=e.cm.getLine(--e.line);e.ch=e.text.length;return true}function s(e){for(;;){var n=e.text.indexOf(">",e.ch);if(n==-1){if(f(e)){continue}else{return}}if(!i(e,n+1)){e.ch=n+1;continue}var t=e.text.lastIndexOf("/",n);var r=t>-1&&!/\S/.test(e.text.slice(t+1,n));e.ch=n+1;return r?"selfClose":"regular"}}function h(e){for(;;){var n=e.ch?e.text.lastIndexOf("<",e.ch-1):-1;if(n==-1){if(u(e)){continue}else{return}}if(!i(e,n+1)){e.ch=n;continue}r.lastIndex=n;e.ch=n;var t=r.exec(e.text);if(t&&t.index==n){return t}}}function v(e){for(;;){r.lastIndex=e.ch;var n=r.exec(e.text);if(!n){if(f(e)){continue}else{return}}if(!i(e,n.index+1)){e.ch=n.index+1;continue}e.ch=n.index+n[0].length;return n}}function x(e){for(;;){var n=e.ch?e.text.lastIndexOf(">",e.ch-1):-1;if(n==-1){if(u(e)){continue}else{return}}if(!i(e,n+1)){e.ch=n;continue}var t=e.text.lastIndexOf("/",n);var r=t>-1&&!/\S/.test(e.text.slice(t+1,n));e.ch=n+1;return r?"selfClose":"regular"}}function g(e,n){var t=[];for(;;){var r=v(e),i,f=e.line,u=e.ch-(r?r[0].length:0);if(!r||!(i=s(e))){return}if(i=="selfClose"){continue}if(r[1]){for(var o=t.length-1;o>=0;--o){if(t[o]==r[2]){t.length=o;break}}if(o<0&&(!n||n==r[2])){return{tag:r[2],from:l(f,u),to:l(e.line,e.ch)}}}else{t.push(r[2])}}}function d(e,n){var t=[];for(;;){var r=x(e);if(!r){return}if(r=="selfClose"){h(e);continue}var i=e.line,f=e.ch;var u=h(e);if(!u){return}if(u[1]){t.push(u[2])}else{for(var o=t.length-1;o>=0;--o){if(t[o]==u[2]){t.length=o;break}}if(o<0&&(!n||n==u[2])){return{tag:u[2],from:l(e.line,e.ch),to:l(i,f)}}}}}e.registerHelper("fold","xml",function(e,n){var t=new a(e,n.line,0);for(;;){var r=v(t);if(!r||t.line!=n.line){return}var i=s(t);if(!i){return}if(!r[1]&&i!="selfClose"){var f=l(t.line,t.ch);var u=g(t,r[2]);return u&&c(u.from,f)>0?{from:f,to:u.from}:null}}});e.findMatchingTag=function(e,n,t){var r=new a(e,n.line,n.ch,t);if(r.text.indexOf(">")==-1&&r.text.indexOf("<")==-1){return}var i=s(r),f=i&&l(r.line,r.ch);var u=i&&h(r);if(!i||!u||c(r,n)>0){return}var o={from:l(r.line,r.ch),to:f,tag:u[2]};if(i=="selfClose"){return{open:o,close:null,at:"open"}}if(u[1]){return{open:d(r,u[2]),close:o,at:"close"}}else{r=new a(e,f.line,f.ch,t);return{open:o,close:g(r,u[2]),at:"open"}}};e.findEnclosingTag=function(e,n,t,r){var i=new a(e,n.line,n.ch,t);for(;;){var f=d(i,r);if(!f){break}var u=new a(e,n.line,n.ch,t);var o=g(u,f.tag);if(o){return{open:f,close:o}}}};e.scanForClosingTag=function(e,n,t,r){var i=new a(e,n.line,n.ch,r?{from:0,to:r}:null);return g(i,t)}});
// #END
